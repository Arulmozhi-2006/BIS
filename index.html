<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BIS Smart Portal â€” AI-Powered Certification & Verification</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET & ROOT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --navy:#061529;--blue-dark:#0a2747;--blue:#0d3b7a;--royal:#1554b0;--sky:#2174d4;
  --accent:#f0a500;--gold:#e09000;--saffron:#ff9933;--green-ind:#138808;
  --white:#fff;--off:#f0f5ff;--glass:rgba(255,255,255,0.07);--border-g:rgba(255,255,255,0.15);
  --dim:rgba(255,255,255,0.65);--danger:#ef4444;--success:#22c55e;--warn:#f59e0b;
  --sxl:0 24px 80px rgba(0,0,0,.45);--slg:0 12px 40px rgba(0,0,0,.3);--smd:0 6px 24px rgba(0,0,0,.2);
}
html{scroll-behavior:smooth}
body{font-family:'Poppins',sans-serif;background:var(--navy);color:#fff;overflow-x:hidden}
input,select,textarea,button{font-family:'Poppins',sans-serif}
button{cursor:pointer}
a{text-decoration:none;color:inherit}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BACKGROUND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bg-scene{position:fixed;inset:0;z-index:0;overflow:hidden}
.bg-scene::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse 90% 70% at 20% 50%,rgba(13,59,122,.7) 0%,transparent 70%),
    radial-gradient(ellipse 60% 60% at 80% 20%,rgba(21,84,176,.5) 0%,transparent 60%),
    linear-gradient(160deg,#061529 0%,#0a2747 40%,#061f3a 70%,#030d1c 100%);
  z-index:1
}
.bg-grid{
  position:absolute;inset:0;z-index:2;
  background-image:linear-gradient(rgba(33,116,212,.07) 1px,transparent 1px),
    linear-gradient(90deg,rgba(33,116,212,.07) 1px,transparent 1px);
  background-size:60px 60px;
  animation:gridPan 30s linear infinite
}
@keyframes gridPan{from{transform:translate(0,0)}to{transform:translate(60px,60px)}}
.orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:.22;animation:orbFloat 12s ease-in-out infinite}
.orb-1{width:500px;height:500px;background:var(--royal);top:-150px;left:-100px}
.orb-2{width:400px;height:400px;background:var(--sky);top:40%;right:-120px;animation-delay:-4s}
.orb-3{width:300px;height:300px;background:var(--accent);bottom:10%;left:30%;animation-delay:-8s;opacity:.1}
@keyframes orbFloat{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-40px) scale(1.05)}66%{transform:translate(-20px,25px) scale(.96)}}
.ring{position:absolute;border-radius:50%;border:1px solid rgba(255,255,255,.035);top:50%;left:50%;transform:translate(-50%,-50%);animation:ringPulse 8s ease-in-out infinite}
.ring:nth-child(1){width:300px;height:300px}.ring:nth-child(2){width:500px;height:500px;animation-delay:-2s;border-color:rgba(255,255,255,.025)}
.ring:nth-child(3){width:700px;height:700px;animation-delay:-4s;border-color:rgba(255,255,255,.018)}.ring:nth-child(4){width:900px;height:900px;animation-delay:-6s;border-color:rgba(255,255,255,.012)}
@keyframes ringPulse{0%,100%{opacity:.6;transform:translate(-50%,-50%) scale(1)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.03)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TRICOLOR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tricolor-bar{position:fixed;top:0;left:0;right:0;height:3px;z-index:1000;background:linear-gradient(90deg,var(--saffron) 33.3%,#fff 33.3% 66.6%,var(--green-ind) 66.6%)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
nav{position:fixed;top:3px;left:0;right:0;z-index:900;transition:all .4s}
nav.scrolled{background:rgba(6,21,41,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border-g);box-shadow:0 4px 30px rgba(0,0,0,.4)}
.nav-inner{max-width:1280px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 28px;height:68px}
.nav-brand{display:flex;align-items:center;gap:12px;cursor:pointer}
.bis-emblem-sm{width:44px;height:44px;flex-shrink:0}
.brand-name{font-size:16px;font-weight:800;letter-spacing:.06em;text-transform:uppercase;line-height:1.15}
.brand-full{font-size:9.5px;color:var(--dim);font-weight:400;letter-spacing:.02em}
.nav-links{display:flex;align-items:center;gap:2px}
.nav-a{color:rgba(255,255,255,.75);padding:8px 15px;border-radius:8px;font-size:13px;font-weight:500;transition:all .25s;background:none;border:none;white-space:nowrap}
.nav-a:hover,.nav-a.active{color:#fff;background:rgba(255,255,255,.1)}
.nav-cta{display:flex;align-items:center;gap:8px;background:linear-gradient(135deg,var(--accent),var(--gold));color:var(--navy);padding:9px 20px;border-radius:10px;font-size:13px;font-weight:700;border:none;box-shadow:0 4px 20px rgba(240,165,0,.35);transition:all .25s;white-space:nowrap}
.nav-cta:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(240,165,0,.5)}
.hamburger{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:8px;border:none;background:none}
.hamburger span{display:block;width:24px;height:2px;background:#fff;border-radius:2px;transition:all .3s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGE SYSTEM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{display:none;position:relative;z-index:10;min-height:100vh}
.page.active{display:block}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HERO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:140px 24px 100px;text-align:center;position:relative}
.hero-eyebrow{display:inline-flex;align-items:center;gap:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(10px);padding:8px 20px;border-radius:40px;font-size:11.5px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--accent);margin-bottom:32px;animation:fadeUp .8s ease both}
.eyebrow-dot{width:6px;height:6px;border-radius:50%;background:var(--accent);animation:blink 2s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.hero h1{font-family:'Playfair Display',serif;font-size:clamp(32px,5.5vw,68px);font-weight:800;line-height:1.1;max-width:860px;margin:0 auto 28px;animation:fadeUp .8s .15s ease both}
.hero h1 .hl{background:linear-gradient(135deg,var(--accent) 0%,#ffcc55 50%,var(--accent) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;background-size:200% auto;animation:shimmer 4s linear infinite}
@keyframes shimmer{to{background-position:200% center}}
.hero-sub{font-size:clamp(14px,1.8vw,17px);color:var(--dim);max-width:640px;margin:0 auto 52px;line-height:1.8;animation:fadeUp .8s .3s ease both}
.hero-btns{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;animation:fadeUp .8s .45s ease both;margin-bottom:80px}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.scroll-hint{position:absolute;bottom:36px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--dim);font-size:11px;letter-spacing:.1em;text-transform:uppercase;animation:fadeUp 1s 1s ease both}
.scroll-arrow{width:28px;height:28px;border-radius:50%;border:1.5px solid rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;animation:bounce 2s ease-in-out infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}

/* BUTTONS */
.btn-primary{display:inline-flex;align-items:center;gap:9px;background:linear-gradient(135deg,var(--royal),var(--sky));color:#fff;padding:15px 32px;border-radius:12px;font-size:14.5px;font-weight:700;border:none;box-shadow:0 8px 32px rgba(21,84,176,.5);transition:all .3s;position:relative;overflow:hidden}
.btn-primary::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent,rgba(255,255,255,.1),transparent);transform:translateX(-100%);transition:transform .5s}
.btn-primary:hover::before{transform:translateX(100%)}
.btn-primary:hover{transform:translateY(-3px);box-shadow:0 16px 48px rgba(21,84,176,.65)}
.btn-accent{display:inline-flex;align-items:center;gap:9px;background:linear-gradient(135deg,var(--accent),#ffcc44);color:var(--navy);padding:15px 32px;border-radius:12px;font-size:14.5px;font-weight:700;border:none;box-shadow:0 8px 32px rgba(240,165,0,.4);transition:all .3s}
.btn-accent:hover{transform:translateY(-3px);box-shadow:0 16px 48px rgba(240,165,0,.6)}
.btn-ghost{display:inline-flex;align-items:center;gap:9px;background:transparent;color:rgba(255,255,255,.8);padding:14px 26px;border-radius:12px;font-size:14px;font-weight:600;border:1.5px solid rgba(255,255,255,.25);transition:all .3s}
.btn-ghost:hover{border-color:rgba(255,255,255,.6);background:rgba(255,255,255,.08);color:#fff;transform:translateY(-2px)}
.btn-sm{padding:10px 22px;font-size:13px;border-radius:9px}
.btn-outline-white{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.08);color:#fff;padding:10px 22px;border-radius:9px;font-size:13px;font-weight:600;border:1px solid rgba(255,255,255,.2);transition:all .25s}
.btn-outline-white:hover{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.4)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TRUST BAND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.trust-band{position:relative;z-index:10;background:rgba(255,255,255,.04);border-top:1px solid var(--border-g);border-bottom:1px solid var(--border-g);backdrop-filter:blur(10px);padding:18px 0;overflow:hidden}
.trust-track{display:flex;gap:56px;align-items:center;animation:marquee 25s linear infinite;width:max-content}
@keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.trust-item{display:flex;align-items:center;gap:10px;white-space:nowrap;font-size:12.5px;font-weight:500;color:var(--dim)}
.trust-item span{font-size:15px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION COMMON â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section{position:relative;z-index:10;padding:80px 24px}
.section-inner{max-width:1200px;margin:0 auto}
.section-label{display:inline-flex;align-items:center;gap:8px;color:var(--accent);font-size:11.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;margin-bottom:14px}
.section-label::before{content:'';width:20px;height:2px;background:var(--accent);border-radius:2px}
.section-title{font-family:'Playfair Display',serif;font-size:clamp(26px,3.5vw,42px);font-weight:800;line-height:1.2;margin-bottom:14px}
.section-sub{font-size:15.5px;color:var(--dim);line-height:1.75}
.center{text-align:center}
.center .section-label{justify-content:center}
.center .section-sub{max-width:540px;margin:0 auto}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:52px}
.stat-card{background:var(--glass);border:1px solid var(--border-g);border-radius:20px;padding:32px 24px;text-align:center;backdrop-filter:blur(16px);transition:all .35s;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--royal),var(--sky));opacity:0;transition:opacity .35s}
.stat-card:hover{transform:translateY(-6px);border-color:rgba(255,255,255,.25);box-shadow:var(--slg)}
.stat-card:hover::before{opacity:1}
.stat-icon{font-size:34px;display:block;margin-bottom:14px}
.stat-num{font-family:'Playfair Display',serif;font-size:42px;font-weight:800;display:block;margin-bottom:6px;line-height:1}
.stat-num .acc{background:linear-gradient(135deg,var(--accent),#ffcc44);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:12.5px;color:var(--dim);font-weight:500;line-height:1.5}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FEATURE CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.features-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:22px;margin-top:16px}
.feat-card{background:linear-gradient(135deg,rgba(255,255,255,.07) 0%,rgba(255,255,255,.03) 100%);border:1px solid var(--border-g);border-radius:22px;padding:36px;backdrop-filter:blur(20px);transition:all .4s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden;cursor:default}
.feat-card:hover{transform:translateY(-7px);border-color:rgba(255,255,255,.22);box-shadow:var(--sxl)}
.feat-card.wide{grid-column:1/-1;display:grid;grid-template-columns:1fr 1fr;gap:36px;align-items:center}
.feat-icon-wrap{width:64px;height:64px;border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:22px;background:linear-gradient(135deg,rgba(255,255,255,.12),rgba(255,255,255,.05));border:1px solid rgba(255,255,255,.12)}
.feat-icon{font-size:28px}
.feat-num{font-size:11px;font-weight:700;letter-spacing:.12em;color:var(--sky);text-transform:uppercase;margin-bottom:10px;display:block}
.feat-title{font-size:20px;font-weight:700;margin-bottom:12px;line-height:1.3}
.feat-desc{font-size:13.5px;color:var(--dim);line-height:1.75}
.feat-tag{display:inline-flex;align-items:center;gap:6px;margin-top:20px;padding:5px 12px;border-radius:20px;font-size:11px;font-weight:600;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);color:var(--dim)}
.feat-tag-dot{width:5px;height:5px;border-radius:50%;background:var(--sky)}

/* Risk bars viz */
.feature-visual{background:rgba(255,255,255,.04);border:1px solid var(--border-g);border-radius:14px;height:170px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.risk-bars{display:flex;align-items:flex-end;gap:10px;padding:20px}
.risk-bar{width:34px;border-radius:6px 6px 0 0;animation:riseUp 1.5s ease both}
.risk-bar:nth-child(1){height:75px;background:linear-gradient(180deg,#34d399,#059669);animation-delay:.1s}
.risk-bar:nth-child(2){height:115px;background:linear-gradient(180deg,#34d399,#059669);animation-delay:.2s}
.risk-bar:nth-child(3){height:55px;background:linear-gradient(180deg,#fbbf24,#d97706);animation-delay:.3s}
.risk-bar:nth-child(4){height:95px;background:linear-gradient(180deg,#34d399,#059669);animation-delay:.4s}
.risk-bar:nth-child(5){height:38px;background:linear-gradient(180deg,#f87171,#dc2626);animation-delay:.5s}
.risk-bar:nth-child(6){height:85px;background:linear-gradient(180deg,#34d399,#059669);animation-delay:.6s}
@keyframes riseUp{from{transform:scaleY(0);transform-origin:bottom}to{transform:scaleY(1)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROCESS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.process-wrap{background:rgba(255,255,255,.02);border-top:1px solid var(--border-g);border-bottom:1px solid var(--border-g)}
.process-steps{display:grid;grid-template-columns:repeat(4,1fr);gap:0;position:relative;margin-top:20px}
.process-steps::before{content:'';position:absolute;top:48px;left:15%;right:15%;height:2px;background:linear-gradient(90deg,var(--royal),var(--sky),var(--royal));background-size:200%;animation:flowLine 3s linear infinite}
@keyframes flowLine{from{background-position:100% 0}to{background-position:-100% 0}}
.p-step{display:flex;flex-direction:column;align-items:center;text-align:center;padding:32px 18px}
.step-circle{width:96px;height:96px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--blue-dark));border:2px solid var(--border-g);display:flex;align-items:center;justify-content:center;font-size:32px;margin-bottom:22px;position:relative;z-index:1;box-shadow:0 8px 32px rgba(0,0,0,.3);transition:all .3s}
.p-step:hover .step-circle{border-color:var(--sky);box-shadow:0 0 0 6px rgba(33,116,212,.15),0 8px 32px rgba(0,0,0,.3);transform:scale(1.07)}
.step-num{position:absolute;top:-6px;right:-6px;width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--gold));color:var(--navy);font-size:11px;font-weight:800;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(240,165,0,.4)}
.step-title{font-size:14.5px;font-weight:700;margin-bottom:10px}
.step-desc{font-size:12.5px;color:var(--dim);line-height:1.65}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM PAGES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-header{padding:120px 24px 60px;text-align:center;position:relative}
.page-header h1{font-family:'Playfair Display',serif;font-size:clamp(28px,4vw,48px);font-weight:800;margin-bottom:12px}
.page-header p{font-size:15px;color:var(--dim);max-width:560px;margin:0 auto}

.form-wrap{max-width:800px;margin:0 auto;padding:0 24px 80px}
.form-card{background:rgba(255,255,255,.06);border:1px solid var(--border-g);border-radius:24px;padding:40px;backdrop-filter:blur(20px)}
.form-section-lbl{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:var(--dim);padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:22px;display:flex;align-items:center;gap:8px}
.form-section-lbl::before{content:'';width:3px;height:14px;background:var(--accent);border-radius:2px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:12.5px;font-weight:600;color:rgba(255,255,255,.8);margin-bottom:7px}
.form-group label .req{color:var(--danger)}
.fc{width:100%;padding:12px 16px;background:rgba(255,255,255,.07);border:1.5px solid rgba(255,255,255,.15);border-radius:10px;font-size:13.5px;color:#fff;outline:none;transition:all .25s}
.fc::placeholder{color:rgba(255,255,255,.3)}
.fc:focus{border-color:var(--sky);background:rgba(255,255,255,.1);box-shadow:0 0 0 3px rgba(33,116,212,.2)}
.fc option{background:#0d3b7a;color:#fff}
textarea.fc{resize:vertical;min-height:100px}
.form-hint{font-size:11.5px;color:rgba(255,255,255,.4);margin-top:5px}
.upload-zone{border:2px dashed rgba(255,255,255,.2);border-radius:12px;padding:36px 24px;text-align:center;cursor:pointer;background:rgba(255,255,255,.04);transition:all .25s;position:relative}
.upload-zone:hover{border-color:var(--sky);background:rgba(33,116,212,.07)}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%}
.upload-icon{font-size:38px;margin-bottom:10px}
.upload-zone p{font-size:13.5px;color:var(--dim)}
.upload-zone strong{color:var(--sky)}
.btn-submit{width:100%;padding:16px;background:linear-gradient(135deg,var(--royal),var(--sky));color:#fff;border:none;border-radius:12px;font-size:15.5px;font-weight:700;cursor:pointer;transition:all .25s;margin-top:10px;letter-spacing:.02em}
.btn-submit:hover{background:linear-gradient(135deg,#1245a0,#1b65c4);transform:translateY(-2px);box-shadow:0 10px 32px rgba(21,84,176,.5)}
.btn-submit:disabled{opacity:.6;cursor:not-allowed;transform:none}

/* Spinner */
.spinner-wrap{display:none;justify-content:center;padding:36px}
.spinner-wrap.show{display:flex}
.spin{width:44px;height:44px;border:4px solid rgba(255,255,255,.1);border-top-color:var(--sky);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Result card */
.result-card{background:rgba(255,255,255,.06);border:1px solid var(--border-g);border-radius:20px;padding:36px;backdrop-filter:blur(20px);margin-top:24px;animation:fadeUp .4s ease}
.result-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:28px}
.result-status-badge{padding:8px 20px;border-radius:30px;font-size:12.5px;font-weight:700;letter-spacing:.04em;text-transform:uppercase}
.s-approved{background:rgba(34,197,94,.15);color:#4ade80;border:1.5px solid rgba(34,197,94,.3)}
.s-review{background:rgba(245,158,11,.12);color:#fbbf24;border:1.5px solid rgba(245,158,11,.3)}
.s-high{background:rgba(239,68,68,.12);color:#f87171;border:1.5px solid rgba(239,68,68,.3)}
.score-section{margin-bottom:26px}
.score-bar-wrap{height:12px;background:rgba(255,255,255,.08);border-radius:8px;overflow:hidden;margin:10px 0 6px}
.score-bar{height:100%;border-radius:8px;transition:width 1.2s cubic-bezier(.4,0,.2,1)}
.bar-g{background:linear-gradient(90deg,#22c55e,#16a34a)}
.bar-w{background:linear-gradient(90deg,#f59e0b,#d97706)}
.bar-r{background:linear-gradient(90deg,#ef4444,#dc2626)}
.score-row{display:flex;justify-content:space-between;font-size:12px;color:var(--dim)}
.result-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:22px}
.r-item{background:rgba(255,255,255,.06);border-radius:12px;padding:16px}
.r-lbl{font-size:10.5px;color:var(--dim);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
.r-val{font-size:15.5px;font-weight:700}
.r-green{color:#4ade80}.r-red{color:#f87171}.r-warn{color:#fbbf24}.r-white{color:#fff}
.finding{display:flex;align-items:flex-start;gap:10px;padding:10px 14px;border-radius:9px;margin-bottom:8px;font-size:13px}
.f-ok{background:rgba(34,197,94,.08);color:#4ade80}.f-warn{background:rgba(245,158,11,.08);color:#fbbf24}.f-err{background:rgba(239,68,68,.08);color:#f87171}

/* Trust score circle */
.trust-circle{width:150px;height:150px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;margin:0 auto 22px;border:8px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);box-shadow:var(--slg)}
.trust-num{font-family:'Playfair Display',serif;font-size:48px;font-weight:800;line-height:1}
.trust-lbl{font-size:10px;color:var(--dim);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dash-wrap{max-width:1200px;margin:0 auto;padding:0 24px 80px}
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:28px}
.kpi-card{background:rgba(255,255,255,.07);border:1px solid var(--border-g);border-radius:18px;padding:26px;text-align:center;backdrop-filter:blur(16px);transition:all .3s}
.kpi-card:hover{transform:translateY(-4px);box-shadow:var(--slg)}
.kpi-icon{font-size:28px;margin-bottom:10px}
.kpi-num{font-family:'Playfair Display',serif;font-size:40px;font-weight:800;display:block;margin-bottom:4px;line-height:1}
.kpi-blue{color:#60a5fa}.kpi-red{color:#f87171}.kpi-warn{color:#fbbf24}.kpi-green{color:#4ade80}
.kpi-lbl{font-size:11.5px;color:var(--dim);font-weight:500;text-transform:uppercase;letter-spacing:.05em}
.dash-grid{display:grid;grid-template-columns:1.6fr 1fr;gap:22px}
.dash-card{background:rgba(255,255,255,.06);border:1px solid var(--border-g);border-radius:18px;padding:26px;backdrop-filter:blur(16px);margin-bottom:22px}
.dash-card-title{font-size:14px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
.dash-card-title::before{content:'';width:4px;height:16px;background:var(--royal);border-radius:2px}
table{width:100%;border-collapse:collapse}
th{font-size:10.5px;color:var(--dim);font-weight:700;text-transform:uppercase;letter-spacing:.06em;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.1);text-align:left}
td{padding:12px 12px;border-bottom:1px solid rgba(255,255,255,.05);font-size:13px}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.04)}
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.04em}
.bg-green{background:rgba(34,197,94,.12);color:#4ade80}.bg-red{background:rgba(239,68,68,.12);color:#f87171}.bg-warn{background:rgba(245,158,11,.12);color:#fbbf24}.bg-blue{background:rgba(33,116,212,.15);color:#60a5fa}
.bar-chart-viz{display:flex;align-items:flex-end;gap:10px;height:130px;padding-bottom:6px}
.bv-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:5px;height:100%;justify-content:flex-end}
.bv-fill{width:100%;border-radius:5px 5px 0 0;background:var(--royal);transition:height .8s ease}
.bv-lbl{font-size:10px;color:var(--dim);text-align:center}
.bv-val{font-size:11px;font-weight:700}
.alert-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;margin-bottom:8px;font-size:13px}
.a-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.a-red{background:rgba(239,68,68,.1)}.a-dot-r{background:#f87171}
.a-warn{background:rgba(245,158,11,.08)}.a-dot-w{background:#fbbf24}
.a-text{flex:1;color:rgba(255,255,255,.8)}
.a-time{font-size:11px;color:var(--dim)}
.risk-dist{display:grid;gap:12px;margin-top:6px}
.rd-row div:first-child{display:flex;justify-content:space-between;font-size:12.5px;margin-bottom:5px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ABOUT / STANDARDS / CONTACT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.content-wrap{max-width:900px;margin:0 auto;padding:0 24px 80px}
.content-card{background:rgba(255,255,255,.06);border:1px solid var(--border-g);border-radius:20px;padding:40px;backdrop-filter:blur(18px);margin-bottom:22px}
.content-card h2{font-family:'Playfair Display',serif;font-size:26px;font-weight:800;margin-bottom:14px}
.content-card p{font-size:14.5px;color:var(--dim);line-height:1.8;margin-bottom:14px}
.content-card p:last-child{margin-bottom:0}
.standards-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:28px}
.std-card{background:rgba(255,255,255,.05);border:1px solid var(--border-g);border-radius:14px;padding:22px;transition:all .3s}
.std-card:hover{transform:translateY(-4px);border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.09)}
.std-icon{font-size:28px;margin-bottom:12px}
.std-title{font-size:14.5px;font-weight:700;margin-bottom:8px}
.std-desc{font-size:12.5px;color:var(--dim);line-height:1.6}
.contact-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:8px}
.contact-item{display:flex;align-items:flex-start;gap:14px;padding:18px;background:rgba(255,255,255,.05);border-radius:12px;border:1px solid rgba(255,255,255,.08)}
.c-icon{font-size:24px;flex-shrink:0}
.c-label{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:.06em;font-weight:600;margin-bottom:4px}
.c-val{font-size:14px;font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CTA SECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cta-section{position:relative;z-index:10;padding:80px 24px;text-align:center}
.cta-card{max-width:820px;margin:0 auto;background:linear-gradient(135deg,rgba(21,84,176,.35),rgba(33,116,212,.2));border:1px solid rgba(255,255,255,.15);border-radius:28px;padding:68px 52px;backdrop-filter:blur(20px);box-shadow:var(--sxl);position:relative;overflow:hidden}
.cta-card::before{content:'';position:absolute;top:-50px;right:-50px;width:260px;height:260px;border-radius:50%;background:radial-gradient(circle,rgba(240,165,0,.1),transparent 70%);pointer-events:none}
.cta-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(240,165,0,.12);border:1px solid rgba(240,165,0,.25);color:var(--accent);font-size:11.5px;font-weight:700;padding:6px 18px;border-radius:30px;text-transform:uppercase;letter-spacing:.08em;margin-bottom:22px}
.cta-title{font-family:'Playfair Display',serif;font-size:clamp(24px,3.5vw,40px);font-weight:800;margin-bottom:16px;line-height:1.2}
.cta-sub{font-size:15px;color:var(--dim);margin-bottom:40px;line-height:1.75;max-width:560px;margin-left:auto;margin-right:auto}
.cta-btns{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer{position:relative;z-index:10;background:rgba(3,13,28,.96);border-top:1px solid var(--border-g)}
.footer-top{padding:56px 24px 40px;max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1.8fr 1fr 1fr 1fr;gap:44px}
.footer-tagline{font-size:13px;color:var(--dim);line-height:1.75;margin-top:12px;max-width:280px}
.footer-col h4{font-size:11.5px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--accent);margin-bottom:18px}
.footer-col a{display:block;font-size:13px;color:var(--dim);padding:4px 0;transition:color .2s;cursor:pointer}
.footer-col a:hover{color:#fff}
.footer-bottom{border-top:1px solid var(--border-g);padding:22px 24px;max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.f-disclaimer{font-size:11.5px;color:rgba(255,255,255,.28);line-height:1.6;max-width:700px}
.tricolor-sm{width:30px;height:18px;border-radius:3px;overflow:hidden;display:flex;flex-direction:column;border:1px solid rgba(255,255,255,.2);flex-shrink:0}
.t1{background:var(--saffron)}.t2{background:#fff}.t3{background:var(--green-ind)}
.t1,.t2,.t3{flex:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REVEAL ANIM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.reveal{opacity:0;transform:translateY(28px);transition:opacity .7s ease,transform .7s ease}
.reveal.in{opacity:1;transform:translateY(0)}
.rd1{transition-delay:.1s}.rd2{transition-delay:.2s}.rd3{transition-delay:.3s}.rd4{transition-delay:.4s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:28px;right:28px;z-index:9999;background:rgba(10,39,71,.95);border:1px solid var(--border-g);border-radius:14px;padding:16px 22px;font-size:13.5px;box-shadow:var(--slg);transform:translateY(80px);opacity:0;transition:all .4s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;gap:10px;max-width:320px}
.toast.show{transform:translateY(0);opacity:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:1024px){
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .features-grid{grid-template-columns:1fr}
  .feat-card.wide{grid-column:auto;display:block}
  .process-steps{grid-template-columns:repeat(2,1fr)}.process-steps::before{display:none}
  .footer-top{grid-template-columns:1fr 1fr;gap:28px}
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
  .dash-grid{grid-template-columns:1fr}
  .standards-grid{grid-template-columns:repeat(2,1fr)}
  .contact-grid{grid-template-columns:1fr}
}
@media(max-width:768px){
  .nav-links{display:none;position:fixed;inset:71px 0 0;background:rgba(6,21,41,.97);backdrop-filter:blur(20px);padding:28px;z-index:800;flex-direction:column;align-items:flex-start}
  .nav-links.open{display:flex}
  .nav-a{padding:12px 16px;font-size:15px;width:100%}
  .hamburger{display:flex}
  .hero h1{font-size:34px}
  .features-grid,.form-row,.result-grid{grid-template-columns:1fr}
  .feat-card.wide{display:block}
  .process-steps{grid-template-columns:1fr}
  .cta-card{padding:40px 24px}
  .footer-top{grid-template-columns:1fr}
  .footer-bottom{flex-direction:column;text-align:center}
  .standards-grid{grid-template-columns:1fr}
}
@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr}
  .kpi-grid{grid-template-columns:1fr}
}
/* â”€â”€â”€ DASH TABS â”€â”€â”€ */
.dash-tab{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.65);padding:9px 22px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;transition:all .25s;font-family:'Poppins',sans-serif}
.dash-tab:hover{background:rgba(255,255,255,.13);color:#fff}
.dash-tab.active{background:linear-gradient(135deg,var(--royal),var(--sky));color:#fff;border-color:transparent;box-shadow:0 4px 16px rgba(21,84,176,.4)}
</style>
</head>
<body>

<!-- BG -->
<div class="bg-scene">
  <div class="bg-grid"></div>
  <div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div>
  <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
</div>

<div class="tricolor-bar"></div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span id="toastIcon">âœ…</span>
  <span id="toastMsg">Action completed</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NAVBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="navbar">
  <div class="nav-inner">
    <div class="nav-brand" onclick="showPage('home')">
      <svg class="bis-emblem-sm" viewBox="0 0 44 44" fill="none">
        <circle cx="22" cy="22" r="21" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
        <circle cx="22" cy="22" r="17" fill="rgba(21,84,176,0.6)" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
        <g stroke="rgba(255,255,255,0.5)" stroke-width="0.8">
          <line x1="22" y1="8" x2="22" y2="36"/><line x1="8" y1="22" x2="36" y2="22"/>
          <line x1="12.1" y1="12.1" x2="31.9" y2="31.9"/><line x1="31.9" y1="12.1" x2="12.1" y2="31.9"/>
          <line x1="9.7" y1="17" x2="34.3" y2="27"/><line x1="34.3" y1="17" x2="9.7" y2="27"/>
          <line x1="17" y1="9.7" x2="27" y2="34.3"/><line x1="27" y1="9.7" x2="17" y2="34.3"/>
        </g>
        <circle cx="22" cy="22" r="3.5" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="0.8"/>
        <text x="22" y="26" text-anchor="middle" font-family="Poppins,sans-serif" font-size="7" font-weight="800" fill="white">BIS</text>
      </svg>
      <div>
        <div class="brand-name">Smart BIS Certification Portal</div>
        <div class="brand-full">AI-Driven Sustainable Compliance & Environmental Rating System</div>
      </div>
    </div>

    <div class="nav-links" id="navLinks">
      <button class="nav-a" id="nav-home"      onclick="showPage('home');closeMenu()">Home</button>
      <button class="nav-a" id="nav-apply"     onclick="showPage('apply');closeMenu()">Apply</button>
      <button class="nav-a" id="nav-verify"    onclick="showPage('verify');closeMenu()">Verify Product</button>
      <button class="nav-a" id="nav-userdash"  onclick="showPage('userdash');closeMenu()">ğŸ“‹ My Applications</button>
      <button class="nav-a" id="nav-about"     onclick="showPage('about');closeMenu()">About BIS</button>
      <button class="nav-a" id="nav-standards" onclick="showPage('standards');closeMenu()">Standards</button>
      <button class="nav-a" id="nav-green" onclick="showPage('green');closeMenu()" style="color:#4ade80">ğŸŒ¿ Green Intel</button>
      <button class="nav-a" id="nav-contact"   onclick="showPage('contact');closeMenu()">Contact</button>
      <button class="nav-cta" id="nav-dashboard" onclick="showPage('dashboard');closeMenu()">âš™ Officer Login</button>
    </div>
    <div class="hamburger" id="hamburger" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-home" class="page active">

  <!-- HERO -->
  <section class="hero">
    <div class="hero-eyebrow">
      <span class="eyebrow-dot"></span>
      AI-Driven Sustainable Compliance &amp; Environmental Rating System â€” Govt. of India
    </div>
    <h1>Smart BIS Certification &amp; <span class="hl">Product Intelligence</span> Portal Featuring AI Green Intelligence Engine</h1>
    <p class="hero-sub">India's first AI-Driven Sustainable Compliance &amp; Environmental Rating System â€” combining BIS product certification, CM/L validation, counterfeit detection, and Green Intelligence sustainability scoring with ECO-Mark eligibility and badge certification under one unified platform.</p>
    <div class="hero-btns">
      <button class="btn-primary" onclick="showPage('apply')">ğŸ­ Apply for Certification</button>
      <button class="btn-accent"  onclick="showPage('verify')">ğŸ” Verify a Product</button>
      <button class="btn-ghost"   onclick="showPage('dashboard')">âš™ Officer Dashboard â†’</button>
    </div>
    <div class="scroll-hint">
      <div class="scroll-arrow">â†“</div>
      <span>Scroll to explore</span>
    </div>
  </section>

  <!-- TRUST BAND -->
  <div class="trust-band">
    <div class="trust-track">
      <div class="trust-item"><span>ğŸ›</span> Ministry of Consumer Affairs</div>
      <div class="trust-item"><span>ğŸ”’</span> ISO/IEC 17065 Accredited</div>
      <div class="trust-item"><span>ğŸ‡®ğŸ‡³</span> Make in India Initiative</div>
      <div class="trust-item"><span>âœ…</span> BIS Act 2016 Compliant</div>
      <div class="trust-item"><span>ğŸ›¡</span> National Standards Body</div>
      <div class="trust-item"><span>ğŸ¤–</span> AI-Powered Automation</div>
      <div class="trust-item"><span>ğŸ“‹</span> 20,000+ Indian Standards</div>
      <div class="trust-item"><span>ğŸ”¬</span> 8 Regional Offices</div>
      <div class="trust-item"><span>ğŸ›</span> Ministry of Consumer Affairs</div>
      <div class="trust-item"><span>ğŸ”’</span> ISO/IEC 17065 Accredited</div>
      <div class="trust-item"><span>ğŸ‡®ğŸ‡³</span> Make in India Initiative</div>
      <div class="trust-item"><span>âœ…</span> BIS Act 2016 Compliant</div>
      <div class="trust-item"><span>ğŸ›¡</span> National Standards Body</div>
      <div class="trust-item"><span>ğŸ¤–</span> AI-Powered Automation</div>
      <div class="trust-item"><span>ğŸ“‹</span> 20,000+ Indian Standards</div>
      <div class="trust-item"><span>ğŸ”¬</span> 8 Regional Offices</div>
    </div>
  </div>

  <!-- STATS -->
  <section class="section">
    <div class="section-inner">
      <div class="center">
        <div class="section-label">By the Numbers</div>
        <h2 class="section-title">India's Most Trusted<br>Certification Authority</h2>
        <p class="section-sub">Powering product safety and quality assurance across every sector of the Indian economy.</p>
      </div>
      <div class="stats-grid">
        <div class="stat-card reveal"><span class="stat-icon">ğŸ†</span><span class="stat-num"><span class="acc">10,000</span>+</span><div class="stat-label">Certificates Processed</div></div>
        <div class="stat-card reveal rd1"><span class="stat-icon">ğŸ¯</span><span class="stat-num"><span class="acc">95</span>%</span><div class="stat-label">AI Validation Accuracy</div></div>
        <div class="stat-card reveal rd2"><span class="stat-icon">â±</span><span class="stat-num"><span class="acc">24</span>/7</span><div class="stat-label">Real-Time Monitoring</div></div>
        <div class="stat-card reveal rd3"><span class="stat-icon">ğŸ”</span><span class="stat-num"><span class="acc">2.4L</span>+</span><div class="stat-label">Active Licenses</div></div>
      </div>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="section" style="padding-top:20px">
    <div class="section-inner">
      <div style="max-width:540px;margin-bottom:48px">
        <div class="section-label">Core Capabilities</div>
        <h2 class="section-title">Four Pillars of<br>Smart Certification</h2>
        <p class="section-sub">Every layer of the certification process, reimagined with AI â€” from document to decision.</p>
      </div>
      <div class="features-grid">
        <div class="feat-card reveal" onclick="showPage('apply')" style="cursor:pointer">
          <div class="feat-icon-wrap"><span class="feat-icon">ğŸ“„</span></div>
          <span class="feat-num">Capability 01</span>
          <h3 class="feat-title">AI Document Verification</h3>
          <p class="feat-desc">OCR-powered extraction reads and validates test reports, certifications, and supporting PDFs automatically. Missing fields and inconsistencies are flagged instantly.</p>
          <div class="feat-tag"><span class="feat-tag-dot"></span> pytesseract + OpenCV</div>
        </div>
        <div class="feat-card reveal rd1" onclick="showPage('verify')" style="cursor:pointer">
          <div class="feat-icon-wrap"><span class="feat-icon">ğŸ”</span></div>
          <span class="feat-num">Capability 02</span>
          <h3 class="feat-title">CM/L License Validation</h3>
          <p class="feat-desc">Regex-based pattern matching validates every CM/L number against the BIS format. Counterfeit and malformed numbers are rejected before they reach the review queue.</p>
          <div class="feat-tag"><span class="feat-tag-dot"></span> Real-Time Regex Engine</div>
        </div>
        <div class="feat-card reveal rd2" onclick="showPage('dashboard')" style="cursor:pointer">
          <div class="feat-icon-wrap"><span class="feat-icon">ğŸ“Š</span></div>
          <span class="feat-num">Capability 03</span>
          <h3 class="feat-title">Dynamic Risk Scoring</h3>
          <p class="feat-desc">Each application receives a 0â€“100 compliance score computed from document completeness, license validity, expiry status, and applicant history. High-risk cases are auto-escalated.</p>
          <div class="feat-tag"><span class="feat-tag-dot"></span> ML Risk Model</div>
        </div>
        <div class="feat-card reveal rd3" onclick="showPage('verify')" style="cursor:pointer">
          <div class="feat-icon-wrap"><span class="feat-icon">ğŸ•µï¸</span></div>
          <span class="feat-num">Capability 04</span>
          <h3 class="feat-title">Counterfeit Detection</h3>
          <p class="feat-desc">Public users upload product images and receive an instant Trust Score. Our system cross-references the extracted CM/L against the live BIS database to catch fakes before they reach consumers.</p>
          <div class="feat-tag"><span class="feat-tag-dot"></span> Image OCR + DB Lookup</div>
        </div>
        <div class="feat-card wide reveal">
          <div>
            <span class="feat-num">The Intelligence Layer</span>
            <h3 class="feat-title" style="font-size:24px">One Platform. End-to-End Compliance.</h3>
            <p class="feat-desc" style="font-size:14px;margin-bottom:22px">From a manufacturer's first upload to a citizen's product scan, every touchpoint is automated, audited, and secured. BIS officers get a real-time dashboard with risk-ranked applications, expiry alerts, and analytics.</p>
            <div style="display:flex;gap:12px;flex-wrap:wrap">
              <div class="feat-tag"><span class="feat-tag-dot"></span> Flask + SQLite Backend</div>
              <div class="feat-tag"><span class="feat-tag-dot" style="background:#34d399"></span> Instant Decisions</div>
              <div class="feat-tag"><span class="feat-tag-dot" style="background:var(--accent)"></span> Zero Manual Entry</div>
            </div>
            <br><button class="btn-primary btn-sm" onclick="showPage('about')" style="margin-top:12px">Learn More About BIS â†’</button>
          </div>
          <div class="feature-visual">
            <div class="risk-bars">
              <div class="risk-bar"></div><div class="risk-bar"></div><div class="risk-bar"></div>
              <div class="risk-bar"></div><div class="risk-bar"></div><div class="risk-bar"></div>
            </div>
            <div style="position:absolute;bottom:12px;left:0;right:0;text-align:center;font-size:10.5px;color:rgba(255,255,255,.3);letter-spacing:.08em;text-transform:uppercase">Live Risk Distribution</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- PROCESS -->
  <section class="section process-wrap">
    <div class="section-inner">
      <div class="center" style="margin-bottom:52px">
        <div class="section-label">How It Works</div>
        <h2 class="section-title">From Application to Approval<br>in Four Steps</h2>
      </div>
      <div class="process-steps">
        <div class="p-step reveal"><div class="step-circle">ğŸ“¤<div class="step-num">1</div></div><div class="step-title">Submit Application</div><p class="step-desc">Manufacturer uploads company details, CM/L number, test reports, and specifications through the portal.</p></div>
        <div class="p-step reveal rd1"><div class="step-circle">ğŸ¤–<div class="step-num">2</div></div><div class="step-title">AI Analysis</div><p class="step-desc">OCR extracts PDF content. Regex validates CM/L. The risk engine scores the application across six parameters.</p></div>
        <div class="p-step reveal rd2"><div class="step-circle">ğŸ§‘â€ğŸ’¼<div class="step-num">3</div></div><div class="step-title">Officer Review</div><p class="step-desc">BIS officers review pre-scored applications via dashboard. High-risk cases are flagged for priority action.</p></div>
        <div class="p-step reveal rd3"><div class="step-circle">âœ…<div class="step-num">4</div></div><div class="step-title">Certification Issued</div><p class="step-desc">Approved certificates are recorded in the national database â€” verifiable by the public in seconds.</p></div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section">
    <div class="cta-card reveal">
      <div class="cta-badge">ğŸš€ Ready to Get Started?</div>
      <h2 class="cta-title">Join India's Smartest<br>Certification Platform</h2>
      <p class="cta-sub">Whether you're a manufacturer seeking BIS certification, a consumer verifying a product, or an officer managing compliance â€” the platform is built for you.</p>
      <div class="cta-btns">
        <button class="btn-primary" onclick="showPage('apply')">ğŸ­ Apply for Certification</button>
        <button class="btn-accent"  onclick="showPage('verify')">ğŸ” Verify a Product Now</button>
        <button class="btn-ghost"   onclick="showPage('contact')">ğŸ“ Contact BIS</button>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="footer-top">
      <div>
        <div class="brand-name" style="font-size:15px;margin-bottom:6px">Smart BIS Certification &amp; Product Intelligence Portal</div>
        <p class="footer-tagline">An AI-powered initiative by the Bureau of Indian Standards, Ministry of Consumer Affairs, Food &amp; Public Distribution, Government of India.</p>
      </div>
      <div class="footer-col">
        <h4>Portal</h4>
        <a onclick="showPage('apply')">Apply for Certification</a>
        <a onclick="showPage('verify')">Verify a Product</a>
        <a onclick="showPage('dashboard')">Officer Dashboard</a>
        <a onclick="showPage('standards')">Browse Standards</a>
      </div>
      <div class="footer-col">
        <h4>Organisation</h4>
        <a onclick="showPage('about')">About BIS</a>
        <a onclick="showPage('standards')">Hallmarking</a>
        <a onclick="showPage('standards')">ISI Mark Scheme</a>
        <a onclick="showPage('standards')">FMCS</a>
      </div>
      <div class="footer-col">
        <h4>Help &amp; Legal</h4>
        <a onclick="showPage('contact')">Contact Us</a>
        <a onclick="showPage('contact')">Grievance Redressal</a>
        <a onclick="toast('Privacy policy â€” Full version available at bis.gov.in','â„¹ï¸')">Privacy Policy</a>
        <a onclick="toast('RTI information available at bis.gov.in/rti','â„¹ï¸')">RTI</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p class="f-disclaimer"><strong style="color:rgba(255,255,255,.45)">Disclaimer:</strong> This portal is an AI-assisted prototype for BIS, developed under the Digital India initiative. All certification decisions are subject to review by authorised BIS officers under the BIS Act, 2016. Helpline: 1800-11-4000.</p>
      <div style="display:flex;align-items:center;gap:8px">
        <div class="tricolor-sm"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div>
        <span style="font-size:12px;color:var(--dim)">Â© 2025 BIS India</span>
      </div>
    </div>
  </footer>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APPLY PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-apply" class="page">
  <div class="page-header">
    <h1>ğŸ­ Manufacturer Certification Portal</h1>
    <p>Submit your product certification application with supporting documents. Our AI engine analyses your submission instantly.</p>
  </div>
  <div class="form-wrap">
    <div class="form-card">
      <div class="form-section-lbl">Company Information</div>
      <div class="form-row">
        <div class="form-group">
          <label>Company Name <span class="req">*</span></label>
          <input class="fc" id="a-company" type="text" placeholder="e.g. Reliance Industries Ltd.">
        </div>
        <div class="form-group">
          <label>GST Number <span class="req">*</span></label>
          <input class="fc" id="a-gst" type="text" placeholder="22AAAAA0000A1Z5" style="font-family:'Courier New',monospace">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Manufacturing State <span class="req">*</span></label>
          <select class="fc" id="a-state">
            <option value="">Select State</option>
            <option>Maharashtra</option><option>Tamil Nadu</option><option>Gujarat</option>
            <option>Karnataka</option><option>Rajasthan</option><option>Uttar Pradesh</option>
            <option>West Bengal</option><option>Delhi</option><option>Telangana</option><option>Kerala</option>
          </select>
        </div>
        <div class="form-group">
          <label>Applicant Type <span class="req">*</span></label>
          <select class="fc" id="a-type">
            <option value="">Select Type</option>
            <option value="existing">Existing Manufacturer</option>
            <option value="first">First-Time Applicant</option>
            <option value="renewal">License Renewal</option>
          </select>
        </div>
      </div>

      <div class="form-section-lbl" style="margin-top:8px">Product Details</div>
      <div class="form-row">
        <div class="form-group">
          <label>Product Category <span class="req">*</span></label>
          <select class="fc" id="a-category">
            <option value="">Select Category</option>
            <option>Electrical Equipment</option><option>Steel & Iron Products</option>
            <option>Cement</option><option>Pressure Cookers</option><option>Helmets</option>
            <option>Water Purifiers</option><option>LPG Cylinders</option>
            <option>LED Lights</option><option>Packaged Drinking Water</option><option>Medical Devices</option>
          </select>
        </div>
        <div class="form-group">
          <label>CM/L Number</label>
          <div style="background:rgba(240,165,0,0.08);border:1.5px dashed rgba(240,165,0,0.35);border-radius:10px;padding:14px 18px;display:flex;align-items:flex-start;gap:12px">
            <span style="font-size:22px;flex-shrink:0">ğŸ”</span>
            <div>
              <div style="font-size:13px;font-weight:600;color:#fbbf24;margin-bottom:4px">Auto-Generated Upon Officer Approval</div>
              <div style="font-size:12px;color:rgba(255,255,255,0.5);line-height:1.6">A unique CM/L number (format: CM/L-XXXXXXXXXX) will be automatically assigned and issued to you by the BIS officer once your application is reviewed and accepted. You do not need to enter this.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Expected Start of Production <span class="req">*</span></label>
          <input class="fc" id="a-issue" type="date" placeholder="When do you plan to start manufacturing?">
          <div class="form-hint">Estimated date manufacturing will begin</div>
        </div>
        <div class="form-group">
          <label>Annual Production Volume</label>
          <select class="fc" id="a-expiry">
            <option value="">Select Volume</option>
            <option value="small">Small â€” Under 10,000 units/year</option>
            <option value="medium">Medium â€” 10,000â€“1,00,000 units/year</option>
            <option value="large">Large â€” Over 1,00,000 units/year</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Product Specifications</label>
        <textarea class="fc" id="a-specs" placeholder="Describe key technical specifications, standards met (e.g. IS 302), materials, test conditions..."></textarea>
      </div>

      <div class="form-section-lbl" style="margin-top:8px">Document Upload</div>
      <div class="form-group">
        <label>Test Report (PDF) <span class="req">*</span></label>
        <div class="upload-zone" id="applyUploadZone">
          <input type="file" accept=".pdf" id="a-pdf" onchange="handleFile('a-pdf','applyUploadZone','applyFileLabel')">
          <div class="upload-icon">ğŸ“‹</div>
          <p><strong>Click to upload</strong> or drag &amp; drop your test report</p>
          <p style="margin-top:6px;font-size:12px;color:rgba(255,255,255,.3)">PDF only â€¢ Max 10MB</p>
        </div>
        <div id="applyFileLabel" style="display:none" class="form-hint"></div>
      </div>

      <button class="btn-submit" onclick="runApplyAnalysis()">âš¡ Submit &amp; Analyse Application</button>
    </div>

    <div class="spinner-wrap" id="applySpinner"><div class="spin"></div></div>
    <div id="applyResult"></div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     USER DASHBOARD PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-userdash" class="page">
  <div class="page-header">
    <h1>ğŸ“‹ My Applications</h1>
    <p>Track the status of your BIS certification applications in real time</p>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn-primary btn-sm" onclick="showPage('apply')">+ Submit New Application</button>
      <button class="btn-outline-white btn-sm" onclick="renderUserDash()">ğŸ”„ Refresh</button>
    </div>
  </div>
  <div class="dash-wrap">

    <!-- Empty state -->
    <div id="userDashEmpty" style="text-align:center;padding:60px 24px">
      <div style="font-size:64px;margin-bottom:20px;opacity:.4">ğŸ“­</div>
      <h3 style="font-family:'Playfair Display',serif;font-size:24px;margin-bottom:12px;color:rgba(255,255,255,.7)">No Applications Yet</h3>
      <p style="font-size:14px;color:var(--dim);margin-bottom:28px;max-width:400px;margin-left:auto;margin-right:auto">You haven't submitted any certification applications in this session. Submit your first application to get started.</p>
      <button class="btn-primary" onclick="showPage('apply')">ğŸ­ Apply for Certification</button>
    </div>

    <!-- Applications list (shown when there are submissions) -->
    <div id="userDashContent" style="display:none">

      <!-- Summary KPIs -->
      <div class="kpi-grid" style="margin-bottom:24px" id="userKpiGrid"></div>

      <!-- Application Cards -->
      <div id="userAppCards"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VERIFY PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-verify" class="page">
  <div class="page-header">
    <h1>ğŸ” Product Verification</h1>
    <p>Instantly verify if a product's BIS certification is genuine and active. Upload an image or enter the CM/L number manually.</p>
  </div>
  <div class="form-wrap" style="max-width:700px">
    <div class="form-card">
      <div class="form-section-lbl">Product Image Upload</div>
      <div class="form-group">
        <div class="upload-zone" id="verifyUploadZone">
          <input type="file" accept="image/*" id="v-img" onchange="handleFile('v-img','verifyUploadZone','verifyFileLabel')">
          <div class="upload-icon">ğŸ“¸</div>
          <p><strong>Upload product image</strong> with visible ISI / CM/L mark</p>
          <p style="margin-top:6px;font-size:12px;color:rgba(255,255,255,.3)">JPG, PNG, WEBP â€¢ Max 5MB</p>
        </div>
        <div id="verifyFileLabel" style="display:none" class="form-hint"></div>
      </div>
      <div style="text-align:center;margin:20px 0;font-size:13px;color:var(--dim)">â”€â”€â”€ OR enter CM/L manually â”€â”€â”€</div>
      <div class="form-row">
        <div class="form-group">
          <label>CM/L Number</label>
          <input class="fc" id="v-cml" type="text" placeholder="CM/L-XXXXXXXXXX" style="font-family:'Courier New',monospace">
        </div>
        <div class="form-group">
          <label>Product Category</label>
          <select class="fc" id="v-cat">
            <option value="">Select Category</option>
            <option>Electrical Equipment</option><option>Steel & Iron Products</option>
            <option>Helmets</option><option>Pressure Cookers</option><option>LED Lights</option>
            <option>Water Purifiers</option><option>Packaged Drinking Water</option>
          </select>
        </div>
      </div>
      <button class="btn-submit" onclick="runVerification()">ğŸ” Verify Product Now</button>
    </div>
    <div class="spinner-wrap" id="verifySpinner"><div class="spin"></div></div>
    <div id="verifyResult"></div>
  </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-dashboard" class="page">
  <div class="page-header">
    <h1>âš™ Officer Control Dashboard</h1>
    <p>Review submitted applications, issue decisions, and download official reports</p>
    <div style="margin-top:18px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn-primary btn-sm" onclick="refreshDash()">ğŸ”„ Refresh Data</button>
      <button class="btn-outline-white btn-sm" onclick="exportDashReport()">ğŸ“Š Export Summary</button>
      <button class="btn-outline-white btn-sm" onclick="filterHighRisk()">ğŸ”´ Filter High Risk</button>
    </div>
    <div style="display:flex;gap:6px;justify-content:center;margin-top:22px;flex-wrap:wrap">
      <button class="dash-tab active" id="tab-submitted" onclick="switchTab('submitted')">ğŸ“¥ Applications</button>
      <button class="dash-tab" id="tab-analytics" onclick="switchTab('analytics')">ğŸ“Š Analytics</button>
    </div>
  </div>
  <div class="dash-wrap">
    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-icon">ğŸ“‹</div><span class="kpi-num kpi-blue" id="kpi-total">1,284</span><div class="kpi-lbl">Total Applications</div></div>
      <div class="kpi-card"><div class="kpi-icon">ğŸ”´</div><span class="kpi-num kpi-red"  id="kpi-risk">47</span><div class="kpi-lbl">High-Risk Flagged</div></div>
      <div class="kpi-card"><div class="kpi-icon">â°</div><span class="kpi-num kpi-warn" id="kpi-exp">133</span><div class="kpi-lbl">Expired Licenses</div></div>
      <div class="kpi-card"><div class="kpi-icon">âœ…</div><span class="kpi-num kpi-green" id="kpi-app">1,019</span><div class="kpi-lbl">Approved</div></div>
    </div>

    <!-- TAB: APPLICATIONS -->
    <div id="tabpanel-submitted">
      <!-- Live apps submitted by user appear here -->
      <div class="dash-card" id="liveAppsCard" style="display:none">
        <div class="dash-card-title" style="color:#4ade80">ğŸ“¥ Newly Submitted â€” Awaiting Officer Decision</div>
        <div style="overflow-x:auto"><table>
          <thead><tr><th>App ID</th><th>CM/L No.</th><th>Company</th><th>Category</th><th>Score</th><th>Risk</th><th>Submitted</th><th>Actions</th></tr></thead>
          <tbody id="liveAppsTable"></tbody>
        </table></div>
      </div>

      <!-- Static sample apps -->
      <div class="dash-card">
        <div class="dash-card-title">All Applications</div>
        <div style="overflow-x:auto"><table>
          <thead><tr><th>App ID</th><th>CM/L No.</th><th>Company</th><th>Category</th><th>Score</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="dashTable">
            <tr>
              <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">BIS-44781234</td>
              <td style="font-family:'Courier New',monospace;font-size:11px">CM/L-7823456789</td>
              <td>Bosch India Ltd.</td><td>Electrical</td>
              <td><strong style="color:#4ade80">92</strong></td>
              <td><span class="badge bg-green">Accepted</span></td>
              <td><div style="display:flex;gap:6px;flex-wrap:wrap">
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="officerViewReport({id:'BIS-44781234',company:'Bosch India Ltd.',cml:'CM/L-7823456789',category:'Electrical Equipment',score:92,status:'accepted',risk:'Low Risk',gst:'27AAACB0958L1ZA',state:'Maharashtra',expiry:'2026-04-14',findings:['Test report uploaded','CM/L format valid','License active for 416 days','Existing manufacturer'],remarks:'Application meets all BIS requirements. CM/L verified against national registry.'})">ğŸ‘ View</button>
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="downloadOfficerReport({id:'BIS-44781234',company:'Bosch India Ltd.',cml:'CM/L-7823456789',category:'Electrical Equipment',score:92,status:'accepted',risk:'Low Risk'})">â¬‡ Report</button>
              </div></td>
            </tr>
            <tr>
              <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">BIS-44781235</td>
              <td style="font-family:'Courier New',monospace;font-size:11px">CM/L-4521000011</td>
              <td>Sun Polymers Pvt.</td><td>Helmets</td>
              <td><strong style="color:#fbbf24">61</strong></td>
              <td><span class="badge bg-warn" id="status-BIS-44781235">Pending</span></td>
              <td><div style="display:flex;gap:6px;flex-wrap:wrap">
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="officerViewReport({id:'BIS-44781235',company:'Sun Polymers Pvt.',cml:'CM/L-4521000011',category:'Helmets',score:61,status:'pending',risk:'Medium Risk',gst:'19AABCS8798M1ZP',state:'West Bengal',expiry:'2025-03-10',findings:['Test report uploaded','CM/L format valid','License expires in 12 days â€” renewal needed','First-time renewal applicant'],remarks:''})">ğŸ‘ View</button>
                <button class="btn-primary" style="padding:4px 10px;font-size:11px;border-radius:7px" onclick="officerDecide('BIS-44781235','Sun Polymers Pvt.',61,'CM/L-4521000011','Helmets')">âš– Decide</button>
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="downloadOfficerReport({id:'BIS-44781235',company:'Sun Polymers Pvt.',cml:'CM/L-4521000011',category:'Helmets',score:61,status:'pending',risk:'Medium Risk'})">â¬‡ Report</button>
              </div></td>
            </tr>
            <tr>
              <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">BIS-44781236</td>
              <td style="font-family:'Courier New',monospace;font-size:11px">CM/L-9913452200</td>
              <td>Alok Industries</td><td>Steel</td>
              <td><strong style="color:#f87171">32</strong></td>
              <td><span class="badge bg-red">Rejected</span></td>
              <td><div style="display:flex;gap:6px;flex-wrap:wrap">
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="officerViewReport({id:'BIS-44781236',company:'Alok Industries',cml:'CM/L-9913452200',category:'Steel',score:32,status:'rejected',risk:'High Risk',gst:'24AABCA7643Q1Z3',state:'Gujarat',expiry:'2023-11-01',findings:['Missing test report document','CM/L format invalid','License expired 450 days ago','First-time applicant'],remarks:'Application rejected: Expired license, missing documentation, invalid CM/L format. Re-apply after obtaining fresh CM/L from BIS regional office.'})">ğŸ‘ View</button>
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="downloadOfficerReport({id:'BIS-44781236',company:'Alok Industries',cml:'CM/L-9913452200',category:'Steel',score:32,status:'rejected',risk:'High Risk'})">â¬‡ Report</button>
              </div></td>
            </tr>
            <tr>
              <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">BIS-44781237</td>
              <td style="font-family:'Courier New',monospace;font-size:11px">CM/L-1023948760</td>
              <td>Havells India</td><td>LED Lights</td>
              <td><strong style="color:#4ade80">88</strong></td>
              <td><span class="badge bg-green">Accepted</span></td>
              <td><div style="display:flex;gap:6px;flex-wrap:wrap">
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="officerViewReport({id:'BIS-44781237',company:'Havells India',cml:'CM/L-1023948760',category:'LED Lights',score:88,status:'accepted',risk:'Low Risk',gst:'07AAACH1378L1ZV',state:'Delhi',expiry:'2027-01-20',findings:['Test report uploaded','CM/L format valid','License active for 698 days','Existing manufacturer with clean history'],remarks:'Approved. All documentation in order. License valid through Jan 2027.'})">ğŸ‘ View</button>
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="downloadOfficerReport({id:'BIS-44781237',company:'Havells India',cml:'CM/L-1023948760',category:'LED Lights',score:88,status:'accepted',risk:'Low Risk'})">â¬‡ Report</button>
              </div></td>
            </tr>
            <tr>
              <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">BIS-44781238</td>
              <td style="font-family:'Courier New',monospace;font-size:11px">CM/L-3312099087</td>
              <td>Sunrise Cement</td><td>Cement</td>
              <td><strong style="color:#f87171">44</strong></td>
              <td><span class="badge bg-warn" id="status-BIS-44781238">Pending</span></td>
              <td><div style="display:flex;gap:6px;flex-wrap:wrap">
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="officerViewReport({id:'BIS-44781238',company:'Sunrise Cement',cml:'CM/L-3312099087',category:'Cement',score:44,status:'pending',risk:'High Risk',gst:'08AADCS4521K1ZT',state:'Rajasthan',expiry:'2024-06-30',findings:['Missing test report document','CM/L format valid','License expired 235 days ago','First-time applicant'],remarks:''})">ğŸ‘ View</button>
                <button class="btn-primary" style="padding:4px 10px;font-size:11px;border-radius:7px" onclick="officerDecide('BIS-44781238','Sunrise Cement',44,'CM/L-3312099087','Cement')">âš– Decide</button>
                <button class="btn-outline-white" style="padding:4px 10px;font-size:11px" onclick="downloadOfficerReport({id:'BIS-44781238',company:'Sunrise Cement',cml:'CM/L-3312099087',category:'Cement',score:44,status:'pending',risk:'High Risk'})">â¬‡ Report</button>
              </div></td>
            </tr>
          </tbody>
        </table></div>
      </div>
    </div>

    <!-- TAB: ANALYTICS -->
    <div id="tabpanel-analytics" style="display:none">
      <div class="dash-grid">
        <div>
          <div class="dash-card">
            <div class="dash-card-title">Applications by Category</div>
            <div class="bar-chart-viz">
              <div class="bv-col"><div class="bv-val">312</div><div class="bv-fill" style="height:90%;background:linear-gradient(180deg,#60a5fa,#2563eb)"></div><div class="bv-lbl">Electrical</div></div>
              <div class="bv-col"><div class="bv-val">198</div><div class="bv-fill" style="height:56%;background:linear-gradient(180deg,#f0a500,#e09000)"></div><div class="bv-lbl">Steel</div></div>
              <div class="bv-col"><div class="bv-val">247</div><div class="bv-fill" style="height:70%;background:linear-gradient(180deg,#34d399,#059669)"></div><div class="bv-lbl">Helmets</div></div>
              <div class="bv-col"><div class="bv-val">89</div><div class="bv-fill" style="height:25%;background:linear-gradient(180deg,#a78bfa,#7c3aed)"></div><div class="bv-lbl">Cement</div></div>
              <div class="bv-col"><div class="bv-val">163</div><div class="bv-fill" style="height:46%;background:linear-gradient(180deg,#f87171,#dc2626)"></div><div class="bv-lbl">LED</div></div>
            </div>
          </div>
          <div class="dash-card">
            <div class="dash-card-title">ğŸš¨ Risk Alerts</div>
            <div class="alert-item a-red"><div class="a-dot a-dot-r"></div><div class="a-text">Alok Industries â€” Invalid CM/L format</div><div class="a-time">2h ago</div></div>
            <div class="alert-item a-red"><div class="a-dot a-dot-r"></div><div class="a-text">Sunrise Cement â€” Missing test report</div><div class="a-time">3h ago</div></div>
            <div class="alert-item a-warn"><div class="a-dot a-dot-w"></div><div class="a-text">Sun Polymers â€” License expires in 12 days</div><div class="a-time">5h ago</div></div>
            <div class="alert-item a-warn"><div class="a-dot a-dot-w"></div><div class="a-text">Ravi Tools â€” First-time applicant, pending</div><div class="a-time">7h ago</div></div>
          </div>
        </div>
        <div>
          <div class="dash-card">
            <div class="dash-card-title">Risk Distribution</div>
            <div class="risk-dist">
              <div class="rd-row"><div><span style="color:#4ade80;font-weight:600">ğŸŸ¢ Low Risk (80â€“100)</span><strong>79.4%</strong></div><div class="score-bar-wrap"><div class="score-bar bar-g" style="width:79.4%"></div></div></div>
              <div class="rd-row"><div><span style="color:#fbbf24;font-weight:600">ğŸŸ¡ Medium (50â€“79)</span><strong>13.9%</strong></div><div class="score-bar-wrap"><div class="score-bar bar-w" style="width:13.9%"></div></div></div>
              <div class="rd-row"><div><span style="color:#f87171;font-weight:600">ğŸ”´ High Risk (&lt;50)</span><strong>6.7%</strong></div><div class="score-bar-wrap"><div class="score-bar bar-r" style="width:6.7%"></div></div></div>
            </div>
            <div style="margin-top:18px"><button class="btn-primary btn-sm" style="width:100%;justify-content:center" onclick="exportDashReport()">ğŸ“ˆ Export Full Report</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• OFFICER REVIEW MODAL â•â•â•â•â•â•â•â•â•â• -->
<div id="officerModal" style="display:none;position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,0.78);backdrop-filter:blur(10px);overflow-y:auto;padding:40px 20px">
  <div style="max-width:720px;margin:0 auto;background:linear-gradient(135deg,#0a2747,#061529);border:1px solid rgba(255,255,255,0.15);border-radius:24px;padding:40px;position:relative;box-shadow:0 32px 80px rgba(0,0,0,0.7)">
    <button onclick="closeModal()" style="position:absolute;top:16px;right:20px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);color:#fff;border-radius:8px;padding:6px 14px;font-size:13px;cursor:pointer;transition:all .2s" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">âœ• Close</button>
    <div id="modalContent"></div>
  </div>
</div>
     ABOUT BIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-about" class="page">
  <div class="page-header">
    <h1>ğŸ› About Bureau of Indian Standards</h1>
    <p>India's national standards body â€” ensuring the quality, safety, and reliability of products and services since 1987</p>
  </div>
  <div class="content-wrap">
    <div class="content-card">
      <h2>What is BIS?</h2>
      <p>The Bureau of Indian Standards (BIS) is the National Standards Body of India working under the aegis of the Ministry of Consumer Affairs, Food and Public Distribution, Government of India. It was established by the Bureau of Indian Standards Act, 1986 and upgraded by the BIS Act, 2016.</p>
      <p>BIS is engaged in the preparation and implementation of Indian Standards, operation of product certification, hallmarking of gold/silver jewellery, laboratory testing, consumer affairs activities, and promotional training activities.</p>
    </div>
    <div class="content-card">
      <h2>Why AI-Powered Certification?</h2>
      <p>Traditional BIS certification processes involved manual document review, leading to weeks of processing delays, inconsistent judgments, and vulnerability to counterfeit CM/L numbers flooding the market.</p>
      <p>This AI-powered portal automates document extraction via OCR (pytesseract + OpenCV), validates CM/L format using regex, and computes a 0â€“100 risk score for every application â€” reducing average processing time from weeks to hours while improving accuracy to over 95%.</p>
      <p>BIS officers retain final decision authority, but AI pre-screening means they only review what matters most â€” high-risk, flagged, or borderline applications.</p>
    </div>
    <div class="content-card" style="margin-bottom:0">
      <h2>BIS at a Glance</h2>
      <div class="standards-grid">
        <div class="std-card"><div class="std-icon">ğŸ“</div><div class="std-title">Headquarters</div><div class="std-desc">Manak Bhavan, 9 Bahadur Shah Zafar Marg, New Delhi â€“ 110002</div></div>
        <div class="std-card"><div class="std-icon">ğŸ¢</div><div class="std-title">Regional Offices</div><div class="std-desc">8 Regional Offices across India: Delhi, Mumbai, Kolkata, Chennai, Chandigarh, Patna, Jaipur, Hyderabad</div></div>
        <div class="std-card"><div class="std-icon">ğŸ“š</div><div class="std-title">Standards Portfolio</div><div class="std-desc">Over 20,000 Indian Standards (IS) covering products, processes, services, and systems</div></div>
        <div class="std-card"><div class="std-icon">âš–ï¸</div><div class="std-title">Legal Framework</div><div class="std-desc">BIS Act, 2016 â€” provides mandatory certification for safety-critical product categories</div></div>
        <div class="std-card"><div class="std-icon">ğŸ¥‡</div><div class="std-title">ISI Mark</div><div class="std-desc">India's most trusted product quality mark â€” present on over 900 product categories</div></div>
        <div class="std-card"><div class="std-icon">ğŸ’›</div><div class="std-title">Hallmarking</div><div class="std-desc">BIS Hallmarking ensures purity of gold and silver jewellery for consumer protection</div></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STANDARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-standards" class="page">
  <div class="page-header">
    <h1>ğŸ“‹ Indian Standards Portfolio</h1>
    <p>Explore BIS certification schemes, mandatory product categories, and IS standards across sectors</p>
  </div>
  <div class="content-wrap">
    <div class="content-card">
      <h2>Certification Schemes</h2>
      <p>BIS operates multiple conformity assessment schemes to ensure products meet Indian Standards before they reach consumers.</p>
    </div>
    <div class="standards-grid" style="margin-bottom:22px">
      <div class="std-card" onclick="toast('ISI Mark scheme details â€” bis.gov.in/product-certification','ğŸ“‹')" style="cursor:pointer">
        <div class="std-icon">â­</div>
        <div class="std-title">ISI Mark (Product Certification)</div>
        <div class="std-desc">Voluntary/mandatory certification for 900+ product categories including electrical goods, cement, steel, and more.</div>
      </div>
      <div class="std-card" onclick="toast('FMCS scheme covers imported products â€” bis.gov.in/fmcs','ğŸŒ')" style="cursor:pointer">
        <div class="std-icon">ğŸŒ</div>
        <div class="std-title">FMCS (Foreign Manufacturers)</div>
        <div class="std-desc">Foreign Manufacturers Certification Scheme for overseas manufacturers exporting to India.</div>
      </div>
      <div class="std-card" onclick="toast('Hallmarking centres search â€” bis.gov.in/hallmarking','ğŸ’›')" style="cursor:pointer">
        <div class="std-icon">ğŸ’›</div>
        <div class="std-title">Hallmarking</div>
        <div class="std-desc">Mandatory BIS hallmarking of gold jewellery ensures consumers get authentic karatage and purity.</div>
      </div>
      <div class="std-card" onclick="toast('CRS for Electronics â€” bis.gov.in/crs','ğŸ”Œ')" style="cursor:pointer">
        <div class="std-icon">ğŸ”Œ</div>
        <div class="std-title">CRS (Electronics)</div>
        <div class="std-desc">Compulsory Registration Scheme for electronics and IT products â€” self-declaration model with lab testing.</div>
      </div>
      <div class="std-card" onclick="toast('ECO Mark for eco-friendly products â€” bis.gov.in/eco-mark','ğŸŒ¿')" style="cursor:pointer">
        <div class="std-icon">ğŸŒ¿</div>
        <div class="std-title">ECO Mark</div>
        <div class="std-desc">Voluntary eco-labelling scheme for products with reduced environmental impact across their lifecycle.</div>
      </div>
      <div class="std-card" onclick="toast('Management systems certification â€” bis.gov.in/mss','ğŸ­')" style="cursor:pointer">
        <div class="std-icon">ğŸ­</div>
        <div class="std-title">Management Systems</div>
        <div class="std-desc">Certification for Quality (IS/ISO 9001), Environmental (IS/ISO 14001), and Food Safety management systems.</div>
      </div>
    </div>
    <div class="content-card" style="margin-bottom:0">
      <h2>Key Mandatory Categories</h2>
      <p>The following product categories require mandatory BIS certification before sale in India:</p>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:16px">
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">âš¡ Electrical Wires &amp; Cables</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ— Portland Cement</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸª– Protective Helmets</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ”© Steel Bars &amp; Wires</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ’¡ LED Lamps &amp; Drivers</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ¼ Packaged Drinking Water</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ”¥ Pressure Cookers</div>
        <div style="background:rgba(255,255,255,.05);padding:12px 16px;border-radius:10px;font-size:13.5px">ğŸ¥ Medical Devices</div>
      </div>
      <div style="margin-top:22px"><button class="btn-primary btn-sm" onclick="showPage('apply')">Apply for Certification â†’</button></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CONTACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-contact" class="page">
  <div class="page-header">
    <h1>ğŸ“ Contact BIS</h1>
    <p>Reach out to the Bureau of Indian Standards for certification queries, grievances, or general assistance</p>
  </div>
  <div class="content-wrap">
    <div class="content-card">
      <h2>Get In Touch</h2>
      <div class="contact-grid">
        <div class="contact-item"><span class="c-icon">ğŸ“</span><div><div class="c-label">Helpline</div><div class="c-val">1800-11-4000</div></div></div>
        <div class="contact-item"><span class="c-icon">ğŸ“§</span><div><div class="c-label">Email</div><div class="c-val"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e1838892828e8f8f848295a1838892cf868e97cf888f">[email&#160;protected]</a></div></div></div>
        <div class="contact-item"><span class="c-icon">ğŸŒ</span><div><div class="c-label">Website</div><div class="c-val">www.bis.gov.in</div></div></div>
        <div class="contact-item"><span class="c-icon">ğŸ“</span><div><div class="c-label">Headquarters</div><div class="c-val">Manak Bhavan, New Delhi â€“ 110002</div></div></div>
        <div class="contact-item"><span class="c-icon">â°</span><div><div class="c-label">Working Hours</div><div class="c-val">Monâ€“Fri, 9:00 AM â€“ 5:30 PM IST</div></div></div>
        <div class="contact-item"><span class="c-icon">ğŸ†˜</span><div><div class="c-label">Grievances</div><div class="c-val">pgportal.gov.in</div></div></div>
      </div>
    </div>
    <div class="content-card">
      <h2>Send a Message</h2>
      <div class="form-row" style="margin-top:8px">
        <div class="form-group"><label>Your Name</label><input class="fc" id="c-name" type="text" placeholder="Full name"></div>
        <div class="form-group"><label>Email</label><input class="fc" id="c-email" type="email" placeholder="your@email.com"></div>
      </div>
      <div class="form-group"><label>Subject</label>
        <select class="fc" id="c-subject">
          <option>General Enquiry</option>
          <option>Certification Application</option>
          <option>License Renewal</option>
          <option>Product Complaint</option>
          <option>Technical Support</option>
          <option>Grievance</option>
        </select>
      </div>
      <div class="form-group"><label>Message</label><textarea class="fc" id="c-msg" style="min-height:130px" placeholder="Describe your query in detail..."></textarea></div>
      <button class="btn-submit" onclick="submitContact()">ğŸ“¤ Send Message</button>
    </div>

    <div class="content-card" style="margin-bottom:0">
      <h2>Regional Offices</h2>
      <div class="standards-grid">
        <div class="std-card" onclick="toast('Northern Region: BIS, Plot 4, Sector 27C, Chandigarh â€” 0172-2657796','ğŸ“')"><div class="std-icon">ğŸ™</div><div class="std-title">Northern Region</div><div class="std-desc">Chandigarh â€” covers Punjab, Haryana, HP, J&K, Uttarakhand</div></div>
        <div class="std-card" onclick="toast('Western Region: BIS, C.I.T. Campus, Kalina, Mumbai â€” 022-26523652','ğŸ“')"><div class="std-icon">ğŸŒŠ</div><div class="std-title">Western Region</div><div class="std-desc">Mumbai â€” covers Maharashtra, Goa, Gujarat, MP, Chhattisgarh</div></div>
        <div class="std-card" onclick="toast('Southern Region: BIS, IV Cross Road, CIT Campus, Chennai â€” 044-22541989','ğŸ“')"><div class="std-icon">ğŸŒ´</div><div class="std-title">Southern Region</div><div class="std-desc">Chennai â€” covers Tamil Nadu, Kerala, Karnataka, AP, Telangana</div></div>
        <div class="std-card" onclick="toast('Eastern Region: BIS, Plot 1/5, Block EP, Salt Lake, Kolkata â€” 033-23378937','ğŸ“')"><div class="std-icon">ğŸ¯</div><div class="std-title">Eastern Region</div><div class="std-desc">Kolkata â€” covers WB, Odisha, Bihar, Jharkhand, NE states</div></div>
        <div class="std-card" onclick="toast('Headquarters: Manak Bhavan, 9 BSZ Marg, New Delhi â€” 011-23230131','ğŸ“')"><div class="std-icon">ğŸ›</div><div class="std-title">Headquarters</div><div class="std-desc">New Delhi â€” HQ and Central Government liaison</div></div>
        <div class="std-card" onclick="toast('Jaipur Branch: BIS, Jaipur House, MI Road, Jaipur â€” 0141-2385529','ğŸ“')"><div class="std-icon">ğŸ°</div><div class="std-title">Jaipur Branch</div><div class="std-desc">Jaipur â€” covers Rajasthan and surrounding areas</div></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GREEN INTELLIGENCE PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-green" class="page">
  <div class="page-header" style="background:linear-gradient(180deg,rgba(6,21,41,0) 0%,rgba(6,21,41,0) 100%)">
    <div style="display:inline-flex;align-items:center;gap:10px;background:rgba(34,197,94,0.12);border:1px solid rgba(34,197,94,0.3);backdrop-filter:blur(10px);padding:8px 20px;border-radius:40px;font-size:11.5px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:#4ade80;margin-bottom:20px">
      <span style="width:6px;height:6px;border-radius:50%;background:#4ade80;animation:blink 2s ease-in-out infinite;display:inline-block"></span>
      AI-Powered â€¢ BIS Environmental Compliance Engine
    </div>
    <h1 style="background:linear-gradient(135deg,#4ade80 0%,#86efac 40%,#22d3ee 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">ğŸŒ¿ Green Intelligence Portal</h1>
    <p>Submit product data for AI-powered sustainability scoring, carbon footprint estimation, ECO-Mark eligibility, and engineering improvement recommendations</p>
  </div>

  <div class="content-wrap" style="max-width:1100px">

    <!-- Input Form -->
    <div class="content-card" style="border-color:rgba(74,222,128,0.2)">
      <h2 style="color:#4ade80;font-family:'Playfair Display',serif">ğŸ“‹ Product Sustainability Data</h2>
      <p style="font-size:13px;color:var(--dim);margin-bottom:24px">Fill in your product's environmental parameters. The AI engine will compute scores using official BIS weighted formulas.</p>

      <div class="form-row">
        <div class="form-group">
          <label>ğŸ­ Company Name</label>
          <input class="fc" id="g-company" type="text" placeholder="e.g. Bosch India Ltd.">
        </div>
        <div class="form-group">
          <label>ğŸ“¦ Product Name / Category</label>
          <input class="fc" id="g-product" type="text" placeholder="e.g. LED Driver 40W">
        </div>
      </div>

      <div style="background:rgba(74,222,128,0.05);border:1px solid rgba(74,222,128,0.15);border-radius:14px;padding:22px;margin-bottom:22px">
        <div style="font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#4ade80;margin-bottom:16px">âš¡ Energy & Emissions Parameters</div>
        <div class="form-row">
          <div class="form-group">
            <label>Electricity Consumption (kWh/unit)</label>
            <input class="fc" id="g-elec" type="number" step="0.1" min="0" placeholder="e.g. 2.5">
          </div>
          <div class="form-group">
            <label>Transport Distance (km)</label>
            <input class="fc" id="g-dist" type="number" min="0" placeholder="e.g. 450">
          </div>
          <div class="form-group">
            <label>Fuel Usage (litres/unit)</label>
            <input class="fc" id="g-fuel" type="number" step="0.01" min="0" placeholder="e.g. 0.8">
          </div>
          <div class="form-group">
            <label>Annual Production Volume (units)</label>
            <input class="fc" id="g-volume" type="number" min="1" placeholder="e.g. 50000">
          </div>
        </div>
      </div>

      <div style="background:rgba(34,211,238,0.05);border:1px solid rgba(34,211,238,0.15);border-radius:14px;padding:22px;margin-bottom:22px">
        <div style="font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#22d3ee;margin-bottom:16px">â™» Material & Compliance Parameters</div>
        <div class="form-row">
          <div class="form-group">
            <label>Energy Efficiency Rating (0â€“5)</label>
            <select class="fc" id="g-eer">
              <option value="">Select Rating</option>
              <option value="5">5 â€” Excellent (e.g. BEE 5-star)</option>
              <option value="4">4 â€” Very Good</option>
              <option value="3">3 â€” Good</option>
              <option value="2">2 â€” Average</option>
              <option value="1">1 â€” Below Average</option>
              <option value="0">0 â€” Poor</option>
            </select>
          </div>
          <div class="form-group">
            <label>Recyclability (%)</label>
            <input class="fc" id="g-recycle" type="number" min="0" max="100" placeholder="e.g. 75">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Hazardous Material Usage</label>
            <select class="fc" id="g-hazard">
              <option value="">Select Level</option>
              <option value="none">None (100 pts)</option>
              <option value="low">Low (75 pts)</option>
              <option value="moderate">Moderate (40 pts)</option>
              <option value="high">High (10 pts)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Waste Management Compliance</label>
            <select class="fc" id="g-waste">
              <option value="">Select Status</option>
              <option value="full">Fully Compliant (100 pts)</option>
              <option value="partial">Partially Compliant (60 pts)</option>
              <option value="non">Non-Compliant (20 pts)</option>
            </select>
          </div>
        </div>
      </div>

      <button class="btn-submit" id="greenSubmitBtn" onclick="runGreenAnalysis()" style="background:linear-gradient(135deg,#16a34a,#15803d);box-shadow:0 4px 20px rgba(22,163,74,0.4)">
        ğŸŒ¿ Generate Green Intelligence Report
      </button>
    </div>

    <!-- Spinner -->
    <div id="greenSpinner" class="spinner-wrap" style="display:none">
      <div class="spin" style="border-top-color:#4ade80 !important"></div>
      <div style="margin-top:14px;font-size:13px;color:#4ade80">AI Engine computing sustainability scoresâ€¦</div>
    </div>

    <!-- Result -->
    <div id="greenResult"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JS ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBAL STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const pages = ['home','apply','verify','userdash','dashboard','about','standards','contact','green'];
let submittedApps = []; // live submissions from current session
let filteringHighRisk = false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE ROUTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showPage(id) {
  pages.forEach(p => {
    document.getElementById('page-'+p).classList.toggle('active', p === id);
    const btn = document.getElementById('nav-'+p);
    if (btn) btn.classList.toggle('active', p === id);
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
  if (id === 'apply')     { document.getElementById('applyResult').innerHTML = ''; }
  if (id === 'verify')    { document.getElementById('verifyResult').innerHTML = ''; }
  if (id === 'dashboard') { renderLiveApps(); }
  if (id === 'userdash')  { renderUserDash(); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('scroll', () => {
  document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 40);
});
function toggleMenu() { document.getElementById('navLinks').classList.toggle('open'); }
function closeMenu()  { document.getElementById('navLinks').classList.remove('open'); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL REVEAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const observer = new IntersectionObserver(entries =>
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('in'); }), { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function toast(msg, icon = 'âœ…') {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  document.getElementById('toastIcon').textContent = icon;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3600);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILE UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleFile(inputId, zoneId, labelId) {
  const file = document.getElementById(inputId).files[0];
  if (!file) return;
  const zone = document.getElementById(zoneId);
  zone.style.borderColor = '#22c55e';
  zone.style.background  = 'rgba(34,197,94,0.06)';
  const lbl = document.getElementById(labelId);
  lbl.style.display = 'block';
  lbl.style.color   = '#4ade80';
  lbl.innerHTML = `âœ… Uploaded: <strong>${file.name}</strong> (${(file.size/1024).toFixed(1)} KB)`;
  toast(`File uploaded: ${file.name}`, 'ğŸ“');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VALIDATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function validateCML(cml) { return /^CM\/L-\d{10}$/.test((cml||'').trim()); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RISK SCORING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function computeScore({ cml, expiry, hasDoc, appType, category, specs }) {
  let score = 100;
  const findings = [];
  if (hasDoc) {
    findings.push({ t:'ok',  m:'Test report document uploaded successfully' });
  } else {
    score -= 20;
    findings.push({ t:'err', m:'Missing test report document (-20 pts)' });
  }
  // CM/L is no longer submitted by applicant â€” assigned by officer on acceptance
  findings.push({ t:'ok', m:'CM/L number will be auto-generated by BIS officer upon acceptance' });
  if (expiry) {
    const today = new Date(); const exp = new Date(expiry);
    if (exp < today) {
      score -= 40;
      findings.push({ t:'err', m:`License expired ${Math.floor((today-exp)/86400000)} day(s) ago (-40 pts)` });
    } else {
      const d = Math.floor((exp-today)/86400000);
      if (d < 30) findings.push({ t:'warn', m:`License expires in ${d} days â€” renewal recommended` });
      else        findings.push({ t:'ok',   m:`License valid for ${d} more days` });
    }
  } else {
    score -= 10;
    findings.push({ t:'warn', m:'No expiry date provided (-10 pts)' });
  }
  if (appType === 'first') {
    score -= 10;
    findings.push({ t:'warn', m:'First-time applicant â€” additional scrutiny applied (-10 pts)' });
  } else if (appType) {
    findings.push({ t:'ok', m:`Application type: ${appType === 'renewal' ? 'License Renewal' : 'Existing Manufacturer'}` });
  }
  if (!category) {
    score -= 5; findings.push({ t:'warn', m:'Product category not specified (-5 pts)' });
  } else { findings.push({ t:'ok', m:`Category verified: ${category}` }); }
  if (specs && specs.trim().length > 80) {
    findings.push({ t:'ok', m:'Product specifications â€” complete and detailed' });
  } else {
    findings.push({ t:'warn', m:'Specifications are minimal â€” more detail recommended' });
  }
  return { score: Math.max(0, Math.min(100, score)), findings };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF GENERATION (pure JS â€” no library needed)
   Generates a minimal but valid PDF as a Blob
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildReportHTML(app) {
  const scoreColor  = app.score >= 80 ? '#16a34a' : app.score >= 50 ? '#d97706' : '#dc2626';
  const statusEmoji = app.status === 'accepted' ? 'âœ… ACCEPTED' : app.status === 'rejected' ? 'âŒ REJECTED' : 'â³ PENDING REVIEW';
  const statusBg    = app.status === 'accepted' ? '#16a34a' : app.status === 'rejected' ? '#dc2626' : '#d97706';
  const isAccepted  = app.status === 'accepted';
  const date = new Date().toLocaleDateString('en-IN', { day:'2-digit', month:'long', year:'numeric' });
  const time = new Date().toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit' });

  const findingsRows = (app.findings || []).map(f => {
    const icon = f.t === 'ok' ? 'âœ“' : f.t === 'warn' ? 'âš ' : 'âœ—';
    const col  = f.t === 'ok' ? '#15803d' : f.t === 'warn' ? '#92400e' : '#991b1b';
    const bg   = f.t === 'ok' ? '#f0fdf4' : f.t === 'warn' ? '#fffbeb' : '#fef2f2';
    return `<tr style="background:${bg}"><td style="color:${col};font-weight:700;width:24px;padding:8px 12px">${icon}</td><td style="color:#1e293b;padding:8px 12px;font-size:13px">${f.m || f}</td></tr>`;
  }).join('');

  /* â”€â”€ SVG Signatures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  // Regional Officer â€” flowing cursive "R K Sharma"
  const sigRegional = `<svg xmlns="http://www.w3.org/2000/svg" width="180" height="56" viewBox="0 0 180 56">
    <path d="M12,38 C18,22 26,16 34,20 C40,23 38,34 30,36 C24,37 22,30 28,27 M34,20 C42,14 52,32 48,40"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M56,18 C58,28 57,38 60,42 M52,30 C60,28 68,24 72,28 C76,32 72,40 68,42"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M82,20 C84,32 82,40 84,44 M80,30 C88,26 96,24 98,30 C100,36 96,44 92,46"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M108,24 C112,20 120,18 124,22 C128,26 126,34 120,36 C114,38 110,32 114,28 C118,24 126,26 130,32 C134,38 132,46 128,48"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M138,26 C140,20 148,18 152,22 C156,26 154,36 148,40 C144,43 140,40 142,36"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M158,24 C160,30 162,36 164,44 M158,32 C164,28 170,28 172,34"
      fill="none" stroke="#1e3a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;

  // Director General â€” bolder flowing "A P Singh"
  const sigDG = `<svg xmlns="http://www.w3.org/2000/svg" width="180" height="56" viewBox="0 0 180 56">
    <path d="M10,42 C16,28 20,18 28,16 C36,14 38,28 30,36 C24,42 16,40 18,34 M28,16 C36,10 46,16 44,28"
      fill="none" stroke="#1e3a6e" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M52,16 C54,28 53,38 56,44 M50,28 C58,24 66,22 70,28 C74,34 70,44 62,46 C56,48 52,44 54,40"
      fill="none" stroke="#1e3a6e" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M82,14 C86,28 84,42 88,46 M82,30 C90,26 100,26 104,32 C108,38 104,48 96,50"
      fill="none" stroke="#1e3a6e" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M116,22 C118,16 126,14 132,18 C138,24 136,36 128,40 C120,44 114,38 118,32"
      fill="none" stroke="#1e3a6e" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M144,20 C146,30 148,40 150,48 M142,30 C150,26 158,26 162,32 C166,38 162,46 156,48"
      fill="none" stroke="#1e3a6e" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
    <line x1="8" y1="52" x2="48" y2="52" stroke="#1e3a6e" stroke-width="1" opacity="0.4"/>
    <line x1="110" y1="52" x2="172" y2="52" stroke="#1e3a6e" stroke-width="1" opacity="0.4"/>
  </svg>`;

  /* â”€â”€ BIS Official Circular Seal SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const bisSeal = `<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120">
    <!-- Outer ring -->
    <circle cx="60" cy="60" r="57" fill="none" stroke="#1554b0" stroke-width="3"/>
    <circle cx="60" cy="60" r="50" fill="none" stroke="#1554b0" stroke-width="1"/>
    <!-- Inner filled circle -->
    <circle cx="60" cy="60" r="44" fill="#eef4ff"/>
    <!-- Ashoka Chakra spokes (24 spokes) -->
    ${Array.from({length:24},(_,i)=>{
      const a = (i*15-90)*Math.PI/180;
      const x1=60+16*Math.cos(a), y1=60+16*Math.sin(a);
      const x2=60+32*Math.cos(a), y2=60+32*Math.sin(a);
      return `<line x1="${x1.toFixed(1)}" y1="${y1.toFixed(1)}" x2="${x2.toFixed(1)}" y2="${y2.toFixed(1)}" stroke="#1554b0" stroke-width="1.2"/>`;
    }).join('')}
    <!-- Chakra outer ring -->
    <circle cx="60" cy="60" r="33" fill="none" stroke="#1554b0" stroke-width="1.8"/>
    <circle cx="60" cy="60" r="15" fill="none" stroke="#1554b0" stroke-width="1.5"/>
    <!-- BIS text in centre -->
    <text x="60" y="64" text-anchor="middle" font-family="Arial" font-weight="900" font-size="13" fill="#0a2747">BIS</text>
    <!-- Circular text â€” top arc: BUREAU OF INDIAN STANDARDS -->
    <defs>
      <path id="topArc" d="M 8,60 A 52,52 0 0,1 112,60"/>
      <path id="botArc" d="M 15,75 A 52,52 0 0,0 105,75"/>
    </defs>
    <text font-family="Arial" font-weight="700" font-size="7.5" fill="#1554b0" letter-spacing="1.8">
      <textPath href="#topArc" startOffset="4%">BUREAU OF INDIAN STANDARDS</textPath>
    </text>
    <text font-family="Arial" font-weight="600" font-size="7" fill="#1554b0" letter-spacing="1.2">
      <textPath href="#botArc" startOffset="8%">GOVT. OF INDIA â€¢ BIS ACT 2016</textPath>
    </text>
    <!-- Star decorators -->
    <text x="60" y="19" text-anchor="middle" font-size="7" fill="#f0a500">â˜…</text>
    <text x="60" y="107" text-anchor="middle" font-size="7" fill="#f0a500">â˜…</text>
  </svg>`;

  /* â”€â”€ Certificate / Signature block (accepted only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const certBlock = isAccepted ? `
    <div style="page-break-before:always;margin-top:40px;border:3px double #1554b0;border-radius:16px;padding:36px 40px;background:linear-gradient(135deg,#f0f7ff 0%,#fff 50%,#f0f7ff 100%);position:relative;overflow:hidden">
      <!-- Corner ornaments -->
      <div style="position:absolute;top:10px;left:10px;width:40px;height:40px;border-top:3px solid #f0a500;border-left:3px solid #f0a500;border-radius:4px 0 0 0"></div>
      <div style="position:absolute;top:10px;right:10px;width:40px;height:40px;border-top:3px solid #f0a500;border-right:3px solid #f0a500;border-radius:0 4px 0 0"></div>
      <div style="position:absolute;bottom:10px;left:10px;width:40px;height:40px;border-bottom:3px solid #f0a500;border-left:3px solid #f0a500;border-radius:0 0 0 4px"></div>
      <div style="position:absolute;bottom:10px;right:10px;width:40px;height:40px;border-bottom:3px solid #f0a500;border-right:3px solid #f0a500;border-radius:0 0 4px 0"></div>

      <!-- Watermark -->
      <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-35deg);font-size:80px;font-weight:900;color:rgba(21,84,176,0.04);white-space:nowrap;pointer-events:none;font-family:Arial">CERTIFIED</div>

      <!-- Header -->
      <div style="text-align:center;margin-bottom:28px">
        <div style="font-size:10px;letter-spacing:.18em;text-transform:uppercase;color:#64748b;margin-bottom:6px">Bureau of Indian Standards</div>
        <div style="font-size:22px;font-weight:800;color:#0a2747;font-family:'Georgia',serif;letter-spacing:.02em">Certificate of Conformity</div>
        <div style="height:3px;width:80px;background:linear-gradient(90deg,#ff9933,#fff,#138808);margin:10px auto 0;border-radius:2px"></div>
      </div>

      <div style="text-align:center;font-size:13.5px;color:#475569;line-height:1.8;margin-bottom:28px">
        This is to certify that the certification application submitted by<br>
        <strong style="font-size:16px;color:#0a2747">${app.company}</strong><br>
        for product category <strong>${app.category}</strong> bearing CM/L No. <strong style="font-family:'Courier New',monospace">${app.cml}</strong><br>
        has been duly examined and <strong style="color:#16a34a">ACCEPTED</strong> by the Bureau of Indian Standards.<br>
        The applicant is granted certification status under the <strong>BIS Act, 2016</strong>.
      </div>

      <!-- Ref details strip -->
      <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:14px 20px;display:flex;justify-content:space-around;text-align:center;margin-bottom:32px;flex-wrap:wrap;gap:10px">
        <div><div style="font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#94a3b8;margin-bottom:4px">Application ID</div><div style="font-family:'Courier New',monospace;font-size:13px;font-weight:700;color:#0a2747">${app.id}</div></div>
        <div><div style="font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#94a3b8;margin-bottom:4px">Issue Date</div><div style="font-size:13px;font-weight:700;color:#0a2747">${date}</div></div>
        <div><div style="font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#94a3b8;margin-bottom:4px">Compliance Score</div><div style="font-size:13px;font-weight:700;color:#16a34a">${app.score}/100</div></div>
        <div><div style="font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#94a3b8;margin-bottom:4px">Valid Through</div><div style="font-size:13px;font-weight:700;color:#0a2747">${app.expiry || 'â€”'}</div></div>
      </div>

      <!-- Signatures row -->
      <div style="display:flex;justify-content:space-between;align-items:flex-end;margin-top:8px;gap:20px;flex-wrap:wrap">

        <!-- Regional Officer -->
        <div style="flex:1;min-width:180px;text-align:center">
          <div style="margin-bottom:4px;display:flex;justify-content:center">${sigRegional}</div>
          <div style="height:1px;background:linear-gradient(90deg,transparent,#1e3a6e,transparent);margin:0 10px 10px"></div>
          <div style="font-size:13px;font-weight:700;color:#0a2747">Shri R. K. Sharma</div>
          <div style="font-size:11px;color:#64748b;margin-top:2px">Regional Officer</div>
          <div style="font-size:10.5px;color:#94a3b8">BIS Northern Regional Office</div>
          <div style="font-size:10px;color:#94a3b8;margin-top:2px;font-family:'Courier New',monospace">Off. ID: BIS/RO/NR/2024/047</div>
        </div>

        <!-- BIS Seal (centre) -->
        <div style="text-align:center;flex-shrink:0">
          ${bisSeal}
          <div style="font-size:9px;color:#94a3b8;margin-top:6px;letter-spacing:.08em;text-transform:uppercase">Official Seal</div>
        </div>

        <!-- Director General -->
        <div style="flex:1;min-width:180px;text-align:center">
          <div style="margin-bottom:4px;display:flex;justify-content:center">${sigDG}</div>
          <div style="height:1px;background:linear-gradient(90deg,transparent,#1e3a6e,transparent);margin:0 10px 10px"></div>
          <div style="font-size:13px;font-weight:700;color:#0a2747">Shri A. P. Singh, IAS</div>
          <div style="font-size:11px;color:#64748b;margin-top:2px">Director General</div>
          <div style="font-size:10.5px;color:#94a3b8">Bureau of Indian Standards</div>
          <div style="font-size:10px;color:#94a3b8;margin-top:2px;font-family:'Courier New',monospace">Off. ID: BIS/DG/HQ/2024/001</div>
        </div>
      </div>

      <div style="margin-top:24px;padding-top:16px;border-top:1px dashed #e2e8f0;font-size:10px;color:#94a3b8;text-align:center;line-height:1.7">
        This certificate is issued under the authority of the Bureau of Indian Standards Act, 2016 (BIS Act).<br>
        Verify authenticity at <strong>bis.gov.in/certificate-verify</strong> using Application ID <strong>${app.id}</strong> | Helpline: 1800-11-4000
      </div>
    </div>` : '';

  return `<!DOCTYPE html>
<html>
<head><meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;margin:0;padding:0;background:#f8fafc;color:#1e293b}
  .page{width:210mm;min-height:297mm;margin:0 auto;background:#fff;padding:0}
  .header{background:linear-gradient(135deg,#0a2747,#1554b0);color:#fff;padding:32px 40px;display:flex;justify-content:space-between;align-items:center}
  .logo-area{display:flex;align-items:center;gap:16px}
  .logo-circle{width:60px;height:60px;border-radius:50%;border:2px solid rgba(255,255,255,.4);background:rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;color:#fff}
  .header-title{font-size:18px;font-weight:800;letter-spacing:.06em;text-transform:uppercase;line-height:1.2}
  .header-sub{font-size:11px;opacity:.7;margin-top:3px}
  .tricolor-h{width:52px;height:4px;background:linear-gradient(90deg,#ff9933 33.3%,#fff 33.3% 66.6%,#138808 66.6%);margin-top:7px;border-radius:2px}
  .stamp-area{text-align:right}
  .stamp{background:${statusBg};color:#fff;padding:10px 24px;border-radius:8px;font-size:13px;font-weight:800;letter-spacing:.06em;display:inline-block}
  .ref{font-size:11px;opacity:.7;margin-top:8px}
  .body{padding:32px 40px}
  .section-title{font-size:11.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:#64748b;border-bottom:2px solid #e2e8f0;padding-bottom:8px;margin:24px 0 14px}
  table.info{width:100%;border-collapse:collapse}
  table.info td{padding:9px 14px;font-size:13.5px;border-bottom:1px solid #f1f5f9}
  table.info td:first-child{font-weight:600;color:#475569;width:40%;background:#f8fafc}
  table.info td:last-child{font-family:'Courier New',monospace;font-size:13px}
  .score-box{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px 24px;display:flex;align-items:center;gap:24px;margin:14px 0}
  .score-circle{width:80px;height:80px;border-radius:50%;border:5px solid ${scoreColor};display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0}
  .score-num{font-size:28px;font-weight:900;color:${scoreColor};line-height:1}
  .score-lbl{font-size:9px;color:#64748b;text-transform:uppercase;letter-spacing:.06em}
  .score-detail{flex:1}
  .bar-bg{height:10px;background:#e2e8f0;border-radius:6px;overflow:hidden;margin:6px 0}
  .bar-fill{height:100%;border-radius:6px;background:${scoreColor};width:${app.score}%}
  table.findings{width:100%;border-collapse:collapse;border-radius:8px;overflow:hidden}
  .remarks-box{background:#fffbeb;border:1px solid #fde68a;border-radius:10px;padding:16px 20px;margin-top:8px}
  .remarks-box p{margin:0;font-size:13.5px;color:#78350f;line-height:1.6}
  .footer{margin-top:40px;padding:20px 40px;background:#f8fafc;border-top:3px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#94a3b8}
  @media print{body{background:#fff}.page{width:100%;padding:0}}
</style>
</head>
<body>
<div class="page">
  <div class="header">
    <div class="logo-area">
      <div class="logo-circle">BIS</div>
      <div>
        <div class="header-title">Bureau of Indian Standards</div>
        <div class="header-sub">Ministry of Consumer Affairs, Food &amp; Public Distribution | Govt. of India</div>
        <div class="tricolor-h"></div>
      </div>
    </div>
    <div class="stamp-area">
      <div class="stamp">${statusEmoji}</div>
      <div class="ref">Ref No: ${app.id} | ${date} ${time}</div>
    </div>
  </div>

  <div class="body">
    <div style="font-size:20px;font-weight:800;color:#0a2747;margin-bottom:4px">Certification Application Report</div>
    <div style="font-size:13px;color:#64748b">AI-Powered BIS Smart Portal â€” Official Assessment Document</div>

    <div class="section-title">Applicant Information</div>
    <table class="info">
      <tr><td>Application ID</td><td>${app.id}</td></tr>
      <tr><td>Company Name</td><td style="font-family:'Segoe UI',sans-serif;font-weight:600">${app.company}</td></tr>
      <tr><td>GST Number</td><td>${app.gst || 'Not Provided'}</td></tr>
      <tr><td>Manufacturing State</td><td>${app.state || 'Not Provided'}</td></tr>
      <tr><td>Product Category</td><td>${app.category}</td></tr>
      <tr><td>CM/L Number</td><td>${app.cml}</td></tr>
      <tr><td>License Expiry</td><td>${app.expiry || 'Not Provided'}</td></tr>
      <tr><td>Submission Date</td><td>${date}</td></tr>
      <tr><td>Applicant Type</td><td>${app.appType || 'Existing Manufacturer'}</td></tr>
    </table>

    <div class="section-title">AI Compliance Score</div>
    <div class="score-box">
      <div class="score-circle">
        <div class="score-num">${app.score}</div>
        <div class="score-lbl">/ 100</div>
      </div>
      <div class="score-detail">
        <div style="font-size:15px;font-weight:700;color:#1e293b">${app.risk}</div>
        <div style="font-size:12px;color:#64748b;margin-bottom:8px">Computed by BIS AI Risk Engine</div>
        <div class="bar-bg"><div class="bar-fill"></div></div>
        <div style="display:flex;justify-content:space-between;font-size:10px;color:#94a3b8">
          <span>0 â€” High Risk</span><span>50 â€” Medium</span><span>80+ â€” Low Risk</span>
        </div>
      </div>
    </div>

    <div class="section-title">Detailed Findings</div>
    <table class="findings">
      ${findingsRows}
    </table>

    ${app.remarks ? `
    <div class="section-title">Officer Remarks</div>
    <div class="remarks-box"><p>${app.remarks}</p></div>
    ` : ''}

    <div class="section-title">Decision</div>
    <table class="info">
      <tr><td>Status</td><td style="font-weight:700;color:${statusBg};font-family:'Segoe UI',sans-serif">${app.status.toUpperCase()}</td></tr>
      <tr><td>Decision Date</td><td>${app.status !== 'pending' ? date : 'Awaiting Officer Decision'}</td></tr>
      <tr><td>Reviewing Officer</td><td>${app.status !== 'pending' ? 'Shri R. K. Sharma â€” Regional Officer, BIS Northern Region' : 'Not Assigned'}</td></tr>
      <tr><td>Authorised By</td><td>${app.status !== 'pending' ? 'Shri A. P. Singh, IAS â€” Director General, BIS' : 'Not Assigned'}</td></tr>
    </table>

    ${certBlock}
  </div>

  <div class="footer">
    <div>
      <div>This is a computer-generated official report from the BIS Smart Certification Portal.</div>
      <div>All decisions are subject to BIS Act, 2016 &nbsp;|&nbsp; Helpline: 1800-11-4000 &nbsp;|&nbsp; bis.gov.in</div>
    </div>
    <div style="text-align:center;margin-left:20px">
      ${bisSeal.replace('width="120" height="120"','width="64" height="64"')}
    </div>
  </div>
</div>
</body></html>`;
}

function downloadReport(app, filenamePrefix) {
  const html   = buildReportHTML(app);
  const blob   = new Blob([html], { type: 'text/html' });
  const url    = URL.createObjectURL(blob);
  const a      = document.createElement('a');
  a.href       = url;
  a.download   = `${filenamePrefix}_${app.id}_Report.html`;
  document.body.appendChild(a);
  a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
  toast(`Report downloaded: ${filenamePrefix}_${app.id}_Report.html`, 'ğŸ“„');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APPLY SUBMIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function runApplyAnalysis() {
  const company  = document.getElementById('a-company').value.trim();
  const gst      = document.getElementById('a-gst').value.trim();
  const state    = document.getElementById('a-state').value;
  const expiry   = document.getElementById('a-expiry').value;
  const issueDate= document.getElementById('a-issue').value;
  const category = document.getElementById('a-category').value;
  const appType  = document.getElementById('a-type').value;
  const specs    = document.getElementById('a-specs').value;
  const hasDoc   = document.getElementById('a-pdf').files.length > 0;
  const cml      = null; // CM/L assigned by officer upon acceptance

  if (!company)  { toast('Please enter Company Name', 'âš ï¸'); return; }
  if (!category) { toast('Please select a Product Category', 'âš ï¸'); return; }
  if (!state)    { toast('Please select Manufacturing State', 'âš ï¸'); return; }

  const spinner = document.getElementById('applySpinner');
  const result  = document.getElementById('applyResult');
  result.innerHTML = '';
  spinner.classList.add('show');

  setTimeout(() => {
    spinner.classList.remove('show');
    const { score, findings } = computeScore({ cml, expiry, hasDoc, appType, category, specs });

    let riskLabel, sBadge;
    if (score >= 80)      { riskLabel = 'Low Risk';    sBadge = `<span class="result-status-badge s-approved">âœ… Approved</span>`; }
    else if (score >= 50) { riskLabel = 'Medium Risk'; sBadge = `<span class="result-status-badge s-review">âš  Needs Review</span>`; }
    else                  { riskLabel = 'High Risk';   sBadge = `<span class="result-status-badge s-high">ğŸš« Flagged</span>`; }

    const barC     = score >= 80 ? 'bar-g' : score >= 50 ? 'bar-w' : 'bar-r';
    const valColor = score >= 80 ? 'r-green' : score >= 50 ? 'r-warn' : 'r-red';
    const appId    = 'BIS-' + Date.now().toString().slice(-8);

    // Build app object (CM/L will be assigned by officer on acceptance)
    const appObj = { id:appId, company, gst, state, cml:null, category,
      productionStart:issueDate, productionVolume:expiry, appType,
      score, risk:riskLabel, status:'pending', findings, specs, remarks:'',
      assignedCML:null, officerRemarks:'', decisionDate:null };

    // Save to session â€” both officer queue and user tracking
    submittedApps.unshift(appObj);
    // â”€â”€ BACKEND SYNC â”€â”€
    bisAPI.submitApplication(appObj);
    // Store for download button
    setTimeout(() => {
      const hidden = document.getElementById('latestAppData');
      if (hidden) hidden.value = JSON.stringify(appObj);
    }, 100);

    const findingsHTML = findings.map(f => {
      const cls  = f.t === 'ok' ? 'f-ok' : f.t === 'warn' ? 'f-warn' : 'f-err';
      const icon = f.t === 'ok' ? 'âœ“' : f.t === 'warn' ? 'âš ' : 'âœ—';
      return `<div class="finding ${cls}">${icon} ${f.m}</div>`;
    }).join('');

    result.innerHTML = `
    <div class="result-card">
      <div class="result-header">
        <h3 style="font-family:'Playfair Display',serif;font-size:22px">Analysis Complete</h3>
        ${sBadge}
      </div>

      <!-- Submitted notice -->
      <div style="background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.25);border-radius:12px;padding:16px 20px;margin-bottom:22px;display:flex;align-items:center;gap:12px">
        <span style="font-size:24px">ğŸ“¤</span>
        <div>
          <div style="font-weight:700;color:#4ade80;font-size:14px">Application Submitted to Officer Queue</div>
          <div style="font-size:12.5px;color:rgba(255,255,255,.6);margin-top:3px">Application ID: <strong style="font-family:'Courier New',monospace;color:#fff">${appId}</strong> â€” A BIS Officer will review and issue a decision. You can track status in the Officer Dashboard.</div>
        </div>
      </div>

      <div class="score-section">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <span style="font-size:13.5px;font-weight:600;color:rgba(255,255,255,.8)">Compliance Score</span>
          <span style="font-family:'Playfair Display',serif;font-size:30px;font-weight:800">${score}<span style="font-size:16px;opacity:.5">/100</span></span>
        </div>
        <div class="score-bar-wrap"><div class="score-bar ${barC}" style="width:${score}%"></div></div>
        <div class="score-row"><span>0 â€” High Risk</span><span>50 â€” Medium</span><span>80+ â€” Low Risk</span></div>
      </div>

      <div class="result-grid">
        <div class="r-item"><div class="r-lbl">Score</div><div class="r-val ${valColor}">${score}/100</div></div>
        <div class="r-item"><div class="r-lbl">Risk Level</div><div class="r-val ${valColor}">${riskLabel}</div></div>
        <div class="r-item"><div class="r-lbl">CM/L Number</div><div class="r-val r-warn" style="font-size:11px">Assigned on Acceptance</div></div>
        <div class="r-item"><div class="r-lbl">Application ID</div><div class="r-val r-white" style="font-size:12px;font-family:'Courier New',monospace">${appId}</div></div>
        <div class="r-item"><div class="r-lbl">Company</div><div class="r-val r-white" style="font-size:12.5px">${company}</div></div>
        <div class="r-item"><div class="r-lbl">Status</div><div class="r-val r-warn">Pending Review</div></div>
      </div>

      <div style="margin-bottom:8px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--dim)">Detailed Findings</div>
      ${findingsHTML}

      <div style="margin-top:22px;display:flex;gap:12px;flex-wrap:wrap">
        <button class="btn-accent" onclick="downloadReport(JSON.parse(document.getElementById('latestAppData').value),'Applicant')" style="border-radius:10px">â¬‡ Download My Report</button>
        <button class="btn-primary btn-sm" onclick="showPage('userdash')">ğŸ“‹ Track My Application â†’</button>
      </div>
      <input type="hidden" id="latestAppData" value="">
    </div>`;

    toast(`Application ${appId} submitted to officer queue â€” Score: ${score}/100`, score >= 80 ? 'âœ…' : score >= 50 ? 'âš ï¸' : 'ğŸš«');
  }, 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD â€” LIVE APPS RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderLiveApps() {
  const card  = document.getElementById('liveAppsCard');
  const tbody = document.getElementById('liveAppsTable');
  if (!submittedApps.length) { card.style.display = 'none'; return; }
  card.style.display = 'block';

  const rows = submittedApps.map(app => {
    const scoreCol = app.score >= 80 ? '#4ade80' : app.score >= 50 ? '#fbbf24' : '#f87171';
    const badgeCls = app.status === 'accepted' ? 'bg-green' : app.status === 'rejected' ? 'bg-red' : 'bg-warn';
    const badgeTxt = app.status === 'accepted' ? 'Accepted' : app.status === 'rejected' ? 'Rejected' : 'Pending';
    const now = new Date().toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});

    const appJson = JSON.stringify(app).replace(/"/g,'&quot;');
    const decideBtn = app.status === 'pending'
      ? `<button class="btn-primary" style="padding:4px 10px;font-size:11px;border-radius:7px" onclick="officerDecide('${app.id}','${app.company}',${app.score},'${app.cml}','${app.category}')">âš– Decide</button>` : '';

    return `<tr id="row-${app.id}">
      <td style="font-size:11px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">${app.id}</td>
      <td style="font-family:'Courier New',monospace;font-size:11px">${app.cml}</td>
      <td>${app.company}</td>
      <td>${app.category || 'â€”'}</td>
      <td><strong style="color:${scoreCol}">${app.score}</strong></td>
      <td><span style="font-size:11px;color:rgba(255,255,255,.5)">${app.risk}</span></td>
      <td style="font-size:11px;color:rgba(255,255,255,.4)">${now}</td>
      <td><div style="display:flex;gap:5px;flex-wrap:wrap">
        <button class="btn-outline-white" style="padding:4px 9px;font-size:11px" onclick='officerViewReport(${appJson})'>ğŸ‘ View</button>
        ${decideBtn}
        <button class="btn-outline-white" style="padding:4px 9px;font-size:11px" onclick='downloadOfficerReport(${appJson})'>â¬‡ Report</button>
      </div></td>
    </tr>`;
  }).join('');
  tbody.innerHTML = rows;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OFFICER â€” VIEW REPORT IN MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function officerViewReport(app) {
  if (typeof app === 'string') app = JSON.parse(app);
  const scoreColor = app.score >= 80 ? '#4ade80' : app.score >= 50 ? '#fbbf24' : '#f87171';
  const barC = app.score >= 80 ? 'bar-g' : app.score >= 50 ? 'bar-w' : 'bar-r';
  const statusBadge = app.status === 'accepted'
    ? '<span class="result-status-badge s-approved">âœ… Accepted</span>'
    : app.status === 'rejected'
    ? '<span class="result-status-badge s-high">âŒ Rejected</span>'
    : '<span class="result-status-badge s-review">â³ Pending Review</span>';

  const findingsHTML = (app.findings || []).map(f => {
    const t   = f.t || (f.startsWith('âœ“') ? 'ok' : f.startsWith('âš ') ? 'warn' : 'err');
    const m   = f.m || f;
    const cls = t === 'ok' ? 'f-ok' : t === 'warn' ? 'f-warn' : 'f-err';
    const ico = t === 'ok' ? 'âœ“' : t === 'warn' ? 'âš ' : 'âœ—';
    return `<div class="finding ${cls}">${ico} ${m}</div>`;
  }).join('');

  const appJson = JSON.stringify(app).replace(/"/g,'&quot;');
  const isPending = app.status === 'pending';

  document.getElementById('modalContent').innerHTML = `
    <div style="margin-bottom:24px">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:8px">
        <h2 style="font-family:'Playfair Display',serif;font-size:22px;margin:0">Application Report</h2>
        ${statusBadge}
      </div>
      <div style="font-size:12px;color:rgba(255,255,255,.4);font-family:'Courier New',monospace">${app.id}</div>
    </div>

    <!-- Info grid -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:22px">
      <div class="r-item"><div class="r-lbl">Company</div><div class="r-val r-white" style="font-size:13px">${app.company}</div></div>
      <div class="r-item"><div class="r-lbl">CM/L Number</div><div class="r-val r-white" style="font-size:12px;font-family:'Courier New',monospace">${app.cml}</div></div>
      <div class="r-item"><div class="r-lbl">Category</div><div class="r-val r-white" style="font-size:13px">${app.category || 'â€”'}</div></div>
      <div class="r-item"><div class="r-lbl">License Expiry</div><div class="r-val r-white" style="font-size:13px">${app.expiry || 'â€”'}</div></div>
      <div class="r-item"><div class="r-lbl">GST No.</div><div class="r-val r-white" style="font-size:12px;font-family:'Courier New',monospace">${app.gst || 'â€”'}</div></div>
      <div class="r-item"><div class="r-lbl">State</div><div class="r-val r-white" style="font-size:13px">${app.state || 'â€”'}</div></div>
    </div>

    <!-- Score -->
    <div style="margin-bottom:22px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-size:13px;font-weight:600;color:rgba(255,255,255,.8)">Compliance Score</span>
        <span style="font-size:28px;font-weight:900;color:${scoreColor}">${app.score}<span style="font-size:14px;opacity:.5">/100</span></span>
      </div>
      <div class="score-bar-wrap"><div class="score-bar ${barC}" style="width:${app.score}%"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,.35);margin-top:4px">
        <span>0 â€” High Risk</span><span>80+ â€” Low Risk</span>
      </div>
    </div>

    <!-- Findings -->
    <div style="margin-bottom:8px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.4)">AI Findings</div>
    <div style="margin-bottom:20px">${findingsHTML}</div>

    ${app.remarks ? `<div style="background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.2);border-radius:10px;padding:14px 18px;margin-bottom:20px">
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:#fbbf24;margin-bottom:6px">Officer Remarks</div>
      <div style="font-size:13.5px;color:rgba(255,255,255,.8)">${app.remarks}</div>
    </div>` : ''}

    <!-- Actions -->
    <div style="display:flex;gap:10px;flex-wrap:wrap;padding-top:18px;border-top:1px solid rgba(255,255,255,.1)">
      ${isPending ? `
        <button class="btn-primary btn-sm" onclick="closeModal();officerDecide('${app.id}','${app.company}',${app.score},'${app.cml}','${app.category}')">âš– Issue Decision</button>
      ` : ''}
      <button class="btn-outline-white btn-sm" onclick='downloadOfficerReport(${appJson})'>â¬‡ Download Report</button>
      <button class="btn-ghost btn-sm" onclick="closeModal()">Close</button>
    </div>
  `;
  document.getElementById('officerModal').style.display = 'block';
  document.body.style.overflow = 'hidden';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OFFICER â€” DECIDE MODAL (Accept / Reject)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function officerDecide(appId, company, score, cml, category) {
  const scoreColor = score >= 80 ? '#4ade80' : score >= 50 ? '#fbbf24' : '#f87171';
  // Generate a preview CM/L (will be confirmed on acceptance)
  const previewCML = 'CM/L-' + Math.floor(1000000000 + Math.random() * 9000000000);
  document.getElementById('modalContent').innerHTML = `
    <div style="margin-bottom:24px">
      <h2 style="font-family:'Playfair Display',serif;font-size:22px;margin:0 0 6px">âš– Issue Officer Decision</h2>
      <div style="font-size:13px;color:rgba(255,255,255,.5)">Application: <span style="font-family:'Courier New',monospace;color:#fff">${appId}</span> â€” ${company}</div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:22px">
      <div class="r-item"><div class="r-lbl">Company</div><div class="r-val r-white" style="font-size:13px">${company}</div></div>
      <div class="r-item"><div class="r-lbl">AI Score</div><div class="r-val" style="color:${scoreColor};font-size:18px">${score}/100</div></div>
      <div class="r-item"><div class="r-lbl">Category</div><div class="r-val r-white" style="font-size:13px">${category || 'â€”'}</div></div>
      <div class="r-item"><div class="r-lbl">CM/L to Assign</div><div class="r-val r-warn" style="font-size:11px;font-family:'Courier New',monospace">${previewCML}</div></div>
    </div>

    <!-- CM/L assignment notice -->
    <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:12px;padding:16px 18px;margin-bottom:18px;display:flex;align-items:flex-start;gap:12px">
      <span style="font-size:20px;flex-shrink:0">ğŸ”</span>
      <div>
        <div style="font-size:13px;font-weight:600;color:#4ade80;margin-bottom:4px">CM/L Number to be Issued on Acceptance</div>
        <div style="font-size:12px;color:rgba(255,255,255,.55);line-height:1.6">If you Accept, the system will auto-generate and assign CM/L number <strong style="font-family:'Courier New',monospace;color:#fff">${previewCML}</strong> to this application. This will be shown on the applicant's dashboard.</div>
      </div>
    </div>

    <div style="background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:20px;margin-bottom:20px">
      <label style="display:block;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:rgba(255,255,255,.5);margin-bottom:10px">Officer Remarks / Reason <span style="color:#f87171">*</span></label>
      <textarea id="decisionRemarks" class="fc" rows="4" placeholder="e.g. 'All documents verified and compliant. Approved as per BIS Act 2016.' or 'Rejected: Expired documentation. Applicant must re-apply with renewed test report.'"></textarea>
    </div>

    <input type="hidden" id="previewCMLValue" value="${previewCML}">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
      <button onclick="issueDecision('${appId}','accepted')" style="padding:18px;background:linear-gradient(135deg,#16a34a,#15803d);border:none;border-radius:14px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;transition:all .25s;font-family:'Poppins',sans-serif;display:flex;align-items:center;justify-content:center;gap:10px" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        âœ… Accept &amp; Assign CM/L
      </button>
      <button onclick="issueDecision('${appId}','rejected')" style="padding:18px;background:linear-gradient(135deg,#dc2626,#b91c1c);border:none;border-radius:14px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;transition:all .25s;font-family:'Poppins',sans-serif;display:flex;align-items:center;justify-content:center;gap:10px" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        âŒ Reject Application
      </button>
    </div>
    <button class="btn-ghost btn-sm" style="width:100%;justify-content:center" onclick="closeModal()">Cancel â€” Review Later</button>
  `;
  document.getElementById('officerModal').style.display = 'block';
  document.body.style.overflow = 'hidden';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OFFICER â€” ISSUE DECISION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function issueDecision(appId, decision) {
  const remarks     = document.getElementById('decisionRemarks').value.trim();
  const previewCMLEl = document.getElementById('previewCMLValue');
  const assignedCML = decision === 'accepted' ? (previewCMLEl ? previewCMLEl.value : generateCML()) : null;

  if (!remarks) { toast('Please provide officer remarks before issuing a decision', 'âš ï¸'); return; }

  const decisionDate = new Date().toLocaleDateString('en-IN', {day:'2-digit',month:'long',year:'numeric'});

  // Update in live apps
  const app = submittedApps.find(a => a.id === appId);
  if (app) {
    app.status        = decision;
    app.remarks       = remarks;
    app.officerRemarks = remarks;
    app.assignedCML   = assignedCML;
    app.decisionDate  = decisionDate;
    if (assignedCML) app.cml = assignedCML;
  }

  // Update badge in static table if exists
  const staticBadge = document.getElementById('status-' + appId);
  if (staticBadge) {
    staticBadge.textContent = decision === 'accepted' ? 'Accepted' : 'Rejected';
    staticBadge.className   = 'badge ' + (decision === 'accepted' ? 'bg-green' : 'bg-red');
  }

  // â”€â”€ BACKEND SYNC â”€â”€
  bisAPI.issueDecision({ id: appId, decision, remarks, assignedCML, decisionDate });

  closeModal();
  renderLiveApps();
  renderUserDash();

  const icon = decision === 'accepted' ? 'âœ…' : 'âŒ';
  const cmlMsg = decision === 'accepted' ? ` | CM/L: ${assignedCML}` : '';
  toast(`${icon} ${decision.toUpperCase()}: ${appId}${cmlMsg}`, icon);

  // Auto-prompt download
  setTimeout(() => {
    if (app) {
      const doDownload = confirm(`Decision issued!\n\nApplication: ${appId}\nDecision: ${decision.toUpperCase()}${decision==='accepted' ? '\nCM/L Assigned: '+assignedCML : ''}\nRemarks: ${remarks}\n\nDownload the official decision report now?`);
      if (doDownload) downloadOfficerReport(app);
    }
  }, 500);
}

function generateCML() {
  return 'CM/L-' + Math.floor(1000000000 + Math.random() * 9000000000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOWNLOAD â€” OFFICER REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function downloadOfficerReport(app) {
  if (typeof app === 'string') app = JSON.parse(app);
  downloadReport(app, 'Officer_BIS');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL CLOSE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function closeModal() {
  document.getElementById('officerModal').style.display = 'none';
  document.body.style.overflow = '';
}
// Close on backdrop click
document.getElementById('officerModal').addEventListener('click', e => {
  if (e.target === document.getElementById('officerModal')) closeModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(tab) {
  ['submitted','analytics'].forEach(t => {
    document.getElementById('tabpanel-' + t).style.display = t === tab ? 'block' : 'none';
    document.getElementById('tab-' + t).classList.toggle('active', t === tab);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD CONTROLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function refreshDash() {
  const total = 1284 + Math.floor(Math.random() * 20);
  const risk  = 47  + Math.floor(Math.random() * 5);
  const exp   = 133 + Math.floor(Math.random() * 8);
  document.getElementById('kpi-total').textContent = total.toLocaleString('en-IN');
  document.getElementById('kpi-risk').textContent  = risk;
  document.getElementById('kpi-exp').textContent   = exp;
  document.getElementById('kpi-app').textContent   = (total - risk - Math.floor(exp/2)).toLocaleString('en-IN');
  toast('Dashboard data refreshed', 'ğŸ”„');
  renderLiveApps();
}

function filterHighRisk() {
  filteringHighRisk = !filteringHighRisk;
  const rows = document.querySelectorAll('#dashTable tr');
  rows.forEach(row => {
    const scoreEl = row.querySelector('strong');
    if (!scoreEl) return;
    const score = parseInt(scoreEl.textContent);
    row.style.display = filteringHighRisk ? (score < 50 ? '' : 'none') : '';
  });
  toast(filteringHighRisk ? 'Showing High Risk applications only' : 'Showing all applications', filteringHighRisk ? 'ğŸ”´' : 'ğŸ“‹');
}

function exportDashReport() {
  const totalApps = submittedApps.length + 5;
  const accepted  = submittedApps.filter(a => a.status === 'accepted').length + 2;
  const rejected  = submittedApps.filter(a => a.status === 'rejected').length + 1;
  const pending   = submittedApps.filter(a => a.status === 'pending').length + 2;
  const date = new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'long',year:'numeric'});

  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8">
  <style>body{font-family:'Segoe UI',Arial,sans-serif;padding:40px;color:#1e293b;background:#f8fafc}
  h1{color:#0a2747;font-size:24px}.header{background:#0a2747;color:#fff;padding:24px 32px;border-radius:12px;margin-bottom:28px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin:20px 0}
  .kpi{background:#fff;border:1px solid #e2e8f0;border-radius:10px;padding:20px;text-align:center}
  .kpi .num{font-size:36px;font-weight:800;color:#1554b0}.kpi .lbl{font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:.06em}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.06)}
  th{background:#1554b0;color:#fff;padding:12px 16px;text-align:left;font-size:12px;text-transform:uppercase;letter-spacing:.06em}
  td{padding:12px 16px;border-bottom:1px solid #f1f5f9;font-size:13.5px}
  .badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700}
  .bg-g{background:#dcfce7;color:#15803d}.bg-r{background:#fee2e2;color:#b91c1c}.bg-w{background:#fef3c7;color:#92400e}
  footer{margin-top:32px;font-size:11px;color:#94a3b8;border-top:1px solid #e2e8f0;padding-top:16px}
  </style></head><body>
  <div class="header"><h1 style="color:#fff;margin:0">BIS Smart Portal â€” Dashboard Summary Report</h1>
  <div style="opacity:.7;margin-top:6px;font-size:13px">Bureau of Indian Standards | Generated: ${date}</div></div>
  <div class="grid">
    <div class="kpi"><div class="num">${totalApps}</div><div class="lbl">Total Applications</div></div>
    <div class="kpi"><div class="num" style="color:#15803d">${accepted}</div><div class="lbl">Accepted</div></div>
    <div class="kpi"><div class="num" style="color:#b91c1c">${rejected}</div><div class="lbl">Rejected</div></div>
    <div class="kpi"><div class="num" style="color:#d97706">${pending}</div><div class="lbl">Pending</div></div>
  </div>
  <h2 style="font-size:16px;color:#0a2747;margin:24px 0 12px">Session Submissions</h2>
  <table><thead><tr><th>App ID</th><th>Company</th><th>CM/L</th><th>Category</th><th>Score</th><th>Status</th></tr></thead><tbody>
  ${submittedApps.map(a => `<tr>
    <td style="font-family:'Courier New',monospace;font-size:12px">${a.id}</td>
    <td>${a.company}</td>
    <td style="font-family:'Courier New',monospace;font-size:12px">${a.cml}</td>
    <td>${a.category||'â€”'}</td>
    <td><strong style="color:${a.score>=80?'#15803d':a.score>=50?'#d97706':'#b91c1c'}">${a.score}</strong></td>
    <td><span class="badge ${a.status==='accepted'?'bg-g':a.status==='rejected'?'bg-r':'bg-w'}">${a.status}</span></td>
  </tr>`).join('')}
  ${submittedApps.length === 0 ? '<tr><td colspan="6" style="text-align:center;color:#94a3b8;padding:20px">No live submissions in this session</td></tr>' : ''}
  </tbody></table>
  <footer>Bureau of Indian Standards Smart Certification Portal | BIS Act, 2016 | Helpline: 1800-11-4000 | bis.gov.in</footer>
  </body></html>`;

  const blob = new Blob([html], { type:'text/html' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = `BIS_Dashboard_Summary_${Date.now()}.html`;
  document.body.appendChild(a); a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
  toast('Dashboard summary report downloaded', 'ğŸ“Š');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VERIFY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function runVerification() {
  const cml    = document.getElementById('v-cml').value.trim();
  const hasImg = document.getElementById('v-img').files.length > 0;
  const cat    = document.getElementById('v-cat').value;
  if (!cml && !hasImg) { toast('Please upload an image or enter a CM/L number', 'âš ï¸'); return; }

  const spinner = document.getElementById('verifySpinner');
  const result  = document.getElementById('verifyResult');
  result.innerHTML = '';
  spinner.classList.add('show');

  setTimeout(() => {
    spinner.classList.remove('show');
    const usedCML     = cml || 'CM/L-7823456789';
    const isValid     = validateCML(usedCML);
    const mockExp     = new Date('2026-04-14');
    const isExpired   = mockExp < new Date();
    const suspicious  = ['CM/L-0000000000','CM/L-1111111111','CM/L-9999999999'];
    const isSuspicious = suspicious.includes(usedCML);

    let trustScore = 100;
    if (!isValid)     trustScore -= 40;
    if (isExpired)    trustScore -= 40;
    if (isSuspicious) trustScore -= 20;
    trustScore = Math.max(0, Math.min(100, trustScore));

    let statusText, badgeCls, circleColor, findingsArr;
    if (!isValid || isSuspicious) {
      statusText = 'ğŸš« Suspicious / Invalid'; badgeCls = 's-high'; circleColor = '#f87171';
      findingsArr = [{t:'err',m:'CM/L does not match BIS format (CM/L-XXXXXXXXXX)'},{t:'err',m:'Cannot locate license in national database'},{t:'err',m:'Do NOT purchase â€” report to BIS Helpline: 1800-11-4000'}];
    } else if (isExpired) {
      statusText = 'â° Expired License'; badgeCls = 's-review'; circleColor = '#fbbf24';
      findingsArr = [{t:'ok',m:'CM/L format is valid'},{t:'err',m:'License has expired â€” product may not meet current standards'},{t:'warn',m:'Manufacturer must renew before selling'},{t:'warn',m:'Ask seller for updated documentation'}];
    } else {
      statusText = 'âœ… Valid & Active'; badgeCls = 's-approved'; circleColor = '#4ade80';
      findingsArr = [{t:'ok',m:'CM/L format valid and matches BIS standards'},{t:'ok',m:'License is active and within validity period'},{t:'ok',m:'Manufacturer registered in BIS national database'},{t:'ok',m:'Safe to purchase this product'}];
    }

    const findHTML = findingsArr.map(f => {
      const cls = f.t==='ok'?'f-ok':f.t==='warn'?'f-warn':'f-err';
      const ico = f.t==='ok'?'âœ“':f.t==='warn'?'âš ':'âœ—';
      return `<div class="finding ${cls}">${ico} ${f.m}</div>`;
    }).join('');

    result.innerHTML = `
    <div class="result-card">
      <div style="text-align:center;margin-bottom:28px">
        <div class="trust-circle" style="border-color:${circleColor}">
          <span class="trust-num" style="color:${circleColor}">${trustScore}</span>
          <span class="trust-lbl">Trust Score</span>
        </div>
        <span class="result-status-badge ${badgeCls}">${statusText}</span>
      </div>
      <div class="result-grid" style="margin-bottom:22px">
        <div class="r-item"><div class="r-lbl">CM/L Number</div><div class="r-val r-white" style="font-size:12px;font-family:'Courier New',monospace">${usedCML}</div></div>
        <div class="r-item"><div class="r-lbl">Registered Company</div><div class="r-val r-white" style="font-size:13px">${isValid&&!isSuspicious?'Bosch India Limited':'Not Found'}</div></div>
        <div class="r-item"><div class="r-lbl">Category</div><div class="r-val r-white" style="font-size:13px">${cat||'Electrical Equipment'}</div></div>
        <div class="r-item"><div class="r-lbl">Issue Date</div><div class="r-val r-white" style="font-size:13px">${isValid&&!isSuspicious?'15 Apr 2022':'â€”'}</div></div>
        <div class="r-item"><div class="r-lbl">Expiry Date</div><div class="r-val ${isExpired?'r-red':'r-green'}" style="font-size:13px">${isValid&&!isSuspicious?'14 Apr 2026':'â€”'}</div></div>
        <div class="r-item"><div class="r-lbl">Format Check</div><div class="r-val ${isValid?'r-green':'r-red'}">${isValid?'Valid âœ“':'Invalid âœ—'}</div></div>
      </div>
      <div style="margin-bottom:8px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--dim)">Verification Findings</div>
      ${findHTML}
      <div style="margin-top:22px;display:flex;gap:12px;flex-wrap:wrap">
        <button class="btn-outline-white btn-sm" onclick="downloadReport({id:'VER-${Date.now().toString().slice(-6)}',company:${JSON.stringify(isValid&&!isSuspicious?'Bosch India Limited':'Unknown')},cml:'${usedCML}',category:${JSON.stringify(cat||'Electrical Equipment')},score:${trustScore},risk:${JSON.stringify(trustScore>=80?'Low Risk':trustScore>=50?'Medium Risk':'High Risk')},status:${JSON.stringify(statusText)},findings:${JSON.stringify(findingsArr)},remarks:'Public product verification result.'},'Verification')">â¬‡ Download Certificate</button>
        ${!isValid||isSuspicious?`<button class="btn-accent btn-sm" onclick="toast('Counterfeit report filed. Ref: RPT-'+Date.now().toString().slice(-6),'ğŸš¨')" style="border-radius:9px">ğŸš¨ Report Counterfeit</button>`:''}
      </div>
    </div>`;

    toast(`Trust Score: ${trustScore}/100 â€” ${trustScore>=80?'Product is genuine':'Review required'}`, trustScore>=80?'âœ…':'âš ï¸');
  }, 1800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitContact() {
  const name  = document.getElementById('c-name').value.trim();
  const email = document.getElementById('c-email').value.trim();
  const msg   = document.getElementById('c-msg').value.trim();
  if (!name)  { toast('Please enter your name', 'âš ï¸'); return; }
  if (!email) { toast('Please enter your email', 'âš ï¸'); return; }
  if (!msg)   { toast('Please enter your message', 'âš ï¸'); return; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { toast('Please enter a valid email address', 'âš ï¸'); return; }
  toast(`Message sent! BIS will respond to ${email} within 2â€“3 working days`, 'ğŸ“§');
  ['c-name','c-email','c-msg'].forEach(id => document.getElementById(id).value = '');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   USER DASHBOARD â€” RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderUserDash() {
  const empty   = document.getElementById('userDashEmpty');
  const content_el = document.getElementById('userDashContent');
  const kpiGrid = document.getElementById('userKpiGrid');
  const cards   = document.getElementById('userAppCards');

  if (!submittedApps.length) {
    empty.style.display   = 'block';
    content_el.style.display = 'none';
    return;
  }
  empty.style.display   = 'none';
  content_el.style.display = 'block';

  const total    = submittedApps.length;
  const accepted = submittedApps.filter(a => a.status === 'accepted').length;
  const rejected = submittedApps.filter(a => a.status === 'rejected').length;
  const pending  = submittedApps.filter(a => a.status === 'pending').length;

  kpiGrid.innerHTML = `
    <div class="kpi-card"><div class="kpi-icon">ğŸ“‹</div><span class="kpi-num kpi-blue">${total}</span><div class="kpi-lbl">Total Submitted</div></div>
    <div class="kpi-card"><div class="kpi-icon">â³</div><span class="kpi-num kpi-warn">${pending}</span><div class="kpi-lbl">Pending Review</div></div>
    <div class="kpi-card"><div class="kpi-icon">âœ…</div><span class="kpi-num kpi-green">${accepted}</span><div class="kpi-lbl">Accepted</div></div>
    <div class="kpi-card"><div class="kpi-icon">âŒ</div><span class="kpi-num kpi-red">${rejected}</span><div class="kpi-lbl">Rejected</div></div>
  `;

  cards.innerHTML = submittedApps.map(app => {
    const isPending  = app.status === 'pending';
    const isAccepted = app.status === 'accepted';
    const isRejected = app.status === 'rejected';

    const statusIcon  = isPending ? 'â³' : isAccepted ? 'âœ…' : 'âŒ';
    const statusText  = isPending ? 'Pending Officer Review' : isAccepted ? 'Accepted â€” Certified' : 'Rejected';
    const statusColor = isPending ? '#fbbf24' : isAccepted ? '#4ade80' : '#f87171';
    const statusBg    = isPending ? 'rgba(245,158,11,.1)' : isAccepted ? 'rgba(34,197,94,.1)' : 'rgba(239,68,68,.1)';
    const statusBorder = isPending ? 'rgba(245,158,11,.25)' : isAccepted ? 'rgba(34,197,94,.25)' : 'rgba(239,68,68,.25)';
    const scoreColor  = app.score >= 80 ? '#4ade80' : app.score >= 50 ? '#fbbf24' : '#f87171';
    const barC        = app.score >= 80 ? 'bar-g' : app.score >= 50 ? 'bar-w' : 'bar-r';

    const cmlSection = isAccepted ? `
      <div style="background:linear-gradient(135deg,rgba(34,197,94,0.12),rgba(16,185,129,0.08));border:1.5px solid rgba(34,197,94,0.3);border-radius:14px;padding:20px 24px;margin-bottom:18px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <span style="font-size:24px">ğŸ†</span>
          <div>
            <div style="font-size:13px;font-weight:700;color:#4ade80">Certification Approved!</div>
            <div style="font-size:11.5px;color:rgba(255,255,255,.5)">Your BIS Certification has been issued</div>
          </div>
        </div>
        <div style="background:rgba(0,0,0,.2);border-radius:10px;padding:16px;text-align:center">
          <div style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.4);margin-bottom:8px;font-weight:600">Your CM/L Number</div>
          <div style="font-size:24px;font-weight:900;font-family:'Courier New',monospace;color:#4ade80;letter-spacing:.08em">${app.assignedCML || 'â€”'}</div>
          <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:6px">Issued on ${app.decisionDate || 'â€”'} | Valid for 3 years</div>
        </div>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn-accent btn-sm" onclick="downloadUserCertificate('${app.id}')" style="border-radius:9px">ğŸ“ Download Certificate</button>
          <button class="btn-outline-white btn-sm" onclick="navigator.clipboard.writeText('${app.assignedCML}').then(()=>toast('CM/L number copied!','ğŸ“‹'))">ğŸ“‹ Copy CM/L</button>
        </div>
      </div>` : isRejected ? `
      <div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.25);border-radius:12px;padding:18px 20px;margin-bottom:18px">
        <div style="font-size:13px;font-weight:600;color:#f87171;margin-bottom:8px">âŒ Application Rejected</div>
        <div style="font-size:12.5px;color:rgba(255,255,255,.6);line-height:1.65;margin-bottom:12px"><strong style="color:rgba(255,255,255,.8)">Officer Remarks:</strong> ${app.officerRemarks || app.remarks || 'No remarks provided'}</div>
        <button class="btn-outline-white btn-sm" onclick="showPage('apply')">â†© Re-Apply</button>
      </div>` : `
      <div style="background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.2);border-radius:12px;padding:18px 20px;margin-bottom:18px;display:flex;align-items:center;gap:14px">
        <div style="width:40px;height:40px;border-radius:50%;border:2px solid rgba(245,158,11,.4);display:flex;align-items:center;justify-content:center;flex-shrink:0;animation:blink 2s ease-in-out infinite">â³</div>
        <div>
          <div style="font-size:13px;font-weight:600;color:#fbbf24;margin-bottom:3px">Awaiting Officer Review</div>
          <div style="font-size:12px;color:rgba(255,255,255,.5)">A BIS officer will review your application and issue a decision. CM/L will be assigned upon acceptance.</div>
        </div>
      </div>`;

    return `
    <div style="background:rgba(255,255,255,.06);border:1px solid var(--border-g);border-radius:20px;padding:28px;margin-bottom:20px;backdrop-filter:blur(16px);transition:box-shadow .3s" onmouseover="this.style.boxShadow='0 8px 40px rgba(0,0,0,.3)'" onmouseout="this.style.boxShadow=''">
      <!-- Header -->
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:22px">
        <div>
          <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:800;margin-bottom:4px">${app.company}</div>
          <div style="font-size:12px;color:rgba(255,255,255,.4);font-family:'Courier New',monospace">${app.id} Â· ${app.category || 'â€”'}</div>
        </div>
        <div style="background:${statusBg};border:1.5px solid ${statusBorder};color:${statusColor};padding:8px 18px;border-radius:30px;font-size:12.5px;font-weight:700;white-space:nowrap">
          ${statusIcon} ${statusText}
        </div>
      </div>

      <!-- CML / Status section -->
      ${cmlSection}

      <!-- Score -->
      <div style="margin-bottom:18px">
        <div style="display:flex;justify-content:space-between;margin-bottom:7px">
          <span style="font-size:12.5px;font-weight:600;color:rgba(255,255,255,.7)">AI Compliance Score</span>
          <span style="font-size:16px;font-weight:800;color:${scoreColor}">${app.score}/100 â€” ${app.risk}</span>
        </div>
        <div class="score-bar-wrap"><div class="score-bar ${barC}" style="width:${app.score}%"></div></div>
      </div>

      <!-- Info grid -->
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:18px">
        <div class="r-item"><div class="r-lbl">GST Number</div><div class="r-val r-white" style="font-size:12px;font-family:'Courier New',monospace">${app.gst || 'â€”'}</div></div>
        <div class="r-item"><div class="r-lbl">State</div><div class="r-val r-white" style="font-size:13px">${app.state || 'â€”'}</div></div>
        <div class="r-item"><div class="r-lbl">Submission</div><div class="r-val r-white" style="font-size:12px">${new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'})}</div></div>
      </div>

      <!-- Actions -->
      <div style="display:flex;gap:10px;flex-wrap:wrap;padding-top:16px;border-top:1px solid rgba(255,255,255,.08)">
        <button class="btn-outline-white btn-sm" onclick="downloadReport(${JSON.stringify(app).replace(/"/g,'&quot;')},'Applicant')">â¬‡ Download Report</button>
        ${isAccepted ? `<button class="btn-outline-white btn-sm" onclick="downloadUserCertificate('${app.id}')">ğŸ“ Download Certificate</button>` : ''}
        ${isPending ? `<button class="btn-ghost btn-sm" onclick="toast('Application ${app.id} is pending officer review. You will be notified upon decision.','â„¹ï¸')">â„¹ï¸ Check Status</button>` : ''}
      </div>
    </div>`;
  }).join('');
}

/* User certificate download */
function downloadUserCertificate(appId) {
  const app = submittedApps.find(a => a.id === appId);
  if (!app || !app.assignedCML) { toast('Certificate not yet available', 'âš ï¸'); return; }

  const date = new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'long',year:'numeric'});
  const expDate = new Date(Date.now() + 3*365*24*60*60*1000).toLocaleDateString('en-IN',{day:'2-digit',month:'long',year:'numeric'});

  const certHtml = `<!DOCTYPE html><html><head><meta charset="UTF-8">
  <style>
    body{font-family:'Segoe UI',Arial,sans-serif;margin:0;padding:0;background:#fff;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .cert{width:820px;border:8px double #1554b0;padding:50px 60px;text-align:center;position:relative;margin:40px auto;background:#fff;box-shadow:0 0 60px rgba(0,0,0,.12)}
    .cert::before{content:'';position:absolute;inset:12px;border:2px solid #e2e8f0;pointer-events:none}
    .tricolor{height:6px;background:linear-gradient(90deg,#ff9933 33.3%,#fff 33.3% 66.6%,#138808 66.6%);margin:-50px -60px 40px;border-bottom:1px solid #e2e8f0}
    .emblem{width:90px;height:90px;border-radius:50%;border:3px solid #1554b0;background:linear-gradient(135deg,#0a2747,#1554b0);display:flex;align-items:center;justify-content:center;margin:0 auto 16px;font-size:24px;font-weight:900;color:#fff;letter-spacing:.06em}
    .org{font-size:13px;color:#64748b;text-transform:uppercase;letter-spacing:.12em;margin-bottom:4px}
    .ministry{font-size:11px;color:#94a3b8;margin-bottom:32px}
    .cert-title{font-size:28px;font-weight:800;color:#0a2747;margin-bottom:6px;letter-spacing:.03em}
    .cert-sub{font-size:14px;color:#64748b;margin-bottom:32px}
    .company-name{font-size:36px;font-weight:900;color:#1554b0;margin:12px 0;font-style:italic}
    .cml-box{background:linear-gradient(135deg,#0a2747,#1554b0);color:#fff;border-radius:16px;padding:24px 40px;display:inline-block;margin:24px 0}
    .cml-label{font-size:11px;text-transform:uppercase;letter-spacing:.12em;opacity:.7;margin-bottom:8px}
    .cml-num{font-size:32px;font-weight:900;font-family:'Courier New',monospace;letter-spacing:.1em}
    .details-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:28px 0;text-align:left;background:#f8fafc;border-radius:12px;padding:20px}
    .detail-item .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#94a3b8;font-weight:600;margin-bottom:4px}
    .detail-item .val{font-size:14px;font-weight:600;color:#1e293b}
    .sig-row{display:flex;justify-content:space-between;margin-top:40px;padding-top:24px;border-top:1px solid #e2e8f0}
    .sig{text-align:center}
    .sig-line{width:160px;border-bottom:1.5px solid #1554b0;margin:0 auto 8px}
    .sig-name{font-size:12px;font-weight:600;color:#1e293b}
    .sig-title{font-size:10.5px;color:#64748b}
    .watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-35deg);font-size:120px;font-weight:900;color:rgba(21,84,176,0.04);white-space:nowrap;pointer-events:none;letter-spacing:.1em}
    .bottom-strip{height:6px;background:linear-gradient(90deg,#ff9933 33.3%,#fff 33.3% 66.6%,#138808 66.6%);margin:40px -60px -50px;border-top:1px solid #e2e8f0}
    @media print{body{background:#fff;display:block}.cert{box-shadow:none;margin:0;width:auto}}
  </style>
</head><body>
  <div class="cert">
    <div class="watermark">BIS CERTIFIED</div>
    <div class="tricolor"></div>
    <div class="emblem">BIS</div>
    <div class="org">Bureau of Indian Standards</div>
    <div class="ministry">Ministry of Consumer Affairs, Food &amp; Public Distribution | Government of India</div>
    <div class="cert-title">CERTIFICATE OF CERTIFICATION</div>
    <div class="cert-sub">This is to certify that the following manufacturer has been granted</div>
    <div style="font-size:15px;color:#64748b">BIS Product Certification License under the</div>
    <div style="font-size:16px;font-weight:700;color:#1554b0;margin-bottom:8px">Bureau of Indian Standards Act, 2016</div>
    <div class="company-name">${app.company}</div>
    <div style="font-size:14px;color:#64748b;margin-bottom:4px">for the manufacture of</div>
    <div style="font-size:18px;font-weight:700;color:#0a2747;margin-bottom:8px">${app.category}</div>
    <div class="cml-box">
      <div class="cml-label">Certification Mark / License Number</div>
      <div class="cml-num">${app.assignedCML}</div>
    </div>
    <div class="details-grid">
      <div class="detail-item"><div class="lbl">Application ID</div><div class="val" style="font-family:'Courier New',monospace;font-size:12px">${app.id}</div></div>
      <div class="detail-item"><div class="lbl">Date of Issue</div><div class="val">${date}</div></div>
      <div class="detail-item"><div class="lbl">Valid Until</div><div class="val" style="color:#16a34a">${expDate}</div></div>
      <div class="detail-item"><div class="lbl">GST Number</div><div class="val" style="font-family:'Courier New',monospace;font-size:12px">${app.gst || 'Not Provided'}</div></div>
      <div class="detail-item"><div class="lbl">State</div><div class="val">${app.state || 'India'}</div></div>
      <div class="detail-item"><div class="lbl">Compliance Score</div><div class="val" style="color:#1554b0">${app.score}/100</div></div>
    </div>
    <div class="sig-row">
      <div class="sig"><div class="sig-line"></div><div class="sig-name">Director General</div><div class="sig-title">Bureau of Indian Standards</div></div>
      <div style="text-align:center;font-size:11px;color:#94a3b8;align-self:flex-end"><div>Verify at bis.gov.in</div><div>Helpline: 1800-11-4000</div></div>
      <div class="sig"><div class="sig-line"></div><div class="sig-name">Regional Officer</div><div class="sig-title">Certifying Authority</div></div>
    </div>
    <div class="bottom-strip"></div>
  </div>
</body></html>`;

  const blob = new Blob([certHtml], {type:'text/html'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = `BIS_Certificate_${app.assignedCML}_${app.id}.html`;
  document.body.appendChild(a); a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
  toast(`Certificate downloaded: ${app.assignedCML}`, 'ğŸ“');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GREEN INTELLIGENCE ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCAL TEXT GENERATION ENGINE
   (Fully deterministic, no API required)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function generateGreenSummary({ company, product, greenScore, co2PerUnit, annualCO2, carbonImpact, recycle, hazard, waste, ecoEligible }) {
  const scoreVerdict = greenScore >= 85 ? 'exceptional' : greenScore >= 70 ? 'commendable' : greenScore >= 50 ? 'moderate' : 'insufficient';
  const ecoStatus    = ecoEligible ? 'qualifies for BIS ECO-Mark certification' : 'does not yet qualify for BIS ECO-Mark certification';
  const carbonNote   = carbonImpact === 'LOW'
    ? `Carbon footprint is well-controlled at ${co2PerUnit.toFixed(2)} kg COâ‚‚ per unit (LOW impact), resulting in ${Math.round(annualCO2).toLocaleString('en-IN')} kg COâ‚‚ annually.`
    : carbonImpact === 'MEDIUM'
    ? `Carbon emissions of ${co2PerUnit.toFixed(2)} kg COâ‚‚ per unit indicate a MEDIUM impact level requiring targeted reduction strategies across ${Math.round(annualCO2).toLocaleString('en-IN')} kg annual output.`
    : `Carbon emissions of ${co2PerUnit.toFixed(2)} kg COâ‚‚ per unit are classified HIGH â€” immediate intervention is required to reduce the ${Math.round(annualCO2).toLocaleString('en-IN')} kg annual environmental burden.`;
  const wasteNote    = waste === 'full' ? 'Waste management practices are fully compliant with national standards.' : waste === 'partial' ? 'Waste management compliance is partial and requires improvement to meet full BIS standards.' : 'Waste management is non-compliant and poses a critical regulatory risk.';
  return `${company}'s ${product} achieved a Green Sustainability Score of ${greenScore}/100, reflecting ${scoreVerdict} environmental performance and ${ecoStatus}. ${carbonNote} ${wasteNote}`;
}

function generateGreenRecommendations({ greenScore, carbonImpact, recycle, hazard, waste, elec, dist, fuel, eerScore }) {
  if (greenScore >= 85 && carbonImpact === 'LOW') {
    return 'No major improvements required â€” this product meets all BIS Green Intelligence sustainability benchmarks. Continue maintaining current environmental engineering practices and pursue annual BIS re-certification.';
  }
  const recs = [];
  if (eerScore < 80) recs.push(`1. Upgrade motor drive systems with IE3/IE4-class motors and variable frequency drives (VFDs) to improve energy efficiency rating from ${Math.round(eerScore)}% toward the 80+ threshold, targeting a 15â€“25% reduction in electricity consumption per unit.`);
  if (parseFloat(recycle) < 75) recs.push(`${recs.length+1}. Increase recyclability from ${recycle}% to â‰¥75% by substituting non-recyclable polymer casings with recyclable aluminium alloys or high-density polyethylene (HDPE), and design modular sub-assemblies for end-of-life disassembly.`);
  if (carbonImpact !== 'LOW') recs.push(`${recs.length+1}. Reduce carbon emissions (currently ${carbonImpact} impact) by ${elec > 1 ? 'installing on-site solar PV arrays or procuring Renewable Energy Certificates (RECs) to offset electricity consumption' : 'optimising transport logistics via regional warehousing to cut per-unit transport distance below 200 km'}.`);
  if (['moderate','high'].includes(hazard)) recs.push(`${recs.length+1}. Phase out hazardous substances by substituting RoHS-restricted materials with compliant alternatives â€” adopt lead-free solders, halogen-free flame retardants, and REACH-compliant coatings to achieve None/Low hazardous classification.`);
  if (waste !== 'full') recs.push(`${recs.length+1}. Achieve full waste management compliance by implementing an ISO 14001-certified Environmental Management System (EMS), establishing segregated waste streams, and partnering with CPCB-authorised e-waste recyclers under the E-Waste Management Rules, 2022.`);
  if (dist > 300) recs.push(`${recs.length+1}. Optimise supply chain to reduce average transport distance from ${dist} km by establishing regional supplier clusters within 200 km of manufacturing sites, targeting a â‰¥40% reduction in transport-related COâ‚‚ emissions.`);
  return recs.slice(0, 5).join('\n');
}

function generateBadgeInterpretation({ badge, greenScore, carbonImpact, recycle, company, product }) {
  const interps = {
    platinum: `The Platinum Green Certification is the highest environmental honour awarded under the BIS Green Intelligence Certification Platform. ${company}'s ${product}, with a Green Score of ${greenScore}/100 and ${carbonImpact} carbon impact, demonstrates outstanding engineering-based sustainability and full compliance across all five certification parameters.`,
    green:    `The Certified Green badge recognises ${company}'s ${product} as a product meeting BIS environmental compliance benchmarks with a Green Score of ${greenScore}/100 and ${carbonImpact} carbon impact. This certification affirms the product's commitment to recyclability (${recycle}%), responsible material usage, and adequate waste management standards.`,
    yellow:   `The Sustainability Improvement Required badge is assigned to ${company}'s ${product} based on a Green Score of ${greenScore}/100, indicating moderate environmental performance with identifiable gaps in one or more sustainability parameters. Targeted engineering improvements are needed to achieve higher BIS Green Intelligence certification levels.`,
    red:      `The Environmental Risk Alert badge is assigned to ${company}'s ${product} due to a Green Score of ${greenScore}/100 and ${carbonImpact} carbon impact level, reflecting significant environmental compliance deficiencies. Immediate corrective engineering action is mandatory to meet BIS sustainability standards and avoid regulatory consequences.`
  };
  return interps[badge.tier] || interps.yellow;
}

function generateBadgeAdvisory({ badge, greenScore, carbonImpact, recycle, hazard, waste }) {
  if (badge.tier === 'platinum' || badge.tier === 'green') {
    return 'This product demonstrates exemplary engineering-based sustainability standards and is recognised under the BIS Green Intelligence Certification Platform.';
  }
  const adv = [];
  if (greenScore < 75) adv.push(`- Target a Green Sustainability Score of â‰¥75 by improving energy efficiency ratings (aim for BEE 4-star or above) and increasing recyclable material content to â‰¥60%.`);
  if (carbonImpact !== 'LOW') adv.push(`- Reduce carbon emissions to achieve LOW impact classification (â‰¤20 kg COâ‚‚/unit) through renewable energy procurement, supply chain optimisation, and fuel substitution with CNG or EV logistics.`);
  if (parseFloat(recycle) < 60) adv.push(`- Improve product recyclability to â‰¥60% by redesigning component architecture for disassembly and replacing composite materials with mono-material alternatives.`);
  if (['moderate','high'].includes(hazard)) adv.push(`- Eliminate or substitute hazardous materials to reach None or Low classification in compliance with RoHS Directive and REACH Regulation requirements.`);
  if (waste !== 'full') adv.push(`- Achieve full Waste Management Compliance by registering under the Extended Producer Responsibility (EPR) framework and establishing take-back schemes per E-Waste Management Rules, 2022.`);
  return adv.slice(0, 3).join('\n');
}

async function runGreenAnalysis() {
  const company  = document.getElementById('g-company').value.trim();
  const product  = document.getElementById('g-product').value.trim();
  const elec     = parseFloat(document.getElementById('g-elec').value)   || 0;
  const dist     = parseFloat(document.getElementById('g-dist').value)   || 0;
  const fuel     = parseFloat(document.getElementById('g-fuel').value)   || 0;
  const volume   = parseInt(document.getElementById('g-volume').value)   || 0;
  const eer      = document.getElementById('g-eer').value;
  const recycle  = parseFloat(document.getElementById('g-recycle').value);
  const hazard   = document.getElementById('g-hazard').value;
  const waste    = document.getElementById('g-waste').value;

  if (!company) { toast('Please enter Company Name', 'âš ï¸'); return; }
  if (!product) { toast('Please enter Product Name', 'âš ï¸'); return; }
  if (eer === '') { toast('Please select Energy Efficiency Rating', 'âš ï¸'); return; }
  if (isNaN(recycle)) { toast('Please enter Recyclability %', 'âš ï¸'); return; }
  if (!hazard) { toast('Please select Hazardous Material Usage', 'âš ï¸'); return; }
  if (!waste)  { toast('Please select Waste Management status', 'âš ï¸'); return; }
  if (!volume) { toast('Please enter Annual Production Volume', 'âš ï¸'); return; }

  const spinner = document.getElementById('greenSpinner');
  const result  = document.getElementById('greenResult');
  result.innerHTML = '';
  spinner.style.display = 'flex';
  document.getElementById('greenSubmitBtn').disabled = true;

  // â”€â”€ Pre-compute values locally (for display even if AI fails) â”€â”€
  const co2PerUnit = (elec * 0.82) + (dist * 0.12) + (fuel * 2.68);
  const annualCO2  = co2PerUnit * volume;
  const carbonImpact = co2PerUnit <= 20 ? 'LOW' : co2PerUnit <= 50 ? 'MEDIUM' : 'HIGH';
  const carbonScore  = co2PerUnit <= 20 ? 100 : co2PerUnit <= 50 ? 60 : 20;

  const eerScore     = (parseFloat(eer) / 5) * 100;
  const hazardScore  = { none:100, low:75, moderate:40, high:10 }[hazard];
  const wasteScore   = { full:100, partial:60, non:20 }[waste];

  const greenScore = Math.round(
    (eerScore * 0.20) + (recycle * 0.20) + (hazardScore * 0.20) +
    (wasteScore * 0.20) + (carbonScore * 0.20)
  );

  const ecoEligible = greenScore >= 75 && carbonImpact !== 'HIGH' &&
    recycle >= 60 && ['none','low'].includes(hazard) && waste === 'full';

  // Build the AI prompt
  const prompt = `You are an AI Sustainability Compliance and Environmental Intelligence Engine integrated into the BIS Green Intelligence Portal.

Evaluate this product submission and generate a comprehensive sustainability assessment:

PRODUCT DATA:
- Company: ${company}
- Product: ${product}
- Electricity Consumption: ${elec} kWh/unit
- Transport Distance: ${dist} km
- Fuel Usage: ${fuel} litres/unit
- Annual Production Volume: ${volume} units
- Energy Efficiency Rating: ${eer}/5
- Recyclability: ${recycle}%
- Hazardous Material Usage: ${hazard}
- Waste Management Compliance: ${waste === 'full' ? 'Fully Compliant' : waste === 'partial' ? 'Partially Compliant' : 'Non-Compliant'}

PRE-COMPUTED METRICS (use these exact values):
- COâ‚‚ per unit: ${co2PerUnit.toFixed(2)} kg
- Annual Carbon Emission: ${annualCO2.toFixed(0)} kg COâ‚‚
- Carbon Impact Level: ${carbonImpact}
- Green Sustainability Score: ${greenScore}/100
- ECO-Mark Eligibility: ${ecoEligible ? 'Eligible' : 'Not Eligible'}

Your task â€” generate ONLY the following sections, nothing else:

SUSTAINABILITY_SUMMARY:
(Write exactly 2â€“3 sentences evaluating the product's overall environmental performance. Be specific about what's working and what isn't. Reference actual numbers.)

RECOMMENDATIONS:
(If Green Score < 85 OR ECO-Mark not eligible, list 3â€“5 specific, quantifiable, technically realistic engineering recommendations. Each on a new line starting with a number and period. If fully green, write "No major improvements required â€” product meets all sustainability benchmarks.")

Keep language professional, precise, engineering-focused. No preamble. No extra sections.`;

  /* â”€â”€ Badge Classification (deterministic, no API needed) â”€â”€ */
  function classifyBadge({ greenScore, carbonImpact, recycle, hazard, waste }) {
    // Platinum
    if (greenScore >= 85 && carbonImpact === 'LOW' && recycle >= 75 &&
        ['none','low'].includes(hazard) && waste === 'full') {
      return { tier:'platinum', emoji:'ğŸ†', label:'Platinum Green Certification',
        color:'#a855f7', glow:'rgba(168,85,247,0.4)', bg:'rgba(168,85,247,0.08)',
        border:'rgba(168,85,247,0.35)', ribbon:'#7c3aed', level:4 };
    }
    // Certified Green
    if (greenScore >= 70 && ['LOW','MEDIUM'].includes(carbonImpact) && recycle >= 60 &&
        hazard !== 'high' && ['full','partial'].includes(waste)) {
      return { tier:'green', emoji:'ğŸŒ¿', label:'Certified Green',
        color:'#4ade80', glow:'rgba(74,222,128,0.4)', bg:'rgba(74,222,128,0.08)',
        border:'rgba(74,222,128,0.35)', ribbon:'#16a34a', level:3 };
    }
    // Environmental Risk Alert (check before Improvement Required for HIGH cases)
    if (greenScore < 50 || carbonImpact === 'HIGH' || hazard === 'high' || waste === 'non') {
      return { tier:'red', emoji:'ğŸ”´', label:'Environmental Risk Alert',
        color:'#f87171', glow:'rgba(248,113,113,0.4)', bg:'rgba(248,113,113,0.08)',
        border:'rgba(248,113,113,0.35)', ribbon:'#dc2626', level:1 };
    }
    // Sustainability Improvement Required
    return { tier:'yellow', emoji:'âš ï¸', label:'Sustainability Improvement Required',
      color:'#fbbf24', glow:'rgba(251,191,36,0.4)', bg:'rgba(251,191,36,0.08)',
      border:'rgba(251,191,36,0.35)', ribbon:'#d97706', level:2 };
  }

  const badge = classifyBadge({ greenScore, carbonImpact, recycle: parseFloat(recycle), hazard, waste });

  let summary = '', recommendations = '', badgeInterpretation = '', badgeAdvisory = '';

  /* â”€â”€ Badge prompt (separate from sustainability prompt) â”€â”€ */
  const badgePrompt = `You are the Green Certification Badge Engine of the "BIS Green Intelligence Certification Platform â€” an AI-Driven Sustainable Compliance & Environmental Rating System" developed to promote engineering-based sustainability under national BIS certification schemes.

Your task is to assign a Sustainability Badge to a product based on its Green Sustainability Score, Carbon Impact Level, and Environmental Compliance parameters. You must strictly follow the badge classification logic defined below.

BIS GREEN INTELLIGENCE BADGE CLASSIFICATION RULES:
1. Platinum Green Certification: Score â‰¥ 85, Carbon LOW, Recyclability â‰¥ 75%, Hazardous None/Low, Waste Fully Compliant
2. Certified Green: Score 70â€“84, Carbon LOW/MEDIUM, Recyclability â‰¥ 60%, Hazardous not High, Waste at least Partially Compliant
3. Sustainability Improvement Required: Score 50â€“69, OR Carbon MEDIUM, OR moderate environmental risks
4. Environmental Risk Alert: Score < 50, OR Carbon HIGH, OR Hazardous High, OR Waste Non-Compliant

Product Submission:
- Product Name: ${product}
- Company Name: ${company}
- Green Sustainability Score: ${greenScore} / 100
- Carbon Impact Level: ${carbonImpact}
- Recyclability: ${recycle}%
- Hazardous Material Usage: ${hazard}
- Waste Management Compliance: ${waste === 'full' ? 'Fully Compliant' : waste === 'partial' ? 'Partially Compliant' : 'Non-Compliant'}
- Pre-Assigned Badge: ${badge.label}

Generate your response STRICTLY in this output format. No preamble, no extra sections:

BADGE_REPORT_TITLE: BIS GREEN INTELLIGENCE BADGE REPORT

PRODUCT_NAME: ${product}
COMPANY_NAME: ${company}
GREEN_SCORE: ${greenScore} / 100
CARBON_IMPACT: ${carbonImpact}
ASSIGNED_BADGE: ${badge.label}

BADGE_INTERPRETATION:
(Write exactly 1â€“2 lines explaining what the ${badge.label} badge signifies in terms of sustainability performance for this product. Reference actual score and carbon level. Professional and authoritative tone.)

BADGE_ADVISORY:
(If badge is Sustainability Improvement Required or Environmental Risk Alert: provide exactly 2â€“3 concise, technically specific sustainability improvement recommendations. Each on its own line starting with a dash. If badge is Platinum Green Certification or Certified Green: write exactly "This product demonstrates exemplary engineering-based sustainability standards and is recognised under the BIS Green Intelligence Certification Platform.")

Maintain professional and authoritative tone. Ensure logical consistency. Encourage responsible engineering practices.`;

  /* â”€â”€ Generate all text locally â€” instant, no API dependency â”€â”€ */
  summary = generateGreenSummary({ company, product, greenScore, co2PerUnit, annualCO2, carbonImpact, recycle, hazard, waste, ecoEligible });
  recommendations = generateGreenRecommendations({ greenScore, carbonImpact, recycle, hazard, waste, elec, dist, fuel, eerScore });
  badgeInterpretation = generateBadgeInterpretation({ badge, greenScore, carbonImpact, recycle, company, product });
  badgeAdvisory = generateBadgeAdvisory({ badge, greenScore, carbonImpact, recycle, hazard, waste });

  // Small artificial delay so spinner is visible (UX)
  await new Promise(r => setTimeout(r, 900));

  spinner.style.display = 'none';
  document.getElementById('greenSubmitBtn').disabled = false;

  renderGreenReport({ company, product, elec, dist, fuel, volume, eer, recycle, hazard, waste,
    co2PerUnit, annualCO2, carbonImpact, greenScore, ecoEligible, summary, recommendations,
    eerScore, hazardScore, wasteScore, carbonScore, badge, badgeInterpretation, badgeAdvisory });
}

/* â”€â”€ Render full report â”€â”€ */
function renderGreenReport(d) {
  const reportId = 'GRN-' + Date.now().toString().slice(-8);
  const scoreColor = d.greenScore >= 75 ? '#4ade80' : d.greenScore >= 50 ? '#fbbf24' : '#f87171';
  const ecoColor   = d.ecoEligible ? '#4ade80' : '#f87171';
  const b = d.badge || { tier:'yellow', emoji:'âš ï¸', label:'Sustainability Improvement Required',
    color:'#fbbf24', glow:'rgba(251,191,36,0.3)', bg:'rgba(251,191,36,0.06)',
    border:'rgba(251,191,36,0.3)', ribbon:'#d97706', level:2 };

  /* â”€â”€ Badge SVG ornament â”€â”€ */
  const shieldSVG = {
    platinum: `<svg width="64" height="72" viewBox="0 0 64 72" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M32 2 L58 14 L58 38 C58 54 44 66 32 70 C20 66 6 54 6 38 L6 14 Z" fill="url(#pg)" stroke="#c084fc" stroke-width="1.5"/>
      <defs><linearGradient id="pg" x1="32" y1="2" x2="32" y2="70" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#e879f9"/><stop offset="100%" stop-color="#7c3aed"/>
      </linearGradient></defs>
      <text x="32" y="42" text-anchor="middle" font-size="22" font-family="Arial">ğŸ†</text>
      <circle cx="32" cy="36" r="18" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
    </svg>`,
    green: `<svg width="64" height="72" viewBox="0 0 64 72" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M32 2 L58 14 L58 38 C58 54 44 66 32 70 C20 66 6 54 6 38 L6 14 Z" fill="url(#gg)" stroke="#4ade80" stroke-width="1.5"/>
      <defs><linearGradient id="gg" x1="32" y1="2" x2="32" y2="70" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#15803d"/>
      </linearGradient></defs>
      <text x="32" y="42" text-anchor="middle" font-size="22" font-family="Arial">ğŸŒ¿</text>
      <circle cx="32" cy="36" r="18" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
    </svg>`,
    yellow: `<svg width="64" height="72" viewBox="0 0 64 72" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M32 2 L58 14 L58 38 C58 54 44 66 32 70 C20 66 6 54 6 38 L6 14 Z" fill="url(#yg)" stroke="#fbbf24" stroke-width="1.5"/>
      <defs><linearGradient id="yg" x1="32" y1="2" x2="32" y2="70" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/>
      </linearGradient></defs>
      <text x="32" y="42" text-anchor="middle" font-size="22" font-family="Arial">âš ï¸</text>
      <circle cx="32" cy="36" r="18" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
    </svg>`,
    red: `<svg width="64" height="72" viewBox="0 0 64 72" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M32 2 L58 14 L58 38 C58 54 44 66 32 70 C20 66 6 54 6 38 L6 14 Z" fill="url(#rg)" stroke="#f87171" stroke-width="1.5"/>
      <defs><linearGradient id="rg" x1="32" y1="2" x2="32" y2="70" gradientUnits="userSpaceOnUse">
        <stop offset="0%" stop-color="#ef4444"/><stop offset="100%" stop-color="#b91c1c"/>
      </linearGradient></defs>
      <text x="32" y="42" text-anchor="middle" font-size="22" font-family="Arial">ğŸ”´</text>
      <circle cx="32" cy="36" r="18" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
    </svg>`
  };

  /* â”€â”€ Star tier indicators â”€â”€ */
  const stars = Array.from({length:4},(_,i) =>
    `<span style="font-size:14px;color:${i < b.level ? b.color : 'rgba(255,255,255,.15)'};text-shadow:${i < b.level ? '0 0 8px '+b.color : 'none'}">${i < b.level ? 'â˜…' : 'â˜†'}</span>`
  ).join('');

  /* â”€â”€ Advisory lines â”€â”€ */
  const advisoryHTML = (d.badgeAdvisory || '').split('\n').filter(r=>r.trim()).map(r =>
    r.trim().toLowerCase().startsWith('this product demonstrates') || r.trim().toLowerCase().startsWith('no major')
      ? `<div style="display:flex;gap:10px;padding:10px 14px;background:rgba(74,222,128,0.06);border-radius:10px;border-left:3px solid #4ade80"><span>âœ…</span><span style="font-size:13px;color:rgba(255,255,255,.8)">${r.trim()}</span></div>`
      : `<div style="display:flex;gap:10px;padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;border-left:3px solid ${b.color};margin-bottom:6px"><span style="font-size:13px">ğŸ”§</span><span style="font-size:13px;color:rgba(255,255,255,.8)">${r.trim()}</span></div>`
  ).join('');

  /* â”€â”€ Parse advisory lines â”€â”€ */
  const advisoryLines = (d.badgeAdvisory || '').split('\n')
    .map(l => l.trim()).filter(l => l && !l.startsWith('BADGE_ADVISORY'));
  const isPositiveAdvisory = advisoryLines.length === 1 &&
    (advisoryLines[0].toLowerCase().includes('exemplary') || advisoryLines[0].toLowerCase().includes('no major'));

  const advisoryRendered = isPositiveAdvisory
    ? `<div style="display:flex;gap:12px;align-items:flex-start;padding:12px 16px;background:rgba(74,222,128,0.08);border-radius:10px;border-left:3px solid #4ade80">
        <span style="font-size:16px">âœ…</span>
        <span style="font-size:13px;color:rgba(255,255,255,.85);line-height:1.65">${advisoryLines[0]}</span>
      </div>`
    : advisoryLines.map((line, i) => {
        const clean = line.replace(/^[-â€¢]\s*/, '').replace(/^\d+\.\s*/, '');
        return `<div style="display:flex;gap:12px;align-items:flex-start;padding:12px 16px;background:rgba(255,255,255,.04);border-radius:10px;border-left:3px solid ${b.color};margin-bottom:6px">
          <span style="flex-shrink:0;width:20px;height:20px;border-radius:50%;background:${b.color};display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;color:#000">${i+1}</span>
          <span style="font-size:13px;color:rgba(255,255,255,.85);line-height:1.65">${clean}</span>
        </div>`;
      }).join('');

  const badgeCard = `
  <!-- â•â•â•â•â•â•â•â•â•â• BADGE CERTIFICATE â•â•â•â•â•â•â•â•â•â• -->
  <div style="border-radius:22px;overflow:hidden;margin-bottom:28px;box-shadow:0 0 60px ${b.glow},0 24px 48px rgba(0,0,0,.35)">

    <!-- Certificate header band -->
    <div style="background:linear-gradient(135deg,${b.ribbon} 0%,${b.color} 100%);padding:18px 28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
      <div style="display:flex;align-items:center;gap:14px">
        <div style="width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.4);display:flex;align-items:center;justify-content:center;font-size:16px">ğŸŒ¿</div>
        <div>
          <div style="font-size:9px;font-weight:700;letter-spacing:.18em;text-transform:uppercase;color:rgba(255,255,255,.8)">BIS Green Intelligence Certification Platform</div>
          <div style="font-size:11px;font-weight:500;color:rgba(255,255,255,.65);margin-top:1px">AI-Driven Sustainable Compliance & Environmental Rating System</div>
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-size:9px;color:rgba(255,255,255,.6);letter-spacing:.08em">BADGE REPORT</div>
        <div style="font-size:10px;font-family:'Courier New',monospace;color:rgba(255,255,255,.8);margin-top:2px">BIS/GI/${reportId}</div>
      </div>
    </div>

    <!-- Main certificate body -->
    <div style="background:${b.bg};border:1.5px solid ${b.border};border-top:none;padding:28px 32px;position:relative;overflow:hidden">
      <!-- ambient glow -->
      <div style="position:absolute;top:-40px;right:-40px;width:200px;height:200px;border-radius:50%;background:${b.glow};filter:blur(60px);pointer-events:none;opacity:.6"></div>

      <!-- Row 1: Shield + Badge name + Stars -->
      <div style="display:flex;align-items:flex-start;gap:24px;margin-bottom:24px;flex-wrap:wrap">
        <div style="flex-shrink:0;filter:drop-shadow(0 6px 20px ${b.glow})">${shieldSVG[b.tier]}</div>
        <div style="flex:1;min-width:200px">
          <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.16em;color:${b.color};margin-bottom:8px">Assigned Badge</div>
          <div style="font-size:24px;font-weight:900;color:${b.color};font-family:'Playfair Display',serif;line-height:1.15;margin-bottom:8px">${b.label}</div>
          <div style="display:flex;gap:4px;margin-bottom:16px">
            ${Array.from({length:4},(_,i) =>
              `<span style="font-size:20px;color:${i < b.level ? b.color : 'rgba(255,255,255,.12)'};text-shadow:${i < b.level ? '0 0 10px '+b.color : 'none'};transition:all .3s">${i < b.level ? 'â˜…' : 'â˜†'}</span>`
            ).join('')}
            <span style="font-size:11px;color:rgba(255,255,255,.4);margin-left:8px;align-self:center">${b.level}/4</span>
          </div>
          <!-- Metric summary row -->
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <div style="display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:20px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)">
              <span style="width:7px;height:7px;border-radius:50%;background:${scoreColor};flex-shrink:0"></span>
              <span style="font-size:11px;color:rgba(255,255,255,.6)">Score</span>
              <span style="font-size:12px;font-weight:700;color:${scoreColor}">${d.greenScore}/100</span>
            </div>
            <div style="display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:20px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)">
              <span style="width:7px;height:7px;border-radius:50%;background:${d.carbonImpact==='LOW'?'#4ade80':d.carbonImpact==='MEDIUM'?'#fbbf24':'#f87171'};flex-shrink:0"></span>
              <span style="font-size:11px;color:rgba(255,255,255,.6)">Carbon</span>
              <span style="font-size:12px;font-weight:700;color:${d.carbonImpact==='LOW'?'#4ade80':d.carbonImpact==='MEDIUM'?'#fbbf24':'#f87171'}">${d.carbonImpact}</span>
            </div>
            <div style="display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:20px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)">
              <span style="width:7px;height:7px;border-radius:50%;background:${parseFloat(d.recycle)>=60?'#4ade80':'#f87171'};flex-shrink:0"></span>
              <span style="font-size:11px;color:rgba(255,255,255,.6)">Recycle</span>
              <span style="font-size:12px;font-weight:700;color:${parseFloat(d.recycle)>=60?'#4ade80':'#f87171'}">${d.recycle}%</span>
            </div>
            <div style="display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:20px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1)">
              <span style="width:7px;height:7px;border-radius:50%;background:${d.ecoEligible?'#4ade80':'#f87171'};flex-shrink:0"></span>
              <span style="font-size:11px;color:rgba(255,255,255,.6)">ECO-Mark</span>
              <span style="font-size:12px;font-weight:700;color:${d.ecoEligible?'#4ade80':'#f87171'}">${d.ecoEligible?'Eligible':'Not Eligible'}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Divider -->
      <div style="height:1px;background:linear-gradient(90deg,transparent,${b.border},transparent);margin-bottom:20px"></div>

      <!-- Structured report fields (matching spec exactly) -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">
        <div style="padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;border:1px solid rgba(255,255,255,.07)">
          <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:rgba(255,255,255,.35);margin-bottom:4px">Product Name</div>
          <div style="font-size:13px;font-weight:600;color:rgba(255,255,255,.9)">${d.product}</div>
        </div>
        <div style="padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;border:1px solid rgba(255,255,255,.07)">
          <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:rgba(255,255,255,.35);margin-bottom:4px">Company Name</div>
          <div style="font-size:13px;font-weight:600;color:rgba(255,255,255,.9)">${d.company}</div>
        </div>
        <div style="padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;border:1px solid rgba(255,255,255,.07)">
          <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:rgba(255,255,255,.35);margin-bottom:4px">Green Sustainability Score</div>
          <div style="font-size:16px;font-weight:800;color:${scoreColor}">${d.greenScore} / 100</div>
        </div>
        <div style="padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;border:1px solid rgba(255,255,255,.07)">
          <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:rgba(255,255,255,.35);margin-bottom:4px">Carbon Impact Level</div>
          <div style="font-size:16px;font-weight:800;color:${d.carbonImpact==='LOW'?'#4ade80':d.carbonImpact==='MEDIUM'?'#fbbf24':'#f87171'}">${d.carbonImpact}</div>
        </div>
      </div>

      <!-- Badge Interpretation -->
      <div style="background:rgba(255,255,255,.03);border:1px solid ${b.border};border-radius:12px;padding:16px 20px;margin-bottom:${advisoryLines.length && !isPositiveAdvisory || isPositiveAdvisory ? '16px' : '0'}">
        <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:${b.color};margin-bottom:8px">Badge Interpretation</div>
        <p style="font-size:13.5px;color:rgba(255,255,255,.8);line-height:1.75;margin:0">${d.badgeInterpretation || 'Badge assigned based on submitted environmental compliance parameters.'}</p>
      </div>

      <!-- Engineering Advisory (always shown) -->
      ${advisoryRendered ? `
      <div style="margin-top:16px">
        <div style="font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:${b.color};margin-bottom:10px">Engineering Advisory</div>
        ${advisoryRendered}
      </div>` : ''}
    </div>
  </div>`;
  const ciColor    = d.carbonImpact === 'LOW' ? '#4ade80' : d.carbonImpact === 'MEDIUM' ? '#fbbf24' : '#f87171';
  const barColor   = d.greenScore >= 75 ? 'bar-g' : d.greenScore >= 50 ? 'bar-w' : 'bar-r';

  // Build gauge arc path
  const angle = (d.greenScore / 100) * 180;
  const rad   = (angle - 90) * Math.PI / 180;
  const ex    = 60 + 48 * Math.cos(rad);
  const ey    = 60 + 48 * Math.sin(rad);
  const large = angle > 90 ? 1 : 0;

  // Metric component bars
  const components = [
    { label:'Energy Efficiency', score: Math.round(d.eerScore),   w:20 },
    { label:'Recyclability',     score: Math.round(d.recycle),    w:20 },
    { label:'Hazardous Material',score: d.hazardScore,            w:20 },
    { label:'Waste Management',  score: d.wasteScore,             w:20 },
    { label:'Carbon Impact',     score: d.carbonScore,            w:20 },
  ];

  const compBars = components.map(c => {
    const col = c.score >= 75 ? '#4ade80' : c.score >= 50 ? '#fbbf24' : '#f87171';
    return `<div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px">
        <span style="color:rgba(255,255,255,.7)">${c.label}</span>
        <span style="font-weight:700;color:${col}">${c.score}/100 <span style="color:rgba(255,255,255,.3);font-weight:400">(Ã—${c.w}%)</span></span>
      </div>
      <div style="height:7px;background:rgba(255,255,255,.08);border-radius:4px;overflow:hidden">
        <div style="height:100%;width:${c.score}%;background:${col};border-radius:4px;transition:width 1s ease"></div>
      </div>
    </div>`;
  }).join('');

  // Recommendations HTML
  const recsHTML = d.recommendations.split('\n').filter(r => r.trim()).map(r => {
    const clean = r.trim();
    const isNo  = clean.toLowerCase().startsWith('no major');
    return `<div style="display:flex;gap:10px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,.04);border-radius:10px;margin-bottom:8px;border-left:3px solid ${isNo ? '#4ade80' : '#22d3ee'}">
      <span style="font-size:14px;flex-shrink:0">${isNo ? 'âœ…' : 'ğŸ”§'}</span>
      <span style="font-size:13.5px;color:rgba(255,255,255,.85);line-height:1.6">${clean}</span>
    </div>`;
  }).join('');


  document.getElementById('greenResult').innerHTML = `
  <div class="result-card" style="border-color:rgba(74,222,128,0.25)">
    <!-- Header -->
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,.08)">
      <div>
        <div style="font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;color:#4ade80;margin-bottom:4px">BIS Green Intelligence Report</div>
        <h3 style="font-family:'Playfair Display',serif;font-size:22px;margin:0">${d.company} â€” ${d.product}</h3>
        <div style="font-size:11px;color:rgba(255,255,255,.35);margin-top:4px;font-family:'Courier New',monospace">${reportId}</div>
      </div>
      <span class="result-status-badge ${d.ecoEligible ? 's-approved' : 's-high'}" style="font-size:13px">${d.ecoEligible ? 'ğŸƒ ECO-Mark Eligible' : 'â›” Not ECO-Mark Eligible'}</span>
    </div>

    <!-- Main KPIs row -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:28px">
      <div style="background:rgba(74,222,128,0.08);border:1px solid rgba(74,222,128,0.2);border-radius:14px;padding:18px;text-align:center">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:#4ade80;margin-bottom:8px;font-weight:700">Green Score</div>
        <div style="font-size:42px;font-weight:900;color:${scoreColor};line-height:1">${d.greenScore}</div>
        <div style="font-size:12px;color:rgba(255,255,255,.4)">/100</div>
      </div>
      <div style="background:rgba(34,211,238,0.08);border:1px solid rgba(34,211,238,0.2);border-radius:14px;padding:18px;text-align:center">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:#22d3ee;margin-bottom:8px;font-weight:700">COâ‚‚ / Unit</div>
        <div style="font-size:32px;font-weight:900;color:${ciColor};line-height:1">${d.co2PerUnit.toFixed(2)}</div>
        <div style="font-size:12px;color:rgba(255,255,255,.4)">kg COâ‚‚</div>
      </div>
      <div style="background:rgba(${d.carbonImpact==='LOW'?'74,222,128':d.carbonImpact==='MEDIUM'?'251,191,36':'248,113,113'},0.08);border:1px solid rgba(${d.carbonImpact==='LOW'?'74,222,128':d.carbonImpact==='MEDIUM'?'251,191,36':'248,113,113'},0.2);border-radius:14px;padding:18px;text-align:center">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:${ciColor};margin-bottom:8px;font-weight:700">Carbon Impact</div>
        <div style="font-size:26px;font-weight:900;color:${ciColor};line-height:1">${d.carbonImpact}</div>
        <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:4px">${d.annualCO2.toLocaleString('en-IN')} kg/yr</div>
      </div>
      <div style="background:rgba(${d.ecoEligible?'74,222,128':'248,113,113'},0.08);border:1px solid rgba(${d.ecoEligible?'74,222,128':'248,113,113'},0.2);border-radius:14px;padding:18px;text-align:center">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:${ecoColor};margin-bottom:8px;font-weight:700">ECO-Mark</div>
        <div style="font-size:22px;font-weight:900;color:${ecoColor};line-height:1">${d.ecoEligible?'âœ…':'âŒ'}</div>
        <div style="font-size:12px;color:${ecoColor};margin-top:4px">${d.ecoEligible?'Eligible':'Not Eligible'}</div>
      </div>
    </div>

    <!-- â•â•â• GREEN BADGE CARD â•â•â• -->
    ${badgeCard}

    <!-- Score bar -->
    <div style="margin-bottom:28px">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px">
        <span style="font-weight:600;color:rgba(255,255,255,.7)">Green Sustainability Score</span>
        <span style="font-weight:800;color:${scoreColor}">${d.greenScore}/100</span>
      </div>
      <div class="score-bar-wrap"><div class="score-bar ${barColor}" style="width:${d.greenScore}%"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:11px;color:rgba(255,255,255,.3);margin-top:5px">
        <span>0 â€” Critical</span><span>50 â€” Moderate</span><span>75 â€” Eco-Eligible</span><span>100 â€” Excellent</span>
      </div>
    </div>

    <!-- Two-column: Component breakdown + Carbon details -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px">
      <div style="background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:20px">
        <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.4);margin-bottom:16px">Score Breakdown (5 Components Ã— 20%)</div>
        ${compBars}
      </div>
      <div style="background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:20px">
        <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.4);margin-bottom:16px">Carbon Footprint Calculation</div>
        <div style="font-size:12.5px;color:rgba(255,255,255,.65);line-height:2;font-family:'Courier New',monospace">
          <div>Electricity: ${d.elec} Ã— 0.82 = <span style="color:#22d3ee">${(d.elec*0.82).toFixed(2)} kg</span></div>
          <div>Transport:   ${d.dist} Ã— 0.12 = <span style="color:#22d3ee">${(d.dist*0.12).toFixed(2)} kg</span></div>
          <div>Fuel:        ${d.fuel} Ã— 2.68 = <span style="color:#22d3ee">${(d.fuel*2.68).toFixed(2)} kg</span></div>
          <div style="border-top:1px solid rgba(255,255,255,.1);padding-top:8px;margin-top:4px">COâ‚‚/unit = <span style="color:${ciColor};font-weight:700">${d.co2PerUnit.toFixed(2)} kg</span></div>
          <div>Annual = ${d.co2PerUnit.toFixed(2)} Ã— ${d.volume.toLocaleString('en-IN')}</div>
          <div style="color:#4ade80;font-weight:700">= ${d.annualCO2.toLocaleString('en-IN')} kg COâ‚‚/year</div>
          <div style="margin-top:10px;padding:8px 12px;background:rgba(${d.carbonImpact==='LOW'?'74,222,128':d.carbonImpact==='MEDIUM'?'251,191,36':'248,113,113'},0.1);border-radius:8px;color:${ciColor}">Impact: ${d.carbonImpact} ${d.carbonImpact==='LOW'?'(â‰¤20 kg/unit)':d.carbonImpact==='MEDIUM'?'(21â€“50 kg/unit)':'(>50 kg/unit)'}</div>
        </div>
      </div>
    </div>

    <!-- ECO-Mark eligibility checklist -->
    <div style="background:rgba(${d.ecoEligible?'74,222,128':'248,113,113'},0.06);border:1px solid rgba(${d.ecoEligible?'74,222,128':'248,113,113'},0.2);border-radius:14px;padding:20px;margin-bottom:28px">
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:${ecoColor};margin-bottom:14px">ğŸƒ ECO-Mark Eligibility Checklist</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        ${[
          ['Green Score â‰¥ 75', d.greenScore >= 75, `Score: ${d.greenScore}`],
          ['Carbon Impact â‰  HIGH', d.carbonImpact !== 'HIGH', `Impact: ${d.carbonImpact}`],
          ['Recyclability â‰¥ 60%', d.recycle >= 60, `Rate: ${d.recycle}%`],
          ['Hazardous: None/Low', ['none','low'].includes(d.hazard), `Level: ${d.hazard}`],
          ['Waste: Fully Compliant', d.waste === 'full', `Status: ${d.waste === 'full' ? 'Fully' : d.waste === 'partial' ? 'Partially' : 'Non'} Compliant`],
        ].map(([label, pass, detail]) => `
          <div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(${pass?'74,222,128':'248,113,113'},0.08);border-radius:8px">
            <span style="font-size:14px">${pass?'âœ…':'âŒ'}</span>
            <div><div style="font-size:12px;font-weight:600;color:rgba(255,255,255,.85)">${label}</div><div style="font-size:11px;color:rgba(255,255,255,.4)">${detail}</div></div>
          </div>`).join('')}
      </div>
    </div>

    <!-- AI Sustainability Summary -->
    <div style="background:rgba(74,222,128,0.06);border:1px solid rgba(74,222,128,0.18);border-radius:14px;padding:22px;margin-bottom:22px">
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#4ade80;margin-bottom:12px">ğŸ¤– AI Sustainability Assessment Summary</div>
      <p style="font-size:13.5px;color:rgba(255,255,255,.8);line-height:1.75;margin:0">${d.summary}</p>
    </div>

    <!-- Recommendations -->
    <div style="margin-bottom:24px">
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:#22d3ee;margin-bottom:14px">ğŸ”§ Engineering Improvement Recommendations</div>
      ${recsHTML}
    </div>

    <!-- Actions -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;padding-top:20px;border-top:1px solid rgba(255,255,255,.08)">
      <button class="btn-primary btn-sm" style="background:linear-gradient(135deg,#16a34a,#15803d);box-shadow:0 4px 16px rgba(22,163,74,0.35)" onclick="downloadGreenReport(${JSON.stringify({
        company:d.company,product:d.product,greenScore:d.greenScore,co2PerUnit:d.co2PerUnit,
        annualCO2:d.annualCO2,carbonImpact:d.carbonImpact,ecoEligible:d.ecoEligible,
        summary:d.summary,recommendations:d.recommendations,id:reportId,
        elec:d.elec,dist:d.dist,fuel:d.fuel,volume:d.volume,eer:d.eer,
        recycle:d.recycle,hazard:d.hazard,waste:d.waste,
        eerScore:d.eerScore,hazardScore:d.hazardScore,wasteScore:d.wasteScore,carbonScore:d.carbonScore,
        badge:d.badge,badgeInterpretation:d.badgeInterpretation,badgeAdvisory:d.badgeAdvisory
      }).replace(/"/g,'&quot;')})">â¬‡ Full Report + Badge</button>
      <button class="btn-accent btn-sm" style="border-radius:10px" onclick="downloadGreenCertificate(${JSON.stringify({
        company:d.company,product:d.product,greenScore:d.greenScore,co2PerUnit:d.co2PerUnit,
        annualCO2:d.annualCO2,carbonImpact:d.carbonImpact,ecoEligible:d.ecoEligible,
        recycle:d.recycle,hazard:d.hazard,waste:d.waste,id:reportId,
        badge:d.badge,badgeInterpretation:d.badgeInterpretation,badgeAdvisory:d.badgeAdvisory
      }).replace(/"/g,'&quot;')})">ğŸ† Download Certificate</button>
      <button class="btn-outline-white btn-sm" onclick="resetGreenForm()">ğŸ”„ New Assessment</button>
    </div>
  </div>`;

  toast(`Green Score: ${d.greenScore}/100 â€” ECO-Mark: ${d.ecoEligible ? 'Eligible âœ…' : 'Not Eligible âŒ'}`, d.ecoEligible ? 'ğŸŒ¿' : 'âš ï¸');
}

/* â”€â”€ Download Green Report â”€â”€ */
function downloadGreenReport(d) {
  if (typeof d === 'string') d = JSON.parse(d);
  const date = new Date().toLocaleDateString('en-IN', {day:'2-digit', month:'long', year:'numeric'});
  const ecoColor  = d.ecoEligible ? '#16a34a' : '#dc2626';
  const scColor   = d.greenScore >= 75 ? '#16a34a' : d.greenScore >= 50 ? '#d97706' : '#dc2626';
  const ciColor   = d.carbonImpact === 'LOW' ? '#16a34a' : d.carbonImpact === 'MEDIUM' ? '#d97706' : '#dc2626';

  const b = d.badge || { tier:'yellow', label:'Sustainability Improvement Required',
    color:'#d97706', ribbon:'#d97706', level:2 };

  const recsHtml = d.recommendations.split('\n').filter(r=>r.trim()).map(r =>
    `<li style="margin-bottom:8px;color:#374151;font-size:13.5px;line-height:1.7">${r.trim()}</li>`).join('');

  const badgeColorMap = { platinum:'#7c3aed', green:'#16a34a', yellow:'#d97706', red:'#dc2626' };
  const badgeBgMap   = { platinum:'#f5f3ff', green:'#f0fdf4', yellow:'#fffbeb', red:'#fef2f2' };
  const badgeBorderMap = { platinum:'#c4b5fd', green:'#86efac', yellow:'#fde68a', red:'#fca5a5' };
  const bCol = badgeColorMap[b.tier] || '#d97706';
  const bBg  = badgeBgMap[b.tier]   || '#fffbeb';
  const bBdr = badgeBorderMap[b.tier] || '#fde68a';
  const bStars = Array.from({length:4},(_,i) =>
    `<span style="font-size:16px;color:${i < (b.level||2) ? bCol : '#e5e7eb'}">${i < (b.level||2) ? 'â˜…' : 'â˜†'}</span>`).join('');

  const advisoryListHtml = (d.badgeAdvisory || '').split('\n').filter(r=>r.trim()).map(r =>
    `<li style="margin-bottom:8px;color:#374151;font-size:13px;line-height:1.7">${r.trim()}</li>`).join('');

  const components = [
    ['Energy Efficiency',   Math.round(d.eerScore),   20],
    ['Recyclability',       Math.round(d.recycle),    20],
    ['Hazardous Material',  d.hazardScore,            20],
    ['Waste Management',    d.wasteScore,             20],
    ['Carbon Impact',       d.carbonScore,            20],
  ];
  const compRows = components.map(([label, score, w]) => {
    const col = score >= 75 ? '#16a34a' : score >= 50 ? '#d97706' : '#dc2626';
    return `<tr style="border-bottom:1px solid #f1f5f9">
      <td style="padding:9px 14px;font-weight:600;color:#475569;background:#f8fafc;width:40%">${label}</td>
      <td style="padding:9px 14px;font-family:'Courier New',monospace">${score}/100</td>
      <td style="padding:9px 14px;color:#64748b">Weight: ${w}%</td>
      <td style="padding:9px 14px">
        <div style="height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden;width:120px">
          <div style="height:100%;width:${score}%;background:${col};border-radius:4px"></div>
        </div>
      </td>
    </tr>`;
  }).join('');

  const html = `<!DOCTYPE html>
<html>
<head><meta charset="UTF-8">
<style>
  body{font-family:'Segoe UI',Arial,sans-serif;margin:0;padding:0;background:#f0fdf4;color:#1e293b}
  .page{width:210mm;min-height:297mm;margin:0 auto;background:#fff;padding:0}
  .header{background:linear-gradient(135deg,#052e16,#14532d,#166534);color:#fff;padding:32px 40px;display:flex;justify-content:space-between;align-items:center}
  .logo-area{display:flex;align-items:center;gap:16px}
  .logo-circle{width:60px;height:60px;border-radius:50%;border:2px solid rgba(255,255,255,.4);background:rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:22px}
  .header-title{font-size:17px;font-weight:800;letter-spacing:.06em;text-transform:uppercase;line-height:1.2}
  .header-sub{font-size:11px;opacity:.7;margin-top:3px}
  .eco-badge{background:${d.ecoEligible?'#16a34a':'#dc2626'};color:#fff;padding:10px 20px;border-radius:8px;font-size:13px;font-weight:800;letter-spacing:.04em}
  .body{padding:32px 40px}
  .section-title{font-size:11.5px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:#64748b;border-bottom:2px solid #dcfce7;padding-bottom:8px;margin:24px 0 14px}
  .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:14px 0}
  .kpi{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:16px;text-align:center}
  .kpi .num{font-size:28px;font-weight:900;line-height:1}
  .kpi .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.08em;color:#64748b;margin-top:4px}
  table{width:100%;border-collapse:collapse}
  .bar-bg{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden}
  .remarks-box{background:#f0fdf4;border:1px solid #86efac;border-radius:10px;padding:16px 20px;margin-top:8px}
  .footer{margin-top:32px;padding:20px 40px;background:#f0fdf4;border-top:3px solid #86efac;display:flex;justify-content:space-between;font-size:11px;color:#64748b}
  @media print{body{background:#fff}.page{width:100%;padding:0}}
</style>
</head>
<body>
<div class="page">
  <div class="header">
    <div class="logo-area">
      <div class="logo-circle">ğŸŒ¿</div>
      <div>
        <div class="header-title">BIS Green Intelligence Portal</div>
        <div class="header-sub">Bureau of Indian Standards â€” AI Sustainability Compliance Engine</div>
        <div style="width:52px;height:4px;background:linear-gradient(90deg,#ff9933 33.3%,#fff 33.3% 66.6%,#138808 66.6%);margin-top:7px;border-radius:2px"></div>
      </div>
    </div>
    <div style="text-align:right">
      <div class="eco-badge">${d.ecoEligible ? 'ğŸƒ ECO-MARK ELIGIBLE' : 'â›” NOT ECO-ELIGIBLE'}</div>
      <div style="font-size:11px;opacity:.7;margin-top:8px">Report ID: ${d.id} | ${date}</div>
    </div>
  </div>

  <div class="body">
    <div style="font-size:20px;font-weight:800;color:#052e16;margin-bottom:4px">Green Sustainability Assessment Report</div>
    <div style="font-size:13px;color:#64748b">${d.company} â€” ${d.product}</div>

    <div class="section-title">Key Sustainability Metrics</div>
    <div class="kpi-grid">
      <div class="kpi"><div class="num" style="color:${scColor}">${d.greenScore}</div><div class="lbl">Green Score /100</div></div>
      <div class="kpi"><div class="num" style="color:${ciColor}">${d.co2PerUnit.toFixed(2)}</div><div class="lbl">COâ‚‚ per Unit (kg)</div></div>
      <div class="kpi"><div class="num" style="color:#0891b2;font-size:20px">${Number(d.annualCO2).toLocaleString('en-IN')}</div><div class="lbl">Annual COâ‚‚ (kg)</div></div>
      <div class="kpi"><div class="num" style="color:${ciColor};font-size:20px">${d.carbonImpact}</div><div class="lbl">Carbon Impact Level</div></div>
    </div>

    <div class="section-title">Carbon Footprint Calculation</div>
    <table style="font-size:13px">
      <tr style="background:#f0fdf4"><td style="padding:8px 14px;font-weight:600;color:#166534">Electricity</td><td style="padding:8px 14px;font-family:'Courier New',monospace">${d.elec} kWh Ã— 0.82 = ${(d.elec*0.82).toFixed(2)} kg COâ‚‚</td></tr>
      <tr><td style="padding:8px 14px;font-weight:600;color:#166534">Transport</td><td style="padding:8px 14px;font-family:'Courier New',monospace">${d.dist} km Ã— 0.12 = ${(d.dist*0.12).toFixed(2)} kg COâ‚‚</td></tr>
      <tr style="background:#f0fdf4"><td style="padding:8px 14px;font-weight:600;color:#166534">Fuel</td><td style="padding:8px 14px;font-family:'Courier New',monospace">${d.fuel} L Ã— 2.68 = ${(d.fuel*2.68).toFixed(2)} kg COâ‚‚</td></tr>
      <tr style="border-top:2px solid #86efac"><td style="padding:8px 14px;font-weight:800;color:#052e16">Total per Unit</td><td style="padding:8px 14px;font-family:'Courier New',monospace;font-weight:800;color:${ciColor}">${d.co2PerUnit.toFixed(2)} kg COâ‚‚</td></tr>
      <tr><td style="padding:8px 14px;font-weight:600;color:#052e16">Annual (${Number(d.volume).toLocaleString('en-IN')} units)</td><td style="padding:8px 14px;font-family:'Courier New',monospace;font-weight:700">${Number(d.annualCO2).toLocaleString('en-IN')} kg COâ‚‚</td></tr>
    </table>

    <div class="section-title">Score Component Breakdown</div>
    <table>${compRows}</table>

    <div class="section-title">AI Sustainability Assessment</div>
    <div class="remarks-box"><p style="margin:0;font-size:13.5px;color:#166534;line-height:1.7">${d.summary}</p></div>

    <div class="section-title">Engineering Improvement Recommendations</div>
    <ol style="margin:0;padding-left:20px">${recsHtml}</ol>

    <div class="section-title">ECO-Mark Eligibility Decision</div>
    <div style="background:${d.ecoEligible?'#f0fdf4':'#fef2f2'};border:2px solid ${d.ecoEligible?'#86efac':'#fca5a5'};border-radius:12px;padding:20px;text-align:center">
      <div style="font-size:28px;margin-bottom:8px">${d.ecoEligible?'ğŸƒ':'â›”'}</div>
      <div style="font-size:18px;font-weight:800;color:${ecoColor}">${d.ecoEligible?'ELIGIBLE FOR ECO-MARK':'NOT ELIGIBLE FOR ECO-MARK'}</div>
      <div style="font-size:12px;color:#64748b;margin-top:8px">${d.ecoEligible ? 'All 5 ECO-Mark conditions satisfied. Proceed to formal BIS ECO-Mark certification.' : 'One or more ECO-Mark conditions not met. Refer to recommendations above.'}</div>
    </div>
  </div>
  <div style="border-radius:16px;overflow:hidden;margin:28px 40px 0">
    <div style="background:linear-gradient(135deg,${bCol},${bBdr});padding:16px 28px;display:flex;align-items:center;justify-content:space-between">
      <div>
        <div style="font-size:9px;font-weight:700;letter-spacing:.16em;text-transform:uppercase;color:rgba(255,255,255,.85)">BIS GREEN INTELLIGENCE CERTIFICATION PLATFORM</div>
        <div style="font-size:10px;color:rgba(255,255,255,.65);margin-top:2px">AI-Driven Sustainable Compliance &amp; Environmental Rating System</div>
      </div>
      <div style="text-align:right;font-size:10px;font-family:'Courier New',monospace;color:rgba(255,255,255,.7)">${d.id}</div>
    </div>
    <div style="background:${bBg};border:2px solid ${bBdr};border-top:none;padding:24px 28px">
      <div style="text-align:center;padding-bottom:20px;border-bottom:1px dashed ${bBdr};margin-bottom:20px">
        <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.18em;color:${bCol};margin-bottom:8px">ğŸ… BIS Green Intelligence Badge Report</div>
        <div style="font-size:22px;font-weight:800;color:${bCol};margin-bottom:8px">${b.label}</div>
        <div>${bStars}</div>
      </div>
      <table style="width:100%;border-collapse:collapse;margin-bottom:16px">
        <tr style="background:#f8fafc"><td style="padding:9px 14px;font-weight:600;color:#475569;width:45%;font-size:12px;border-bottom:1px solid #e2e8f0">Product Name</td><td style="padding:9px 14px;font-size:13px;color:#1e293b;border-bottom:1px solid #e2e8f0">${d.product}</td></tr>
        <tr><td style="padding:9px 14px;font-weight:600;color:#475569;font-size:12px;border-bottom:1px solid #e2e8f0">Company Name</td><td style="padding:9px 14px;font-size:13px;color:#1e293b;border-bottom:1px solid #e2e8f0">${d.company}</td></tr>
        <tr style="background:#f8fafc"><td style="padding:9px 14px;font-weight:600;color:#475569;font-size:12px;border-bottom:1px solid #e2e8f0">Green Sustainability Score</td><td style="padding:9px 14px;font-size:15px;font-weight:800;color:${bCol};border-bottom:1px solid #e2e8f0">${d.greenScore} / 100</td></tr>
        <tr><td style="padding:9px 14px;font-weight:600;color:#475569;font-size:12px;border-bottom:1px solid #e2e8f0">Carbon Impact Level</td><td style="padding:9px 14px;font-size:15px;font-weight:800;color:${bCol};border-bottom:1px solid #e2e8f0">${d.carbonImpact}</td></tr>
        <tr style="background:#f8fafc"><td style="padding:9px 14px;font-weight:600;color:#475569;font-size:12px">Assigned Badge</td><td style="padding:9px 14px;font-size:13px;font-weight:700;color:${bCol}">${b.label}</td></tr>
      </table>
      <div style="background:white;border:1px solid ${bBdr};border-radius:8px;padding:14px 18px;margin-bottom:12px">
        <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:${bCol};margin-bottom:8px">Badge Interpretation</div>
        <p style="font-size:13px;color:#374151;line-height:1.75;margin:0">${d.badgeInterpretation || ''}</p>
      </div>
      ${advisoryListHtml ? `<div style="background:white;border:1px solid ${bBdr};border-radius:8px;padding:14px 18px"><div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:${bCol};margin-bottom:10px">Engineering Advisory</div><ol style="margin:0;padding-left:20px">${advisoryListHtml}</ol></div>` : ''}
    </div>
  </div>


  <div class="footer">
    <div><div>BIS Green Intelligence Portal â€” AI Sustainability Compliance Engine</div><div>BIS Act, 2016 | Environment Protection Act, 1986 | Helpline: 1800-11-4000 | bis.gov.in</div></div>
    <div style="text-align:right">Report ID: ${d.id}<br>Generated: ${date}</div>
  </div>
</div>
</body></html>`;

  const blob = new Blob([html], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url;
  a.download = `BIS_Green_Report_${d.id}.html`;
  document.body.appendChild(a); a.click();
  setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
  toast('Green Intelligence Report downloaded', 'ğŸŒ¿');
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GREEN INTELLIGENCE CERTIFICATE GENERATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function downloadGreenCertificate(d) {
  if (typeof d === 'string') d = JSON.parse(d);

  const b = d.badge || { tier:'yellow', label:'Sustainability Improvement Required', level:2 };
  const date     = new Date().toLocaleDateString('en-IN', {day:'2-digit', month:'long', year:'numeric'});
  const year     = new Date().getFullYear();
  const certNum  = `BIS/GICERT/${year}/${d.id}`;

  /* â”€â”€ Tier-specific design tokens â”€â”€ */
  const tiers = {
    platinum: {
      bg1:'#1a0533', bg2:'#2d0a52', bg3:'#3d1466',
      accent:'#e879f9', accent2:'#c084fc', gold:'#f0e68c',
      border:'#c084fc', shimmer:'linear-gradient(90deg,#e879f9,#c084fc,#a855f7,#c084fc,#e879f9)',
      headerBg:'linear-gradient(135deg,#1a0533 0%,#3d1466 50%,#1a0533 100%)',
      badgeBg:'linear-gradient(135deg,#7c3aed,#a855f7,#c084fc)',
      sealColor:'#c084fc', ribbonLeft:'#ff9933', ribbonRight:'#138808',
      emblemBg:'linear-gradient(135deg,#4c1d95,#7c3aed)',
      watermark:'PLATINUM',
      title:'Certificate of Platinum Green Certification',
      subtitle:'Highest Honour in Environmental Sustainability',
      icon:'ğŸ†', stars:4
    },
    green: {
      bg1:'#052e16', bg2:'#14532d', bg3:'#166534',
      accent:'#4ade80', accent2:'#86efac', gold:'#fde68a',
      border:'#4ade80', shimmer:'linear-gradient(90deg,#4ade80,#86efac,#22c55e,#86efac,#4ade80)',
      headerBg:'linear-gradient(135deg,#052e16 0%,#166534 50%,#052e16 100%)',
      badgeBg:'linear-gradient(135deg,#15803d,#22c55e,#4ade80)',
      sealColor:'#4ade80', ribbonLeft:'#ff9933', ribbonRight:'#4ade80',
      emblemBg:'linear-gradient(135deg,#14532d,#22c55e)',
      watermark:'CERTIFIED',
      title:'Certificate of Green Certification',
      subtitle:'Certified Environmental Compliance & Sustainability',
      icon:'ğŸŒ¿', stars:3
    },
    yellow: {
      bg1:'#431407', bg2:'#7c2d12', bg3:'#9a3412',
      accent:'#fbbf24', accent2:'#fde68a', gold:'#fde68a',
      border:'#f59e0b', shimmer:'linear-gradient(90deg,#fbbf24,#fde68a,#f59e0b,#fde68a,#fbbf24)',
      headerBg:'linear-gradient(135deg,#431407 0%,#9a3412 50%,#431407 100%)',
      badgeBg:'linear-gradient(135deg,#b45309,#d97706,#fbbf24)',
      sealColor:'#fbbf24', ribbonLeft:'#ff9933', ribbonRight:'#f59e0b',
      emblemBg:'linear-gradient(135deg,#92400e,#d97706)',
      watermark:'IMPROVEMENT',
      title:'Sustainability Improvement Notice',
      subtitle:'Environmental Performance Review & Advisory',
      icon:'âš ï¸', stars:2
    },
    red: {
      bg1:'#1c0505', bg2:'#450a0a', bg3:'#7f1d1d',
      accent:'#f87171', accent2:'#fca5a5', gold:'#fde68a',
      border:'#ef4444', shimmer:'linear-gradient(90deg,#f87171,#fca5a5,#ef4444,#fca5a5,#f87171)',
      headerBg:'linear-gradient(135deg,#1c0505 0%,#7f1d1d 50%,#1c0505 100%)',
      badgeBg:'linear-gradient(135deg,#991b1b,#dc2626,#f87171)',
      sealColor:'#f87171', ribbonLeft:'#ff9933', ribbonRight:'#ef4444',
      emblemBg:'linear-gradient(135deg,#7f1d1d,#ef4444)',
      watermark:'RISK ALERT',
      title:'Environmental Risk Alert Notice',
      subtitle:'Immediate Environmental Compliance Action Required',
      icon:'ğŸ”´', stars:1
    }
  };

  const t = tiers[b.tier] || tiers.yellow;
  const starsHTML = Array.from({length:4}, (_,i) =>
    `<span style="font-size:22px;color:${i<t.stars?t.gold:'rgba(255,255,255,.15)'};text-shadow:${i<t.stars?'0 0 12px '+t.gold:'none'}">${i<t.stars?'â˜…':'â˜†'}</span>`
  ).join('&nbsp;');

  /* Advisory list */
  const advLines = (d.badgeAdvisory||'').split('\n').map(l=>l.trim()).filter(l=>l&&!l.startsWith('BADGE_ADVISORY'));
  const isPositive = advLines.length===1 && (advLines[0].toLowerCase().includes('exemplary')||advLines[0].toLowerCase().includes('no major'));
  const advHTML = isPositive
    ? `<p style="color:rgba(255,255,255,.75);font-size:13px;line-height:1.7;margin:0;font-style:italic">${advLines[0]}</p>`
    : `<ol style="margin:0;padding-left:20px">${advLines.map(l=>`<li style="color:rgba(255,255,255,.8);font-size:12.5px;line-height:1.75;margin-bottom:6px">${l.replace(/^[-â€¢]\s*/,'').replace(/^\d+\.\s*/,'')}</li>`).join('')}</ol>`;

  /* Condition checklist */
  const conditions = b.tier === 'platinum' ? [
    ['Green Score â‰¥ 85', d.greenScore >= 85, `${d.greenScore}/100`],
    ['Carbon Impact: LOW', d.carbonImpact === 'LOW', d.carbonImpact],
    ['Recyclability â‰¥ 75%', parseFloat(d.recycle) >= 75, `${d.recycle}%`],
    ['Hazardous: None/Low', ['none','low'].includes(d.hazard), d.hazard],
    ['Waste: Fully Compliant', d.waste === 'full', d.waste === 'full' ? 'Fully Compliant' : 'Non-Compliant'],
  ] : b.tier === 'green' ? [
    ['Green Score 70â€“84', d.greenScore >= 70, `${d.greenScore}/100`],
    ['Carbon: LOW/MEDIUM', ['LOW','MEDIUM'].includes(d.carbonImpact), d.carbonImpact],
    ['Recyclability â‰¥ 60%', parseFloat(d.recycle) >= 60, `${d.recycle}%`],
    ['Hazardous: Not High', d.hazard !== 'high', d.hazard],
    ['Waste: Partially+ Compliant', ['full','partial'].includes(d.waste), d.waste === 'full' ? 'Fully Compliant' : 'Partially Compliant'],
  ] : b.tier === 'yellow' ? [
    ['Green Score 50â€“69', d.greenScore >= 50 && d.greenScore <= 69, `${d.greenScore}/100`],
    ['Carbon Impact', true, d.carbonImpact],
    ['Recyclability', true, `${d.recycle}%`],
    ['Hazardous Material', true, d.hazard],
    ['Waste Management', true, d.waste === 'full' ? 'Fully Compliant' : d.waste === 'partial' ? 'Partially Compliant' : 'Non-Compliant'],
  ] : [
    ['Green Score < 50', d.greenScore < 50, `${d.greenScore}/100`],
    ['Carbon: HIGH Impact', d.carbonImpact === 'HIGH', d.carbonImpact],
    ['Hazardous: High Usage', d.hazard === 'high', d.hazard],
    ['Waste Non-Compliant', d.waste === 'non', d.waste === 'non' ? 'Non-Compliant' : d.waste],
  ];

  const condHTML = conditions.map(([label, pass, val]) =>
    `<tr>
      <td style="padding:7px 12px;font-size:11.5px;color:rgba(255,255,255,.7);border-bottom:1px solid rgba(255,255,255,.07)">${label}</td>
      <td style="padding:7px 12px;text-align:center;border-bottom:1px solid rgba(255,255,255,.07)">${b.tier==='yellow'||b.tier==='red'?'<span style="color:rgba(255,255,255,.4);font-size:11px">â€”</span>':`<span style="font-size:13px">${pass?'âœ…':'âŒ'}</span>`}</td>
      <td style="padding:7px 12px;font-size:11.5px;font-weight:600;color:${b.tier==='yellow'?'rgba(255,255,255,.6)':pass?t.accent:'#f87171'};text-align:right;border-bottom:1px solid rgba(255,255,255,.07)">${val}</td>
    </tr>`
  ).join('');

  /* Ashoka Chakra spokes SVG */
  const chakraSpokes = Array.from({length:24},(_,i)=>{
    const a=(i*15-90)*Math.PI/180;
    const x1=50+16*Math.cos(a),y1=50+16*Math.sin(a),x2=50+32*Math.cos(a),y2=50+32*Math.sin(a);
    return `<line x1="${x1.toFixed(1)}" y1="${y1.toFixed(1)}" x2="${x2.toFixed(1)}" y2="${y2.toFixed(1)}" stroke="${t.sealColor}" stroke-width="1.2" opacity=".7"/>`;
  }).join('');

  const html = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BIS Green Intelligence Certificate â€” ${d.company}</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,800;0,900;1,700&family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg1:${t.bg1};--bg2:${t.bg2};--bg3:${t.bg3};
    --accent:${t.accent};--accent2:${t.accent2};--gold:${t.gold};
    --border:${t.border};
  }
  body{background:var(--bg1);color:#fff;font-family:'Poppins',sans-serif;min-height:100vh}

  /* Animated shimmer line */
  @keyframes shimmer{0%{background-position:0% 50%}100%{background-position:200% 50%}}
  @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
  @keyframes glow{0%,100%{opacity:.6}50%{opacity:1}}
  @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

  .cert-page{
    width:210mm;min-height:297mm;margin:0 auto;
    background:${t.headerBg};
    position:relative;overflow:hidden;
  }

  /* Corner ornaments */
  .corner{position:absolute;width:80px;height:80px}
  .corner svg{width:100%;height:100%}
  .c-tl{top:0;left:0}
  .c-tr{top:0;right:0;transform:scaleX(-1)}
  .c-bl{bottom:0;left:0;transform:scaleY(-1)}
  .c-br{bottom:0;right:0;transform:scale(-1,-1)}

  /* Grid texture */
  .bg-grid{
    position:absolute;inset:0;
    background-image:linear-gradient(rgba(255,255,255,.02) 1px,transparent 1px),
      linear-gradient(90deg,rgba(255,255,255,.02) 1px,transparent 1px);
    background-size:28px 28px;
    pointer-events:none
  }

  /* Radial glow orbs */
  .orb{position:absolute;border-radius:50%;filter:blur(90px);pointer-events:none;opacity:.18}
  .orb-1{width:400px;height:400px;background:${t.accent};top:-100px;left:-100px;animation:glow 6s ease-in-out infinite}
  .orb-2{width:300px;height:300px;background:${t.accent2};bottom:-80px;right:-80px;animation:glow 6s ease-in-out infinite 3s}

  /* Watermark */
  .watermark{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-30deg);
    font-family:'Playfair Display',serif;font-size:72px;font-weight:900;
    color:rgba(255,255,255,0.025);letter-spacing:.1em;white-space:nowrap;pointer-events:none;
    text-transform:uppercase
  }

  /* Shimmer top/bottom border */
  .shimmer-bar{
    height:4px;width:100%;
    background:${t.shimmer};
    background-size:200% auto;
    animation:shimmer 3s linear infinite;
  }

  /* Tricolor bar */
  .tricolor{height:3px;background:linear-gradient(90deg,#ff9933 33.3%,rgba(255,255,255,.8) 33.3% 66.6%,#138808 66.6%);width:100%}

  /* Content wrapper */
  .content{position:relative;z-index:10;padding:0 48px 48px}

  /* Header section */
  .header{padding:28px 0 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1)}
  .govt-badge{display:flex;align-items:center;gap:10px}
  .emblem-ring{width:54px;height:54px;border-radius:50%;background:${t.emblemBg};border:2px solid ${t.border};display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 0 16px ${t.accent}44}
  .header-text{font-size:8.5px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.6);line-height:1.8}
  .header-text strong{display:block;font-size:10px;color:rgba(255,255,255,.85);margin-bottom:2px}
  .cert-ref{text-align:right;font-size:9px;color:rgba(255,255,255,.4);letter-spacing:.06em;line-height:1.7;font-family:'Courier New',monospace}

  /* Badge medallion */
  .medallion-zone{text-align:center;padding:40px 0 32px;animation:fadeIn .8s ease both}
  .badge-ring-outer{
    width:180px;height:180px;border-radius:50%;
    background:${t.badgeBg};
    display:inline-flex;align-items:center;justify-content:center;
    box-shadow:0 0 0 6px rgba(255,255,255,.06),0 0 0 12px rgba(255,255,255,.03),0 0 60px ${t.accent}55;
    animation:pulse 4s ease-in-out infinite;position:relative
  }
  .badge-icon{font-size:72px;line-height:1;filter:drop-shadow(0 4px 16px rgba(0,0,0,.5))}
  .tier-label{font-size:8px;font-weight:700;letter-spacing:.24em;text-transform:uppercase;color:${t.accent};margin:22px 0 8px;opacity:.8}
  .cert-title{font-family:'Playfair Display',serif;font-size:clamp(22px,3.5vw,32px);font-weight:900;line-height:1.2;text-align:center;
    background:${t.shimmer};background-size:200% auto;animation:shimmer 4s linear infinite;
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    max-width:600px;margin:0 auto 10px}
  .cert-subtitle{font-family:'Cormorant Garamond',serif;font-size:14px;font-style:italic;color:rgba(255,255,255,.5);text-align:center;letter-spacing:.06em;margin-bottom:28px}
  .stars-row{display:flex;justify-content:center;gap:6px;margin-bottom:32px}

  /* Certificate body text */
  .cert-body{
    font-family:'Cormorant Garamond',serif;font-size:15px;line-height:1.9;
    color:rgba(255,255,255,.75);text-align:center;max-width:560px;margin:0 auto 32px;
    border-top:1px solid rgba(255,255,255,.08);border-bottom:1px solid rgba(255,255,255,.08);
    padding:24px 0;animation:fadeIn .8s .2s ease both
  }
  .cert-body strong{color:#fff;font-weight:700;font-size:17px}
  .cert-body .highlight{color:${t.accent};font-weight:600}

  /* Metrics strip */
  .metrics-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:28px;animation:fadeIn .8s .3s ease both}
  .metric{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px 10px;text-align:center}
  .metric .val{font-size:18px;font-weight:800;color:${t.accent};line-height:1}
  .metric .lbl{font-size:9px;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.4);margin-top:5px}

  /* Condition table */
  .conditions-wrap{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;margin-bottom:28px;animation:fadeIn .8s .35s ease both}
  .conditions-title{padding:12px 16px;font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.14em;color:${t.accent};background:rgba(255,255,255,.04);border-bottom:1px solid rgba(255,255,255,.06)}

  /* Interpretation + advisory */
  .interp-box{background:rgba(255,255,255,.04);border:1px solid ${t.border}44;border-radius:14px;padding:20px 24px;margin-bottom:${advLines.length ? '20px' : '28px'};animation:fadeIn .8s .4s ease both}
  .interp-label{font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.14em;color:${t.accent};margin-bottom:10px}
  .interp-text{font-family:'Cormorant Garamond',serif;font-size:15px;line-height:1.8;color:rgba(255,255,255,.8);font-style:italic}
  .advisory-box{background:rgba(255,255,255,.04);border:1px solid ${t.border}44;border-radius:14px;padding:20px 24px;margin-bottom:28px;animation:fadeIn .8s .45s ease both}
  .advisory-label{font-size:9.5px;font-weight:700;text-transform:uppercase;letter-spacing:.14em;color:${t.accent};margin-bottom:12px}

  /* Signature section */
  .sig-section{display:grid;grid-template-columns:1fr auto 1fr;gap:20px;align-items:end;margin-bottom:32px;animation:fadeIn .8s .5s ease both}
  .sig-block{text-align:center}
  .sig-line{height:1px;background:linear-gradient(90deg,transparent,${t.border},transparent);margin-bottom:10px}
  .sig-name{font-size:12.5px;font-weight:700;color:#fff}
  .sig-title{font-size:10px;color:rgba(255,255,255,.5);margin-top:3px}
  .sig-dept{font-size:9.5px;color:rgba(255,255,255,.4);margin-top:2px}

  /* Seal SVG */
  .seal-center{text-align:center}

  /* SVG signatures */
  .sig-svg{display:block;margin:0 auto 8px}

  /* Footer */
  .cert-footer{padding-top:18px;border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;align-items:center;font-size:9px;color:rgba(255,255,255,.3);letter-spacing:.04em}

  @media print{
    body{background:${t.bg1}}
    .cert-page{width:100%;margin:0}
    .shimmer-bar{animation:none}
    .badge-ring-outer{animation:none}
  }
</style>
</head>
<body>
<div class="cert-page">
  <!-- Background layers -->
  <div class="bg-grid"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="watermark">${t.watermark}</div>

  <!-- Corner ornaments -->
  <div class="corner c-tl">
    <svg viewBox="0 0 80 80" fill="none"><path d="M0 0 L80 0 L80 8 L8 8 L8 80 L0 80 Z" fill="${t.accent}" opacity=".15"/><path d="M0 0 L40 0 L40 3 L3 3 L3 40 L0 40 Z" fill="${t.accent}" opacity=".4"/><circle cx="3" cy="3" r="3" fill="${t.accent}" opacity=".7"/><rect x="12" y="0" width="2" height="12" fill="${t.accent}" opacity=".3"/><rect x="20" y="0" width="2" height="8" fill="${t.accent}" opacity=".2"/><rect x="0" y="12" width="12" height="2" fill="${t.accent}" opacity=".3"/><rect x="0" y="20" width="8" height="2" fill="${t.accent}" opacity=".2"/></svg>
  </div>
  <div class="corner c-tr">
    <svg viewBox="0 0 80 80" fill="none"><path d="M0 0 L80 0 L80 0 L80 80 L72 80 L72 8 L0 8 Z" fill="${t.accent}" opacity=".15"/><path d="M40 0 L80 0 L80 40 L77 40 L77 3 L40 3 Z" fill="${t.accent}" opacity=".4"/><circle cx="77" cy="3" r="3" fill="${t.accent}" opacity=".7"/></svg>
  </div>
  <div class="corner c-bl">
    <svg viewBox="0 0 80 80" fill="none"><path d="M0 0 L8 0 L8 72 L80 72 L80 80 L0 80 Z" fill="${t.accent}" opacity=".15"/><path d="M0 40 L3 40 L3 77 L40 77 L40 80 L0 80 Z" fill="${t.accent}" opacity=".4"/><circle cx="3" cy="77" r="3" fill="${t.accent}" opacity=".7"/></svg>
  </div>
  <div class="corner c-br">
    <svg viewBox="0 0 80 80" fill="none"><path d="M72 0 L80 0 L80 80 L0 80 L0 72 L72 72 Z" fill="${t.accent}" opacity=".15"/><path d="M40 77 L77 77 L77 40 L80 40 L80 80 L40 80 Z" fill="${t.accent}" opacity=".4"/><circle cx="77" cy="77" r="3" fill="${t.accent}" opacity=".7"/></svg>
  </div>

  <!-- Top shimmer + tricolor -->
  <div class="shimmer-bar"></div>
  <div class="tricolor"></div>

  <!-- Content -->
  <div class="content">

    <!-- Header -->
    <div class="header">
      <div class="govt-badge">
        <div class="emblem-ring">ğŸŒ¿</div>
        <div class="header-text">
          <strong>Bureau of Indian Standards</strong>
          Ministry of Consumer Affairs, Food & Public Distribution<br>
          Government of India â€” BIS Act, 2016
        </div>
      </div>
      <div class="cert-ref">
        Certificate No: ${certNum}<br>
        Issue Date: ${date}<br>
        Scheme: BIS Green Intelligence<br>
        Portal Ref: ${d.id}
      </div>
    </div>

    <!-- Badge medallion -->
    <div class="medallion-zone">
      <div class="badge-ring-outer">
        <span class="badge-icon">${t.icon}</span>
      </div>
      <div class="tier-label">BIS Green Intelligence Certification Platform</div>
      <div class="cert-title">${t.title}</div>
      <div class="cert-subtitle">${t.subtitle}</div>
      <div class="stars-row">${starsHTML}</div>
    </div>

    <!-- Body text -->
    <div class="cert-body">
      This is to certify that<br>
      <strong>${d.company}</strong><br>
      for the product <span class="highlight">${d.product}</span><br>
      has been evaluated under the <em>BIS Green Intelligence Certification Platform â€”<br>
      An AI-Driven Sustainable Compliance &amp; Environmental Rating System</em><br>
      and has been assigned the badge<br>
      <span class="highlight" style="font-size:16px;font-weight:700">${b.label}</span><br>
      <em style="font-size:13px;opacity:.6">in accordance with BIS Environmental Compliance Standards and BIS Act, 2016.</em>
    </div>

    <!-- Metrics strip -->
    <div class="metrics-strip">
      <div class="metric">
        <div class="val">${d.greenScore}</div>
        <div class="lbl">Green Score /100</div>
      </div>
      <div class="metric">
        <div class="val" style="font-size:14px;color:${d.carbonImpact==='LOW'?'#4ade80':d.carbonImpact==='MEDIUM'?'#fbbf24':'#f87171'}">${d.carbonImpact}</div>
        <div class="lbl">Carbon Impact</div>
      </div>
      <div class="metric">
        <div class="val">${d.recycle}%</div>
        <div class="lbl">Recyclability</div>
      </div>
      <div class="metric">
        <div class="val" style="font-size:13px;color:${d.ecoEligible?'#4ade80':'#f87171'}">${d.ecoEligible?'Yes':'No'}</div>
        <div class="lbl">ECO-Mark Eligible</div>
      </div>
    </div>

    <!-- Conditions checklist -->
    <div class="conditions-wrap">
      <div class="conditions-title">Badge Classification Criteria Evaluation</div>
      <table style="width:100%;border-collapse:collapse">
        ${condHTML}
      </table>
    </div>

    <!-- Badge interpretation -->
    ${d.badgeInterpretation ? `
    <div class="interp-box">
      <div class="interp-label">Badge Interpretation</div>
      <div class="interp-text">${d.badgeInterpretation}</div>
    </div>` : ''}

    <!-- Advisory -->
    ${advLines.length ? `
    <div class="advisory-box">
      <div class="advisory-label">Engineering Advisory</div>
      ${advHTML}
    </div>` : ''}

    <!-- Signatures -->
    <div class="sig-section">
      <!-- Regional Officer signature -->
      <div class="sig-block">
        <svg class="sig-svg" width="160" height="48" viewBox="0 0 160 48">
          <path d="M10,36 C16,20 24,14 32,18 C38,21 36,32 28,34 C22,35 20,28 26,25 M32,18 C40,12 50,30 46,38" fill="none" stroke="${t.accent}" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M54,16 C56,26 55,36 58,40 M50,28 C58,26 66,22 70,26 C74,30 70,38 66,40" fill="none" stroke="${t.accent}" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M80,18 C82,30 80,38 82,42 M78,28 C86,24 94,22 96,28 C98,34 94,42 90,44" fill="none" stroke="${t.accent}" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M106,22 C110,18 118,16 122,20 C126,24 124,32 118,34 C112,36 108,30 112,26 C116,22 124,24 128,30 C132,36 130,44 126,46" fill="none" stroke="${t.accent}" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
        <div class="sig-line"></div>
        <div class="sig-name">Shri R. K. Sharma</div>
        <div class="sig-title">Regional Officer</div>
        <div class="sig-dept">BIS Northern Regional Office</div>
        <div style="font-size:9px;color:rgba(255,255,255,.25);margin-top:3px;font-family:'Courier New',monospace">BIS/RO/NR/2024/047</div>
      </div>

      <!-- Central seal -->
      <div class="seal-center">
        <svg width="110" height="110" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="47" fill="none" stroke="${t.border}" stroke-width="2.5"/>
          <circle cx="50" cy="50" r="40" fill="none" stroke="${t.border}" stroke-width="1" opacity=".5"/>
          <circle cx="50" cy="50" r="34" fill="${t.bg2}" opacity=".8"/>
          ${chakraSpokes}
          <circle cx="50" cy="50" r="33" fill="none" stroke="${t.border}" stroke-width="1.5" opacity=".6"/>
          <circle cx="50" cy="50" r="15" fill="none" stroke="${t.border}" stroke-width="1.5" opacity=".6"/>
          <text x="50" y="54" text-anchor="middle" font-family="Arial" font-weight="900" font-size="11" fill="${t.accent}">BIS</text>
          <defs>
            <path id="topCirc" d="M 7,50 A 43,43 0 0,1 93,50"/>
            <path id="botCirc" d="M 14,65 A 43,43 0 0,0 86,65"/>
          </defs>
          <text font-family="Arial" font-weight="700" font-size="6.5" fill="${t.accent}" letter-spacing="1.5">
            <textPath href="#topCirc" startOffset="5%">BUREAU OF INDIAN STANDARDS</textPath>
          </text>
          <text font-family="Arial" font-weight="600" font-size="6" fill="${t.accent}" letter-spacing="1">
            <textPath href="#botCirc" startOffset="10%">GREEN INTELLIGENCE PLATFORM</textPath>
          </text>
          <text x="50" y="16" text-anchor="middle" font-size="7" fill="${t.gold}">â˜…</text>
          <text x="50" y="90" text-anchor="middle" font-size="7" fill="${t.gold}">â˜…</text>
        </svg>
        <div style="font-size:8px;color:${t.accent};letter-spacing:.1em;text-transform:uppercase;text-align:center;margin-top:4px;opacity:.7">Official Seal</div>
      </div>

      <!-- Director General signature -->
      <div class="sig-block">
        <svg class="sig-svg" width="160" height="48" viewBox="0 0 160 48">
          <path d="M8,40 C14,26 18,16 26,14 C34,12 36,26 28,34 C22,40 14,38 16,32 M26,14 C34,8 44,14 42,26" fill="none" stroke="${t.accent}" stroke-width="2" stroke-linecap="round"/>
          <path d="M50,14 C52,26 51,36 54,42 M48,26 C56,22 64,20 68,26 C72,32 68,42 60,44 C54,46 50,42 52,38" fill="none" stroke="${t.accent}" stroke-width="2" stroke-linecap="round"/>
          <path d="M80,12 C84,26 82,40 86,44 M80,28 C88,24 98,24 102,30 C106,36 102,46 94,48" fill="none" stroke="${t.accent}" stroke-width="2" stroke-linecap="round"/>
          <path d="M114,20 C116,14 124,12 130,16 C136,22 134,34 126,38 C118,42 112,36 116,30" fill="none" stroke="${t.accent}" stroke-width="2" stroke-linecap="round"/>
          <path d="M142,18 C144,28 146,38 148,46 M140,28 C148,24 156,24 160,30" fill="none" stroke="${t.accent}" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <div class="sig-line"></div>
        <div class="sig-name">Shri A. P. Singh, IAS</div>
        <div class="sig-title">Director General</div>
        <div class="sig-dept">Bureau of Indian Standards</div>
        <div style="font-size:9px;color:rgba(255,255,255,.25);margin-top:3px;font-family:'Courier New',monospace">BIS/DG/HQ/2024/001</div>
      </div>
    </div>

    <!-- Footer -->
    <div class="cert-footer">
      <div>BIS Green Intelligence Certification Platform &nbsp;|&nbsp; BIS Act, 2016 &nbsp;|&nbsp; Environment Protection Act, 1986</div>
      <div>Verify at bis.gov.in/green-verify using ${certNum}</div>
    </div>

  </div>

  <!-- Bottom tricolor + shimmer -->
  <div class="tricolor"></div>
  <div class="shimmer-bar"></div>
</div>
</body></html>`;

  const blob = new Blob([html], {type:'text/html'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href     = url;
  a.download = `BIS_GreenCert_${b.tier.toUpperCase()}_${d.id}.html`;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{URL.revokeObjectURL(url);a.remove();},1000);
  toast(`Certificate downloaded: ${b.label}`, t.icon || 'ğŸ†');
}

function resetGreenForm() {
  ['g-company','g-product','g-elec','g-dist','g-fuel','g-volume','g-recycle'].forEach(id => {
    document.getElementById(id).value = '';
  });
  ['g-eer','g-hazard','g-waste'].forEach(id => {
    document.getElementById(id).selectedIndex = 0;
  });
  document.getElementById('greenResult').innerHTML = '';
  toast('Form cleared â€” ready for new assessment', 'ğŸ”„');
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BIS BACKEND API â€” Flask/SQLite Integration
   Syncs all applicant submissions & officer decisions
   across multiple PCs on the same network.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const bisAPI = {
  isServer: () => window.location.protocol !== 'file:',
  baseURL:  () => window.location.origin,

  async submitApplication(appObj) {
    if (!bisAPI.isServer()) return;
    try {
      const r = await fetch(bisAPI.baseURL() + '/submit_application', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(appObj)
      });
      const d = await r.json();
      console.info('[BIS API] âœ… Submitted:', appObj.id, d.message);
    } catch(e) { console.warn('[BIS API] Offline â€” session only', e); }
  },

  async getApplications() {
    if (!bisAPI.isServer()) return null;
    try {
      const r = await fetch(bisAPI.baseURL() + '/get_applications');
      return await r.json();
    } catch(e) { console.warn('[BIS API] Fetch failed', e); return null; }
  },

  async issueDecision(payload) {
    if (!bisAPI.isServer()) return;
    try {
      const r = await fetch(bisAPI.baseURL() + '/officer_decision', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const d = await r.json();
      console.info('[BIS API] âš– Decision stored:', payload.id, payload.decision);
    } catch(e) { console.warn('[BIS API] Decision sync failed', e); }
  },

  async syncDashboard() {
    const serverApps = await bisAPI.getApplications();
    if (!serverApps || !serverApps.length) return;
    serverApps.forEach(sa => {
      const exists = submittedApps.find(a => a.id === sa.id);
      if (!exists) {
        submittedApps.push({
          id: sa.id, company: sa.company, gst: sa.gst || '',
          state: sa.state || '', category: sa.category || '',
          specs: sa.specs || '', appType: sa.app_type || '',
          productionStart: sa.production_start || '',
          productionVolume: sa.production_volume || '',
          score: sa.score || 0, risk: sa.risk || 'Unknown',
          status: sa.status || 'pending',
          cml: sa.assigned_cml || sa.cml || null,
          assignedCML: sa.assigned_cml || null,
          officerRemarks: sa.officer_remarks || '',
          decisionDate: sa.decision_date || null,
          findings: sa.findings || [],
          remarks: sa.officer_remarks || ''
        });
      } else {
        exists.status        = sa.status;
        exists.cml           = sa.assigned_cml || sa.cml || exists.cml;
        exists.assignedCML   = sa.assigned_cml || exists.assignedCML;
        exists.officerRemarks= sa.officer_remarks || exists.officerRemarks;
        exists.remarks       = sa.officer_remarks || exists.remarks;
        exists.decisionDate  = sa.decision_date  || exists.decisionDate;
      }
    });
    renderLiveApps();
    renderUserDash();
    console.info('[BIS API] ğŸ”„ Synced', serverApps.length, 'records');
  }
};

/* Auto-sync dashboard & user dash on page switch */
(function() {
  const _orig = showPage;
  window.showPage = function(id) {
    _orig(id);
    if (id === 'dashboard' || id === 'userdash') bisAPI.syncDashboard();
  };
})();

/* Refresh button also pulls from server */
const _origRefresh = window.refreshDash;
window.refreshDash = async function() {
  if (_origRefresh) _origRefresh();
  await bisAPI.syncDashboard();
  toast('Dashboard synced from server', 'ğŸ”„');
};

</script>
